System.register(["jimu-core","jimu-theme","jimu-arcgis","jimu-ui","jimu-layouts/layout-runtime","jimu-core/data-source","jimu-core/react","esri/core/reactiveUtils"],(function(e,t){var i={},a={},o={},s={},l={},n={},r={},d={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.CONSTANTS=e.CONSTANTS,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.MessageManager=e.MessageManager,i.MutableStoreManager=e.MutableStoreManager,i.React=e.React,i.ReactResizeDetector=e.ReactResizeDetector,i.ServiceManager=e.ServiceManager,i.SessionManager=e.SessionManager,i.WidgetState=e.WidgetState,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.cancelablePromise=e.cancelablePromise,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.esri=e.esri,i.getAppStore=e.getAppStore,i.i18n=e.i18n,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.privilegeUtils=e.privilegeUtils},function(e){a.Global=e.Global},function(e){o.ADD_TO_MAP_DATA_ID_PREFIX=e.ADD_TO_MAP_DATA_ID_PREFIX,o.JimuMapViewComponent=e.JimuMapViewComponent,o.LayerTypes=e.LayerTypes,o.SHOW_ON_MAP_DATA_ID_PREFIX=e.SHOW_ON_MAP_DATA_ID_PREFIX,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){s.AdvancedSelect=e.AdvancedSelect,s.Alert=e.Alert,s.Button=e.Button,s.DataActionList=e.DataActionList,s.DataActionListStyle=e.DataActionListStyle,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Popper=e.Popper,s.Select=e.Select,s.Tab=e.Tab,s.Tabs=e.Tabs,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){l.LayoutItemSizeModes=e.LayoutItemSizeModes},function(e){n.QueryScope=e.QueryScope},function(e){r.Fragment=e.Fragment},function(e){d.default=e.default}],execute:function(){e((()=>{var e={59374:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},4280:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 400 400"><path fill="#000" d="M0 0h400v40H0z"></path><path fill="#000" fill-rule="evenodd" d="M80 55H20v9h60zm100 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 135h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 215h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 295h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 95h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 175h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 255h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 334h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 374h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M0 39h1v40h98V39h1v40h99V39h1v40h99V39h1v40h99V39h1v360h-1v-40h-99v40h99v1H0V39m1 320v40h98v-40zm98-1H1v-39h98zm1 1v40h99v-40zm99-1h-99v-39h99zm1 1v40h99v-40zm99-1h-99v-39h99zm1 0h99v-39h-99zM1 318v-38h98v38zm99 0v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zM1 279h98v-39H1zm0-79v39h98v-39zm98-1H1v-39h98zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zM1 159v-39h98v39zm99 0v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zM1 119h98V80H1z" clip-rule="evenodd"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},20904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},27964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},65959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 1v1.5h-.058L7.944 7.689v7.821c0 .27-.207.49-.464.49a.45.45 0 0 1-.325-.14l-2.1-2.18V7.681L.066 2.5H0V1zm-.929.98H.93v.041l5.055 5.25v5.998l1.031 1.071V7.278l5.056-5.25z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M10.359 14.118 9 14.878v-1.146l.75-.42v-3.52l-.75.42V9.066l1.402-.785 2.049 1.331L15.25 8v5.825l-2.906 1.626zM10.75 9.7v3.476l1.25.84v-3.504zm2.25.75 1.25-.72v3.508l-1.25.7z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62243:e=>{"use strict";e.exports=d},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},41349:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=r},41496:e=>{"use strict";e.exports=l},1888:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=s}},t={};function c(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>ze,default:()=>Ne});var e,t,i,a,o,s,l=c(79244),n=c(1888);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(i||(i={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(a||(a={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(o||(o={})),function(e){e.View="VIEW",e.Add="ADD"}(s||(s={}));var r=c(62686);var d=c(14321),h=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};class p extends l.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.6.0",description:"Add editable to table fields.",upgrader:(e,t)=>{let i=e;return 0===i.layersConfig.length||i.layersConfig.forEach(((e,t)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{editAuthority:!0})));i=i.setIn(["layersConfig",t,"tableFields"],a)})),i}},{version:"1.10.0",description:"Add visible to table fields.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{visible:!0})));t=t.setIn(["layersConfig",i,"tableFields"],a)})),t}},{version:"1.12.0",description:"Add header setting options.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{e=e.set("headerFontSetting",{backgroundColor:"",fontSize:14,bold:!1,color:""}),t=t.setIn(["layersConfig",i],e)})),t}},{version:"1.13.0",description:'Add "showCount" and "updateText" options.',upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{if(e=e.set("showCount",!1).set("updateText",!0),t=t.setIn(["layersConfig",i],e),(null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const a=e.searchFields.split(",")||[];t=t.setIn(["layersConfig",i,"searchFields"],a)}else(null==e?void 0:e.searchFields)||(t=t.setIn(["layersConfig",i,"searchFields"],[]))})),t}},{version:"1.14.0",description:"Update honor webmap options",upgrader:e=>h(this,void 0,void 0,(function*(){let t=e;const i=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{layerHonorMode:a.Custom})));return t=t.setIn(["layersConfig"],i),t}))},{version:"1.15.0",description:"Update column setting",upgrader:e=>h(this,void 0,void 0,(function*(){let t=e;const i=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{columnSetting:{responsiveType:o.Fixed,columnWidth:200}})));return t=t.setIn(["layersConfig"],i),t}))},{version:"1.16.0",description:"Modify a property spelling error",upgrader:t=>h(this,void 0,void 0,(function*(){let i=t;const a=i.layersConfig.map((e=>{const t=e.enableAttachements,i=Object.assign(Object.assign({},e),{enableAttachments:t});return delete i.enableAttachements,i}));return i=i.setIn(["layersConfig"],a).setIn(["tableMode"],e.Layer),i}))}]}}const v=new p;var g=c(41496);function m(e,t,i,a){var o,s,n,r,d,c;const{id:u,isHeightAuto:h,isWidthAuto:p,headerFontSetting:v,horizontalTag:g,widgetWidth:m}=a;return l.css`
    ${"&.table-widget-"+u} {
      .table-indent{
        width: calc(100% - 32px);
        height: calc(100% - 26px);
        margin: 10px 16px 16px;
        display: inline-block;
        ${h&&"min-height: 190px;"};
        ${p&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.ref.palette.neutral[500]};
          margin: 8px 4px;
        }
        .data-action-btn{
          position: relative;
        }
      }
      .tab-title{
        user-select: none;
        margin: auto;
      }
      .tab-flex{
        width: 100%;
        overflow-x: auto;
        .closeable{
          height: 31px;
        }
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .nav-item{
          height: 31px;
          max-width: calc(${m/2}px - ${t?"40px":"120px"});
        }
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tag-list{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tag-list{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tag-list,
      .horizontal-tag-list{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tag-list{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 32px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: calc(100% - 45px);
      }
      .top-button-list{
        ${!i&&!g&&"\n          position: absolute;\n          right: 17px;\n        "}
        ${t?"display: none":"display: flex"};
        .top-button{
          display: inline-flex;
          button{
            width: 32px;
            height: 32px;
          }
        }
      }
      .mobile-map-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .table-search-div{
        .table-search{
          .search-icon{
            z-index: 2;
          }
          .search-input{
            border: 1px solid ${e.ref.palette.neutral[500]};
            border-radius: 2px;
            .input-wrapper{
              height: 30px;
              border: none;
            }
          }
        }
      }
      .table-header{
        height: ${i?"40px":"0"};
        width: 100%;
        display: flex;
        justify-content: space-between;
      }
      .table-con{
        width: 100%;
        height: ${i?"calc(100% - 40px);":"100%"};
        .esri-widget{
          background-color: transparent;
          vaadin-grid-cell-content:has(.esri-column__header-content) {
            ${(null==v?void 0:v.backgroundColor)&&`background-color: ${v.backgroundColor};`}
            ${(null==v?void 0:v.fontSize)&&`font-size: ${v.fontSize}px;`}
            ${(null==v?void 0:v.bold)&&"font-weight: bold;"}
            ${(null==v?void 0:v.color)&&`color: ${v.color};`}
            ${function(e){const t=[];e&&(e.backgroundColor&&(t.push(`--calcite-color-foreground-1: ${e.backgroundColor};`),t.push("--calcite-color-foreground-2: #0000000a;"),t.push("--calcite-color-foreground-3: #0000000a;")),e.color&&(t.push(`--calcite-color-text-3: ${e.color};`),t.push(`--calcite-color-text-1: ${e.color};`)),e.fontSize&&t.push(`--calcite-font-size--2: ${e.fontSize};`),e.bold&&t.push("--calcite-ui-text-3: bold;"));return t.join(" ")}(v)}
            .esri-column__header-content {
              ${(null==v?void 0:v.bold)&&"font-weight: bold;"}
            }
          }
        }
        .esri-grid .esri-column__sorter{
          overflow-x: auto;
          overflow-y: hidden;
        }
        .esri-field-column__header-content{
          width: calc(100% - 26px);
          overflow: unset;
        }
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__content{
          min-height: 145px;
        }
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .placeholder-table-con{
        height: ${i?"calc(100% - 40px)":"100%"};
        width: 100%;
        position: relative;
        .jimu-widget-placeholder{
          width: 100%;
        }
        .placeholder-alert-con{
          position: absolute;
          right: 10px;
          bottom: 10px;
        }
      }
      .placeholder-reset-con{
        height: calc(100% - 114px);
        width: calc(100% - 32px);
        position: absolute;
        top: 95px;
        z-index: 1001;
        .placeholder-reset-button{
          position: absolute;
          top: calc(50% + 42px);
          left: 50%;
          transform: translateX(-50%) translateY(-50%);
        }
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
      .refresh-loading-con {
        right: 0;
        height: ${l.polished.rem(16)};
        .auto-refresh-loading {
          background: ${l.polished.rgba(null===(s=null===(o=null==e?void 0:e.ref.palette)||void 0===o?void 0:o.neutral)||void 0===s?void 0:s[200],.65)};
          color: ${null===(n=e.ref.palette)||void 0===n?void 0:n.black};
          font-size: ${l.polished.rem(12)};
          line-height: ${l.polished.rem(16)};
          ${!t&&`padding: 0 ${l.polished.rem(7)};`}
          .icon-btn{
            padding: ${l.polished.rem(1)};
          }
        }
      }
      .table-count{
        left: 0;
        bottom: 0;
        height: ${l.polished.rem(16)};
        .total-count-text{
          background: ${l.polished.rgba(null===(d=null===(r=null==e?void 0:e.ref.palette)||void 0===r?void 0:r.neutral)||void 0===d?void 0:d[200],.65)};
          color: ${null===(c=e.ref.palette)||void 0===c?void 0:c.black};
          font-size: ${l.polished.rem(12)};
          line-height: ${l.polished.rem(16)};
          padding: 0 ${l.polished.rem(7)};
        }
      }
      .dropdown-list-container{
        ${i&&"\n          position: absolute;\n          right: 17px;\n          top: 55px;\n        "}
        ${!i&&!g&&"\n          position: absolute;\n          right: 17px;\n        "}
        .dropdown-list{
          ${!t&&"display: none;"}
          width: 32px;
          height: 32px;
        }
      }
    }
  `}var b=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};function f(e,t,i){const a=i||"jimuName",o=e.length>t.length,s=o?t:e;return(o?e:t).filter((e=>!s.some((t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))))}function y(e){return l.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone())}function S(e,t){var i;if(!e)return{popupAllFields:[],actionUsedFields:[]};const o=[];if(t){const a=null==t?void 0:t.getSchema(),s=Object.keys(null==a?void 0:a.fields),l=null==t?void 0:t.getPopupInfo();if(l){const e=(l.fieldInfos||[]).filter((e=>s.includes(e.fieldName)));for(const t of e)t.visible&&o.push({value:t.fieldName,label:t.label||t.fieldName})}else{const a=null===(i=null==t?void 0:t.getLayerDefinition())||void 0===i?void 0:i.fields,l=((null==a?void 0:a.length)>0?a:e.allFields).filter((e=>s.includes(e.jimuName||e.name)));for(const e of l)o.push({value:e.name,label:e.alias||e.name})}}const s=e.layerHonorMode===a.Webmap?o.map((e=>e.value)):e.tableFields.map((e=>e.jimuName));return{popupAllFields:o,actionUsedFields:s}}function w(e){return l.css`
    .esri-button-menu__item .esri-button-menu__item-label{
      padding: 4px 15px !important;
    }
    .table-popup-search{
      .search-icon{
        z-index: 2;
      }
      .popup-search-input{
        border: 1px solid ${e.ref.palette.neutral[500]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
    .table-action-option{
      width: 100%;
      display: inline-flex;
      flex-direction: row;
      .table-action-option-tab{
        margin: auto 8px;
      }
      .table-action-option-close{
        flex: 1;
        button{
          :hover {
            color: ${e.ref.palette.white};
          }
          float: right;
        }
      }
    }
    .esri-popover--open{
      z-index: 1005 !important;
      .esri-date-picker__calendar{
        background-color: ${e.ref.palette.white};
      }
    }
    .table-hide-hover-color{
      color: unset !important;
      border: none !important;
      &:hover{
        color: unset !important; /* use color of dropdown item */
      }
    }
  `}var x=c(50170),T=c.n(x),I=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const j=e=>{const t=window.SVG,{className:i}=e,a=I(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:T()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var C=c(96300),A=c.n(C),M=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const O=e=>{const t=window.SVG,{className:i}=e,a=M(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:A()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var D=c(62838),L=c.n(D),F=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const E=e=>{const t=window.SVG,{className:i}=e,a=F(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:L()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var N=c(7835),z=c.n(N),P=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const R=e=>{const t=window.SVG,{className:i}=e,a=P(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:z()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var V=c(4583),_=c.n(V),B=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const H=e=>{const t=window.SVG,{className:i}=e,a=B(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:_()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var W=c(21935),k=c.n(W),U=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const $=e=>{const t=window.SVG,{className:i}=e,a=U(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:k()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var Q=c(49419),G=c.n(Q),J=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const q=e=>{const t=window.SVG,{className:i}=e,a=J(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:G()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var X=c(27964),K=c.n(X),Y=c(20904),Z=c.n(Y),ee=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const te=e=>{const t=window.SVG,{className:i}=e,a=ee(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component has-rtl-svg",i);return t?l.React.createElement(t,Object.assign({className:o,src:K(),srcRTL:Z()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var ie=c(4651),ae=c.n(ie),oe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const se=e=>{const t=window.SVG,{className:i}=e,a=oe(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:ae()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var le=c(9044),ne=c.n(le),re=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const de=e=>{const t=window.SVG,{className:i}=e,a=re(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:ne()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var ce=c(41349),ue=c(68972),he=c(62243),pe=c(45508),ve=c.n(pe),ge=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const me=e=>{const t=window.SVG,{className:i}=e,a=ge(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:ve()},a)):l.React.createElement("svg",Object.assign({className:o},a))},be=(e,t,s,n,r)=>{var d,c,u;const h=e.getSchema(),p=null==e?void 0:e.getLayerDefinition(),v=["CreationDate","Creator","EditDate","Editor","GlobalID"],g=(null==h?void 0:h.fields)?Object.values(null==h?void 0:h.fields):[],m=(null==p?void 0:p.fields)||[];let b=g.filter((e=>!v.includes(e.jimuName))).map((e=>{const t=m.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i,visible:!0})}));const f=null===(d=null==e?void 0:e.getPopupInfo())||void 0===d?void 0:d.fieldInfos;if("output"!==e.dataViewId&&f&&(null==f?void 0:f.length)>0){const e=[];f.forEach((t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)})),b=b.filter((t=>e.includes(t.name)))}(null==b?void 0:b.length)>50&&(b=b.slice(0,50));const y={dataSourceId:e.id,mainDataSourceId:null===(c=e.getMainDataSource())||void 0===c?void 0:c.id,dataViewId:e.dataViewId,rootDataSourceId:null===(u=e.getRootDataSource())||void 0===u?void 0:u.id},S=(0,l.Immutable)(y),w=b.map((e=>e.jimuName)),x=S.set("fields",w);return{id:t?e.id:s?s(e.id):e.id,name:e.getLabel(),useDataSource:x.asMutable({deep:!0}),allFields:g,tableFields:b,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableSelect:!0,enableDelete:!1,selectMode:i.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:o.Fixed,columnWidth:200},layerHonorMode:a.Webmap,parentViewId:n}},fe=[r.LayerTypes.FeatureLayer,r.LayerTypes.SceneLayer,r.LayerTypes.BuildingComponentSublayer,r.LayerTypes.OrientedImageryLayer,r.LayerTypes.ImageryLayer,r.LayerTypes.SubtypeSublayer];function ye(e){if(!e||!e.type)return!1;const t=e.type,i=t!==r.LayerTypes.BuildingComponentSublayer||t===r.LayerTypes.BuildingComponentSublayer&&e.view;return!!(fe.includes(t)&&i)}var Se=c(65959),we=c.n(Se),xe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i};const Te=e=>{const t=window.SVG,{className:i}=e,a=xe(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:o,src:we()},a)):l.React.createElement("svg",Object.assign({className:o},a))};var Ie=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};const{BREAK_POINTS:je,SELECTION_DATA_VIEW_ID:Ce,DATA_VIEW_ID_FOR_NO_SELECTION:Ae}=l.CONSTANTS,Me={where:"1=1",sqlExpression:null},Oe=c(4280),De=[l.DataSourceStatus.NotReady,l.DataSourceStatus.LoadError],Le=new(0,l.esri.Sanitizer),Fe=Object.assign({},{_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLabel:"{layer} table selection",tableCount:"Total: {total} | Selection: {selected}",_action_addToTable_label:"Add to table",deleteRecords:"Delete selection",enableMapExtentFilter:"Filter by the connected map extent"},d.defaultMessages);class Ee extends l.React.PureComponent{constructor(t){var n,c,u,h;super(t),this.promises=[],this.FeatureTable=null,this.FeatureLayer=null,this.ImageryLayer=null,this.OrientedImageryLayer=null,this.TableTemplate=null,this.geometryEngine=null,this.Polygon=null,this.SubtypeGroupLayer=null,this.SubtypeSublayer=null,this.partSupportedDsTypes=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.ImageryLayer]),this.getAllLayersConfig=(e,t,i,a)=>Ie(this,void 0,void 0,(function*(){const o=this.getDataActionTable();let s;if(i){s=(yield this.getAllMapLayersConfig(null==t?void 0:t.asMutable({deep:!0}),a)).concat(o)}else s=null==e?void 0:e.asMutable({deep:!0}).concat(o);return s})),this.getAllMapLayersConfig=(e,t)=>Ie(this,void 0,void 0,(function*(){const i=void 0===t?this.state.jimuMapView:t;if(!i)return[];const a=[];yield i.whenJimuMapViewLoaded();const o=i.jimuLayerViews,s=i.jimuTables,l=i.id,n=(null==e?void 0:e[l])||{},{layersConfig:d=[],customJimuLayerViewIds:c=[],customizeLayers:u}=n;for(const e in o){const t=o[e];if(!ye(t))continue;const{layerDataSourceId:i}=t,s=null==t?void 0:t.fromRuntime,l=t.isLayerVisible();if(!(s?!u&&l:u?c.includes(e):l))continue;const n=e.indexOf("-"),h=e.substring(n+1),p=d.find((e=>e.id===h));let v=(null==t?void 0:t.getLayerDataSource())||this.dsManager.getDataSource(i);if(v||(v=yield t.createLayerDataSource()),!v)continue;e.includes(r.SHOW_ON_MAP_DATA_ID_PREFIX)||e.includes(r.ADD_TO_MAP_DATA_ID_PREFIX);const g=be(v,!0,void 0,t.jimuMapViewId);if(p){if(0!==f(g.allFields,p.allFields).length){const e=Object.assign(Object.assign({},p),{name:g.name,useDataSource:g.useDataSource,allFields:g.allFields,tableFields:g.tableFields});a.push(e)}else a.push(p)}else a.push(g)}for(const e in s){const t=s[e],{visible:o}=t,l=i.getDataSourceIdByAPILayer(t);if(!(u?c.includes(e):o))continue;const n=e.indexOf("-"),r=e.substring(n+1),h=d.find((e=>e.id===r)),p=this.dsManager.getDataSource(l),v=i.getMapDataSource();let g=p;if(!p&&v&&(g=yield v.createDataSourceByLayer(t)),!g)continue;const m=be(g,!0);if(h){if(0!==f(m.allFields,h.allFields).length){const e=Object.assign(Object.assign({},h),{name:m.name,useDataSource:m.useDataSource,allFields:m.allFields,tableFields:m.tableFields});a.push(e)}else a.push(h)}else a.push(m)}return a})),this.onSettingChangeRuntime=()=>{var e,t,i,a;const{id:o}=this.props,s=(null===(t=null===(e=this.props)||void 0===e?void 0:e.stateProps)||void 0===t?void 0:t.optionChangeSuggestion)||!1,n=(null===(a=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===a?void 0:a.removeLayerFlag)||!1;if(s&&(this.setState({isShowSuggestion:!1}),this.props.dispatch(l.appActions.widgetStatePropChange(o,"optionChangeSuggestion",!1))),n){const e=document.getElementsByClassName("esri-popover esri-popover--open");e&&e.length>0&&e[0].remove(),this.props.dispatch(l.appActions.widgetStatePropChange(o,"removeLayerFlag",!1))}},this.onFilterChange=e=>{var t,i;const{dataSource:a,activeTabId:o}=this.state,{viewInTableObj:s}=this.props;if(s&&o===e){if(Object.keys(s||{}).findIndex((t=>t===e))>-1){const o=s[e].daLayerItem.dataActionDataSource,l=s[e].daLayerItem.useDataSource;let n;o?n=o.getCurrentQueryParams():l&&a&&(n=a.getCurrentQueryParams());const r=null===(i=null===(t=this.table)||void 0===t?void 0:t.layer)||void 0===i?void 0:i.definitionExpression;void 0!==r&&r!==(null==n?void 0:n.where)&&(this.table.layer.definitionExpression=null==n?void 0:n.where)}}},this.settingOptionsChange=(e,t)=>{var i,a,s;let n=!1;if((null==e?void 0:e.id)!==(null==t?void 0:t.id))return n;const r=["enableAttachments","enableEdit","allowCsv","enableSelect","selectMode","layerHonorMode","tableFields","columnSetting"],d=["tableFields","columnSetting"];for(const i of r){if(d.includes(i)?!l.lodash.isDeepEqual(null==e?void 0:e[i],null==t?void 0:t[i]):(null==e?void 0:e[i])!==(null==t?void 0:t[i])){n=!0;break}}return(null===(i=null==e?void 0:e.headerFontSetting)||void 0===i?void 0:i.fontSize)!==(null===(a=null==t?void 0:t.headerFontSetting)||void 0===a?void 0:a.fontSize)&&(null===(s=null==t?void 0:t.columnSetting)||void 0===s?void 0:s.responsiveType)===o.Fit&&(n=!0),n},this.getFieldsFromDataSource=()=>{var e;const{activeTabId:t,fullLayersConfig:i}=this.state,a=i.find((e=>e.id===t)),o=(null==a?void 0:a.dataActionDataSource)||this.dsManager.getDataSource(null===(e=null==a?void 0:a.useDataSource)||void 0===e?void 0:e.dataSourceId),s=null==o?void 0:o.getSchema(),l=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[],n=["CreationDate","Creator","EditDate","Editor","GlobalID"];let r=l.filter((e=>!n.includes(e.jimuName)));return(null==r?void 0:r.length)>50&&(r=r.slice(0,50)),{allFields:l,tableFields:r}},this.onToolStyleChange=(e,t)=>{e<je[0]?this.setState({mobileFlag:!0}):this.setState({mobileFlag:!1}),e<300?this.setState({searchToolFlag:!0}):this.setState({searchToolFlag:!1}),e<430?this.setState({bottomResponsiveFlag:!0}):this.setState({bottomResponsiveFlag:!1}),this.setState({widgetWidth:e})},this.onDataSourceCreated=e=>{this.setState({dataSource:e});const t=(null==e?void 0:e.dataViewId)===Ce,i=(null==e?void 0:e.dataViewId)&&"output"!==(null==e?void 0:e.dataViewId)&&!t,a=!!e.getMainDataSource().getDataView(Ae);!this.updatingTable&&(t&&a||i)&&(this.updatingTable=!0,this.destroyTable().then((()=>{this.createTable(e)})))},this.onCreateDataSourceFailed=e=>{const t=this.dsManager.getDataSource(e.dataSourceId);this.setState({dataSource:t})},this.updateGeometryAndSql=(e,t)=>{var i;if(!(null===(i=this.table)||void 0===i?void 0:i.layer))return;this.needToCallUpdateGeometryAndSql=!1;const{tableLoaded:a,dataSource:o}=this.state,s=e||o,n=null==s?void 0:s.getCurrentQueryParams(),r=this.table.layer.definitionExpression;if(!(""===r&&"1=1"===(null==n?void 0:n.where))&&r!==(null==n?void 0:n.where))if(a)if(this.table.isQueryingOrSyncing){let e=he.default.watch((()=>this.table.isQueryingOrSyncing),(()=>{if(!this.table.isQueryingOrSyncing){e&&(e.remove(),e=null);const t=null==s?void 0:s.getCurrentQueryParams();this.table.layer&&(null==n?void 0:n.where)===(null==t?void 0:t.where)&&this.table.layer.definitionExpression!==(null==n?void 0:n.where)&&(this.table.layer.definitionExpression=null==n?void 0:n.where)}}))}else this.table.layer.definitionExpression=null==n?void 0:n.where;else this.needToCallUpdateGeometryAndSql=!0;t||(l.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(s,(0,l.Immutable)(n)).then((e=>{var t,i;if(!e)return;const{geometry:a,distance:o,units:s}=e;if(!a)return;const n=null==a?void 0:a.spatialReference,r=null==a?void 0:a.type,{isWGS84:d,isWebMercator:c}=n,u=d||c?this.geometryEngine.geodesicBuffer:this.geometryEngine.buffer,h=null===(i=null===(t=this.table)||void 0===t?void 0:t.filterGeometry)||void 0===i?void 0:i.toJSON();if("polygon"!==r&&o&&o<=0){const e=new this.Polygon({rings:[]});l.lodash.isDeepEqual(h,null==e?void 0:e.toJSON())||(this.table.filterGeometry=e)}else if(o&&s){const e=u(a,o,s);l.lodash.isDeepEqual(h,null==e?void 0:e.toJSON())||(this.table.filterGeometry=e)}else this.table.filterGeometry=a})),setTimeout((()=>{this.asyncSelectedRebuild(o)}),500))},this.onDataSourceInfoChange=(t,i)=>Ie(this,void 0,void 0,(function*(){var a,o,n,r;if(!t)return void this.destroyTable().then((()=>{this.setState({notReady:!1,emptyTable:!0,tableTotal:0,tableSelected:0})}));this.dataSourceChange=!0,(null==t?void 0:t.status)===l.DataSourceStatus.Loaded&&(null==i?void 0:i.status)===l.DataSourceStatus.Loaded&&(this.dataSourceChange=!1);let{dataSource:d}=this.state;const{selectQueryFlag:c,activeTabId:u,selfDsChange:h}=this.state,{config:p,state:v}=this.props,{layersConfig:g,mapViewsConfig:m,tableMode:b}=p,f=b===e.Map,y=(yield this.getAllLayersConfig(g,m,f)).find((e=>e.id===u)),S=null==y?void 0:y.useDataSource,w=(null==y?void 0:y.dataActionType)===s.View;if(!d&&S||!w&&(null==d?void 0:d.id)!==(null==S?void 0:S.dataSourceId)){if(d=this.dsManager.getDataSource(null==S?void 0:S.dataSourceId),!d)return void this.setState({emptyTable:!0,tableTotal:0,tableSelected:0})}else if(!d&&!S)return;const x=(null==d?void 0:d.dataViewId)===Ce&&0===(null===(a=null==d?void 0:d.getSourceRecords())||void 0===a?void 0:a.length);if(!y.dataActionObject){if(!(null==t?void 0:t.status)||(null==t?void 0:t.status)===l.DataSourceStatus.NotReady||x)return void this.destroyTable().then((()=>{this.setState({notReady:!0,emptyTable:!0,tableTotal:0,tableSelected:0})}));this.setState({notReady:!1,emptyTable:!1})}const T=this.getLoadingStatus(d,null==t?void 0:t.status),I=(null==d?void 0:d.getAutoRefreshInterval())||0;this.toggleAutoRefreshLoading(d,T,I),this.setState({showLoading:T,interval:I});const j=null==i?void 0:i.selectedIds,C=null==t?void 0:t.selectedIds,A=null==i?void 0:i.sourceVersion,M=null==t?void 0:t.sourceVersion,O=null==t?void 0:t.gdbVersion,D=null==i?void 0:i.gdbVersion,L=null==t?void 0:t.version,F=null==i?void 0:i.version,E=(null===(o=null==y?void 0:y.useDataSource)||void 0===o?void 0:o.dataSourceId)===(null==d?void 0:d.id)&&(null==i?void 0:i.status)===(null==t?void 0:t.status)&&(null==i?void 0:i.instanceStatus)===(null==t?void 0:t.instanceStatus)&&(null==t?void 0:t.widgetQueries)===(null==i?void 0:i.widgetQueries)&&j===C&&(A===M||v===l.WidgetState.Active&&A!==M)&&O===D;if(De.includes(null==t?void 0:t.status)||this.updatingTable||E)return;this.setState({selectRecords:null==d?void 0:d.getSelectedRecords()});const N=M!==A,z=L!==F,P=(null===(n=null==y?void 0:y.useDataSource)||void 0===n?void 0:n.dataSourceId)!==(null==d?void 0:d.id),R=(!(null==i?void 0:i.status)||De.includes(null==i?void 0:i.status))&&t&&!De.includes(null==t?void 0:t.status)&&(null==t?void 0:t.instanceStatus)!==l.DataSourceStatus.NotCreated,V=j!==C&&(0!==(null==j?void 0:j.length)||0!==(null==C?void 0:C.length)),_=(null==t?void 0:t.status)===(null==i?void 0:i.status)&&(null==t?void 0:t.instanceStatus)===(null==i?void 0:i.instanceStatus),B=null===(r=null==d?void 0:d.getDataSourceJson())||void 0===r?void 0:r.isOutputFromWidget,H=!(y.dataActionObject||(null==t?void 0:t.status)!==l.DataSourceStatus.Unloaded||(null==t?void 0:t.instanceStatus)!==l.DataSourceStatus.Created||V||_||B);if(R||P||H||N||z){if((null==y?void 0:y.dataActionType)===s.View)return;if(!this.dataActionCanLoad)return;return this.updatingTable=!0,void this.destroyTable().then((()=>{this.createTable(d)}))}j!==C&&(c?(this.asyncSelectedWhenSelection(C||(0,l.Immutable)([])),setTimeout((()=>{this.asyncSelectedRebuild(d)}),500)):h?this.setState({selfDsChange:!1}):setTimeout((()=>{this.asyncSelectedRebuild(d)}),500))})),this.compareAndUpdateTable=(e,t,i)=>{const{dataSource:a,activeTabId:o,fullLayersConfig:s}=this.state,l=s.find((e=>e.id===o)),{widgetQueries:n,gdbVersion:r,sourceVersion:d}=t,{widgetQueries:c,gdbVersion:u,needRefresh:h,sourceVersion:p}=e,v=r&&u&&u!==r&&this.table,g=!(null==l?void 0:l.dataActionObject)&&c!==n,m=i&&d!==p;if(v){return this.table.layer.gdbVersion=u,void this.onTableRefresh()}if(!h)return m?(this.updatingTable=!0,void this.destroyTable().then((()=>{this.createTable()}))):void(g&&this.updateGeometryAndSql(a));this.onTableRefresh()},this.onQueryRequired=(e,t)=>{var i,a,o,s,n,r,d;const{dataSource:c}=this.state;if((null===(o=null===(a=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===a?void 0:a.dataActionActiveObj)||void 0===o?void 0:o.dataActionTable)||!t)return;const u=null==c?void 0:c.id,h=null==c?void 0:c.getCurrentQueryParams(),p=null==h?void 0:h.time,v=null===(s=this.table)||void 0===s?void 0:s.layer;if(p){const e=l.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(p),t=null==v?void 0:v.timeExtent;!((null==p?void 0:p[0])===(null===(n=null==t?void 0:t.start)||void 0===n?void 0:n.getTime())&&(null==p?void 0:p[1])===(null===(r=null==t?void 0:t.end)||void 0===r?void 0:r.getTime()))&&v&&(v.timeExtent=e)}else v&&(v.timeExtent=null);const g=null==e?void 0:e[u],m=null==t?void 0:t[u],b=null===(d=null==c?void 0:c.belongToDataSource)||void 0===d?void 0:d.id,f=null==e?void 0:e[b],y=null==t?void 0:t[b];(g||f)&&(f?this.compareAndUpdateTable(f,y,!0):this.compareAndUpdateTable(g,m))},this.getLayerObjectIdField=()=>{var e,t,i;const{dataSource:a}=this.state;return(null===(t=null===(e=this.table)||void 0===e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(i=null==a?void 0:a.layer)||void 0===i?void 0:i.objectIdField)||"OBJECTID"},this.asyncSelectedWhenSelection=e=>{const{dataSource:t}=this.state,i=this.getLayerObjectIdField(),a=t&&t.getCurrentQueryParams();let o=!0;e.forEach((e=>{e||(o=!1)}));const s=e.length>0&&o?`${i} IN (${e.map((e=>e)).join()})`:a.where;if(this.table&&this.table.layer){this.table.clearSelectionFilter();this.table.layer.definitionExpression=s}},this.getImageryLayer=(e,t)=>{var i,a,o,s;const n=e,r=e.type===l.AllDataSourceTypes.ImageryLayer,d=e.type===l.AllDataSourceTypes.OrientedImageryLayer,c=null===(i=null==e?void 0:e.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance;let u;const h=n.getCurrentQueryParams();if(c){const e={returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0};if(n.dataViewId===Ce&&(!n.sourceRecords||0===n.sourceRecords.length)){n.getMainDataSource().getDataView(Ae)&&(e.pageSize=null===(s=null===(o=null===(a=n.getMainDataSource().getDataSourceJson())||void 0===a?void 0:a.dataViews)||void 0===o?void 0:o[Ae])||void 0===s?void 0:s.pageSize)}return n.query(e).then((e=>Ie(this,[e],void 0,(function*({records:e}){const t=yield Promise.resolve(e);return l.dataSourceUtils.createJSAPIFeatureLayerByRecords(n,t)}))))}if(n.itemId){const e=n.layerId?parseInt(n.layerId):"",t={portalItem:{id:n.itemId,portal:{url:n.portalUrl}},definitionExpression:h.where,layerId:e||void 0};n.url&&(t.url=n.url),u=r?new this.ImageryLayer(t):new this.OrientedImageryLayer(t)}else if(n.url)u=r?new this.ImageryLayer({definitionExpression:h.where,url:n.url}):new this.OrientedImageryLayer({definitionExpression:h.where,url:n.url});else if(n.layer)return null==n?void 0:n.createJSAPILayerByDataSource().then((e=>e));if(r){if(!this.ImageryLayer)return Promise.resolve(u)}else if(d&&!this.OrientedImageryLayer)return Promise.resolve(u);return Promise.resolve(u)},this.getSubtypeLayer=e=>{var t,i,a;const o=e;if((null==o?void 0:o.dataViewId)===Ce){const e={returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0};if(o.dataViewId===Ce&&(!o.sourceRecords||0===o.sourceRecords.length)){o.getMainDataSource().getDataView(Ae)&&(e.pageSize=null===(a=null===(i=null===(t=o.getMainDataSource().getDataSourceJson())||void 0===t?void 0:t.dataViews)||void 0===i?void 0:i[Ae])||void 0===a?void 0:a.pageSize)}return o.query(e).then((e=>Ie(this,[e],void 0,(function*({records:e}){const t=yield Promise.resolve(e);return l.dataSourceUtils.createJSAPIFeatureLayerByRecords(o,t)}))))}const s=o.parentDataSource;let n;return(null==s?void 0:s.url)&&(n=new this.SubtypeGroupLayer({url:s.url,sublayers:[{subtypeCode:o.layer.subtypeCode,visible:o.layer.visible,renderer:o.layer.renderer}]})),null==n?void 0:n.loadAll().then((()=>Ie(this,void 0,void 0,(function*(){const e=n.sublayers.getItemAt(0);return yield Promise.resolve(e)}))))},this.getFeatureLayer=(e,t)=>{var i,a,o,s;const n=e,r=null===(i=null==e?void 0:e.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance;let d;if((null==t?void 0:t.length)>0)return l.dataSourceUtils.createJSAPIFeatureLayerByRecords(n,t);{if(e.type===l.AllDataSourceTypes.ImageryLayer||e.type===l.AllDataSourceTypes.OrientedImageryLayer)return this.getImageryLayer(e);if(e.type===l.AllDataSourceTypes.SubtypeSublayer)return this.getSubtypeLayer(e);const t=e&&e.getCurrentQueryParams();if(r){const e={returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0};if(n.dataViewId===Ce&&(!n.sourceRecords||0===n.sourceRecords.length)){n.getMainDataSource().getDataView(Ae)&&(e.pageSize=null===(s=null===(o=null===(a=n.getMainDataSource().getDataSourceJson())||void 0===a?void 0:a.dataViews)||void 0===o?void 0:o[Ae])||void 0===s?void 0:s.pageSize)}return n.query(e).then((e=>Ie(this,[e],void 0,(function*({records:e}){const t=yield Promise.resolve(e);return l.dataSourceUtils.createJSAPIFeatureLayerByRecords(n,t)}))))}if(!this.FeatureLayer)return Promise.resolve(d);if(n.itemId){const e=n.layerId?parseInt(n.layerId):"",i={portalItem:{id:n.itemId,portal:{url:n.portalUrl}},definitionExpression:t.where,layerId:e||void 0};n.url&&(i.url=n.url),d=new this.FeatureLayer(i)}else{if(!n.url)return n.layer?null==n?void 0:n.createJSAPILayerByDataSource().then((e=>e)):Promise.resolve(d);d=new this.FeatureLayer({definitionExpression:t.where,url:n.url})}}return Promise.resolve(d)},this.getDsAccessibleInfo=e=>{if(!e)return Promise.resolve(!1);if(void 0!==this.dsAccessibleInfo[e])return Promise.resolve(this.dsAccessibleInfo[e]);return(0,l.esri.restRequest.request)(`${e}?f=json`).then((t=>Object.keys(t).includes("error")?(this.dsAccessibleInfo[e]=!1,!1):(this.dsAccessibleInfo[e]=!0,!0))).catch((t=>(this.dsAccessibleInfo[e]=!1,!1)))},this.getFieldEditable=(e,t)=>{const i=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!i||(null==i?void 0:i.editable)},this.dsAsyncSelectTable=(e,t,i,a)=>{const{id:o}=this.props,s=this.table,n=null==t?void 0:t.map((e=>{var t;return e.dataSource?null===(t=e.getId())||void 0===t?void 0:t.toString():null==e?void 0:e.toString()}));a&&e.clearSelection();const r=t=>{l.MessageManager.getInstance().publishMessage(new l.DataRecordsSelectionChangeMessage(o,t,[e.id])),s.layer.queryFeatureCount().then((e=>{0===e?this.setState({emptyData:!0}):this.setState({emptyData:!1})})),t.length>0?e.selectRecordsByIds(t.map((e=>e.getId())),t):e.clearSelection(),i||setTimeout((()=>{this.asyncSelectedRebuild(e)}),500)};(null==n?void 0:n.length)>0?e.query({objectIds:n,returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0},{scope:ce.QueryScope.InAllData}).then((e=>{const t=null==e?void 0:e.records;t&&r(t)})):r([])},this.isDataSourceAccessible=(e,t,i,a)=>{var o;const s=!!this.dsManager.getDataSource(e);let l=!1;return l=!!i||(a||t?s:(null===(o=this.props.useDataSources)||void 0===o?void 0:o.filter((t=>e===t.dataSourceId)).length)>0),l},this.resetUpdatingStatus=(e=!1)=>{this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.updatingTable=!1,this.setState({emptyTable:e})},this.getIsAdvancedPermission=e=>Ie(this,void 0,void 0,(function*(){var t;if(!e)return!1;const i=yield null==e?void 0:e.fetchItemInfo().then((e=>e)).catch((e=>{console.warn(e)}));if(!i||!i.url)return!1;const a=null===(t=l.ServiceManager.getInstance().getServerInfoByServiceUrl(i.url))||void 0===t?void 0:t.owningSystemUrl;if(!a)return!1;const o=l.SessionManager.getInstance().getSessionByUrl(a);if(!o)return!1;const s=yield o.getUser(),n="org_admin"===(null==s?void 0:s.role)&&(null==i?void 0:i.isOrgItem),r=i.owner===(null==s?void 0:s.username),d=yield l.privilegeUtils.isItemInTheUpdatedGroup(i.id,o);return n||r||d})),this.getFilteredUseFields=(e,t)=>{let i=[];const a=Object.keys(e||{});return(null==t?void 0:t.length)>=(null==a?void 0:a.length)?i=t.filter((e=>a.includes(e.jimuName||e.name))):a.forEach((a=>{const o=e[a],s=t.find((e=>e.name===a));i.push(Object.assign(Object.assign({},o),s))})),i},this.dsAsyncClick=(e,t,i,a)=>{this.clickTimer&&clearTimeout(this.clickTimer),this.clickTimer=setTimeout((()=>{this.dsAsyncSelectTable(e,t,i),clearTimeout(this.clickTimer),this.clickTimer=null}),400)},this.getLayerAndNewTable=(e,t,n)=>{const{tableShowColumns:d,selectQueryFlag:c}=this.state,{id:u}=this.props,h=this.currentRequestId+1;this.currentRequestId++;const p=(null==e?void 0:e.type)===l.AllDataSourceTypes.SceneLayer||(null==e?void 0:e.type)===l.AllDataSourceTypes.BuildingComponentSubLayer?e.getAssociatedDataSource():e;if(p){const v=()=>l.privilegeUtils.checkExbAccess(l.privilegeUtils.CheckTarget.Experience).then((e=>null==e?void 0:e.capabilities)),g=l.cancelablePromise.cancelable(this.getFeatureLayer(p,n).then((g=>Ie(this,void 0,void 0,(function*(){var m,b,S,w,x,T,I;if(!(h===this.currentRequestId&&g&&this.FeatureTable&&this.refs.currentEl&&this.refs.tableContainer&&document))return void this.resetUpdatingStatus();const j=(null==g?void 0:g.layer)||g;let C=null;if((null==n?void 0:n.length)>0){this.viewTableId++;const e=`${p.id}-${u}-view_in_table-${this.viewTableId}`,t=`${null===(m=p.belongToDataSource)||void 0===m?void 0:m.getDataSourceJson().sourceLabel}-${this.viewTableId}`,i={id:e,dataSourceJson:(0,l.Immutable)({id:e,type:l.DataSourceTypes.FeatureLayer,sourceLabel:t,disableExport:!(yield null==p?void 0:p.allowToExportData())}),layer:j};C=yield this.dsManager.createDataSource(i),this.setState({dataSource:C})}const A=yield this.getDsAccessibleInfo(null==g?void 0:g.url),M=yield v(),O=null==M?void 0:M.canEditFeature,D=yield this.getIsAdvancedPermission(C||e),L=null==j?void 0:j.userHasFullEditingPrivileges,F=null==e?void 0:e.getLayerDefinition(),E=null===(b=null==j?void 0:j.editingEnabled)||void 0===b||b,N=t.layerHonorMode===a.Webmap,z=A||O,P=(N||t.enableEdit)&&z,R=(N||t.enableDelete)&&z;let V=!1,_=!1;D||L&&E?(V=!0,_=!0):L&&!E?(V=!1,_=!1):(V=P,_=R),this.setState({allowDel:t.enableDelete&&z,exbPrivilege:z});const B=null==p?void 0:p.getSchema(),H=null==e?void 0:e.getCurrentQueryParams(),W=(null==H?void 0:H.orderByFields)||[],k={};W.forEach(((e,t)=>{var i;const a=e.split(" ");k[a[0]]={direction:null===(i=a[1])||void 0===i?void 0:i.toLowerCase(),initialSortPriority:t}}));const U=t.columnSetting,$=(null==U?void 0:U.responsiveType)===o.Fit?{autoWidth:!0}:{autoWidth:!1,width:(null==U?void 0:U.columnWidth)||200},{allFields:Q}=this.getFieldsFromDataSource(),G=f(Q,d?d.map((e=>({jimuName:e.value}))):t.tableFields.filter((e=>e.visible))).map((e=>e.jimuName));let J;const q=(null===(S=null==F?void 0:F.fields)||void 0===S?void 0:S.length)>0?F.fields:Q;if(N){const t=null===(w=null==e?void 0:e.getPopupInfo)||void 0===w?void 0:w.call(e),i=(null==t?void 0:t.fieldInfos)||[],a=Object.keys((null==B?void 0:B.fields)||{}),o=i.filter((e=>a.includes(e.fieldName))),s=this.getFilteredUseFields(null==B?void 0:B.fields,q);J=(null===(x=null==t?void 0:t.fieldInfos)||void 0===x?void 0:x.length)>0?new this.TableTemplate({columnTemplates:o.map((e=>{var t;const i=e.fieldName;return Object.assign(Object.assign(Object.assign(Object.assign({},e),$),{type:"field",editable:null!==(t=e.isEditable)&&void 0!==t&&t}),k[i]?k[i]:{})}))}):new this.TableTemplate({columnTemplates:s.map((e=>{const t=e.jimuName||e.name;return Object.assign(Object.assign(Object.assign(Object.assign({},e),$),{type:"field",fieldName:t,label:e.alias||e.name,editable:this.getFieldEditable(F,t),visible:!0}),k[t]?k[t]:{})}))})}else N||(J=new this.TableTemplate({columnTemplates:t.tableFields.map((e=>{var t;const i=e.jimuName||e.name,a=null===(t=null==B?void 0:B.fields)||void 0===t?void 0:t[i];return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({type:"field"},$),{fieldName:i,label:null==a?void 0:a.alias}),V?{editable:this.getFieldEditable(F,i)&&(null==e?void 0:e.editAuthority)}:{}),{visible:G.indexOf(i)<0}),k[i]?k[i]:{})}))}));if(0===(null===(T=null==J?void 0:J.columnTemplates)||void 0===T?void 0:T.length)&&!N)return void this.resetUpdatingStatus();if(V||_){let t=j;j.type===r.LayerTypes.SubtypeSublayer&&(t=j.parent),t.on("edits",(function(t){var i,a,o;const{updatedFeatures:s,deletedFeatures:l}=t,n=s&&s.length>0,r=l&&l.length>0;if(n){const o=null===(a=null===(i=null==t?void 0:t.edits)||void 0===i?void 0:i.updateFeatures)||void 0===a?void 0:a[0];if(o){const t=e.buildRecord(o);e.afterUpdateRecord(t)}}if(r){const i=null===(o=null==t?void 0:t.edits)||void 0===o?void 0:o.deleteFeatures;if(i.length>0){const t=[];i.forEach((i=>{const a=e.buildRecord(i);t.push(a.getId())})),e.afterDeleteRecordsByIds(t)}}}))}const X=e.getGDBVersion();X&&(j.gdbVersion=X);const K=null==H?void 0:H.time;if(K){const e=l.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(K);j.timeExtent=e}this.refs.tableContainer.innerHTML="";const Y=document.createElement("div");Y.className=`table-container-${u}`,this.refs.tableContainer.appendChild(Y),this.table=new this.FeatureTable(Object.assign(Object.assign({layer:j,container:Y,visibleElements:{columnDescriptions:!1,header:!1,menu:!1,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1},selectionColumn:!1},menuConfig:{items:[]}},J?{tableTemplate:J}:{}),{multiSortEnabled:!0,attachmentsEnabled:t.enableAttachments,editingEnabled:V,timeZone:y(e)})),he.default.watch((()=>{var e,t;return null===(t=null===(e=this.table)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.size}),(e=>{this.setState({tableTotal:e})})),he.default.watch((()=>{var e,t;return null===(t=null===(e=this.table)||void 0===e?void 0:e.highlightIds)||void 0===t?void 0:t.length}),(e=>{this.setState({tableSelected:e})})),he.default.watch((()=>{var e;return null===(e=this.table)||void 0===e?void 0:e.columns.some((e=>!!e.activeEditInfo))}),(e=>{this.setState({isTableEditing:e})})),he.default.watch((()=>this.table.state),(t=>{"loaded"===t?this.setState({tableLoaded:!0},(()=>{this.needToCallUpdateGeometryAndSql&&this.updateGeometryAndSql(e,!0)})):this.setState({tableLoaded:!1})}));const Z=t.dataActionType===s.Add;t.dataActionObject||setTimeout((()=>{c&&this.asyncSelectedWhenSelection((0,l.Immutable)(e.getSelectedRecordIds()||[]))}),500),Z&&setTimeout((()=>{this.asyncSelectedRebuild(e)}),500);const ee=this.table;if(t.enableSelect){const a=({feature:a,objectId:o})=>{a&&(this.state.isTableEditing||(clearTimeout(this.timerFn),this.timerFn=setTimeout((()=>{var l;this.setState({selfDsChange:!0});const n=o||a.getObjectId(),r=this.table.highlightIds.includes(n);t.selectMode===i.Single&&this.table.highlightIds.removeAll(),r?this.table.highlightIds.remove(n):this.table.highlightIds.add(n);const d=null===(l=ee.highlightIds)||void 0===l?void 0:l.toArray();0===(null==d?void 0:d.length)&&(this.state.selectQueryFlag&&this.table.clearSelectionFilter(),this.resetTableExpression(),this.setState({selectQueryFlag:!1}));const c=t.dataActionType===s.View;this.dsAsyncClick(c?C:e,d,!0)}),200)))};ee.on("cell-click",a)}null===(I=null==ee?void 0:ee.domNode)||void 0===I||I.addEventListener("dblclick",(e=>{clearTimeout(this.timerFn)})),n||this.updateGeometryAndSql(e),this.resetUpdatingStatus()})))));0!==this.promises.length&&this.promises.forEach((e=>{e.cancel()})),this.promises.push(g)}},this.createTable=t=>{var i,a,o;const{config:l}=this.props,{tableMode:n}=l,{activeTabId:r,fullLayersConfig:d}=this.state;let{dataSource:c}=this.state;t&&(c=t);const u=n===e.Map,h=d.find((e=>e.id===r));if(!h)return this.dataActionCanLoad=!0,void(this.updatingTable=!1);const{dataActionDataSource:p}=h;if(p&&(c=p),!c||De.includes(null===(i=null==c?void 0:c.getInfo())||void 0===i?void 0:i.status))return this.dataActionCanLoad=!0,void(this.updatingTable=!1);const v=h.dataActionObject;if((null==c?void 0:c.dataViewId)===Ce){if(!(null===(a=null==c?void 0:c.getDataSourceJson())||void 0===a?void 0:a.isDataInDataSourceInstance)||!v&&0===(null==c?void 0:c.getSourceRecords().length))return void this.resetUpdatingStatus(!0);this.setState({emptyTable:!1})}const g=p?null==p?void 0:p.id:null===(o=null==h?void 0:h.useDataSource)||void 0===o?void 0:o.dataSourceId;if(!(h.dataActionType===s.View||g===(null==c?void 0:c.id)))return this.dataActionCanLoad=!0,void(this.updatingTable=!1);if(!this.isDataSourceAccessible(g,v,p,u))return void this.resetUpdatingStatus(!0);const m=this.dataActionTableRecords[h.id];v&&g&&(c=this.dsManager.getDataSource(g)),this.setState({tableTotal:0,tableSelected:0}),this.getLayerAndNewTable(c,h,m)},this.asyncSelectedRebuild=e=>{var t,i,a;const{selectRecords:o}=this.state;let s=null==e?void 0:e.getSelectedRecordIds();const n=(null===(t=null==e?void 0:e.belongToDataSource)||void 0===t?void 0:t.getSelectedRecordIds())||[];e.isDataView&&s.length!==n.length&&(s=n||s),(null===(a=null===(i=this.table)||void 0===i?void 0:i.highlightIds)||void 0===a?void 0:a.removeAll)&&this.table.highlightIds.removeAll();const r=null==e?void 0:e.getSelectedRecords();r&&!l.lodash.isDeepEqual(o,r)&&this.setState({selectRecords:r}),(null==s?void 0:s.length)>0&&s.forEach((e=>{var t,i;e&&(null===(i=null===(t=this.table)||void 0===t?void 0:t.highlightIds)||void 0===i?void 0:i.add)&&this.table.highlightIds.add(parseInt(e))}))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Fe[e]},t),this.onTagClick=e=>{const{id:t}=this.props;this.setState({activeTabId:e,selectQueryFlag:!1,tableShowColumns:void 0,tableSelected:0}),this.props.dispatch(l.appActions.widgetStatePropChange(t,"activeTabId",e))},this.handleTagChange=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,{id:a}=this.props;this.setState({activeTabId:i,selectQueryFlag:!1,tableSelected:0}),this.props.dispatch(l.appActions.widgetStatePropChange(a,"activeTabId",i))},this.onShowSelection=()=>{const{selectQueryFlag:e}=this.state;e?(this.table.clearSelectionFilter(),this.resetTableExpression()):this.table.filterBySelection(),this.setState({selectQueryFlag:!e})},this.resetTableExpression=()=>{var e;const{dataSource:t}=this.state;if(null===(e=this.table)||void 0===e?void 0:e.layer){const e=(t&&t.getCurrentQueryParams()).where;this.table.layer.definitionExpression=e}},this.resetTable=()=>{const{id:e}=this.props,{selectQueryFlag:t,dataSource:i}=this.state;t&&(this.resetTableExpression(),this.setState({selectQueryFlag:!1,selfDsChange:!0})),l.MessageManager.getInstance().publishMessage(new l.DataRecordsSelectionChangeMessage(e,[],[i.id])),setTimeout((()=>{this.setState({searchText:""}),i.clearSelection(),i.updateQueryParams(Me,e),this.table&&this.table.highlightIds.removeAll(),this.table&&this.table.clearSelectionFilter()}),500)},this.onSelectionClear=()=>{this.resetTable()},this.onTableRefresh=()=>{this.table&&this.table.refresh()},this.onDeleteSelection=()=>{this.table&&this.table.deleteSelection(!0)},this.getQueryOptions=(e,t)=>{let i="1=1",a=null;const{useDataSources:o}=this.props,{searchText:s,dataSource:n}=this.state,r=o&&o[0];if(t?!n:!n||!r)return null;if(!n.query)return null;if(s&&e.enableSearch&&e.searchFields){const t=l.dataSourceUtils.getSQL(s,e.searchFields,n,null==e?void 0:e.searchExact);i=t.sql,a=t}return{where:i,sqlExpression:a}},this.handleChange=e=>{e?this.setState({searchText:e,isShowSuggestion:(null==e?void 0:e.length)>2},(()=>{clearTimeout(this.suggestionsQueryTimeout),this.suggestionsQueryTimeout=setTimeout((()=>{this.getSearchSuggestions(e)}),200)})):this.setState({searchText:e,isShowSuggestion:!1,searchSuggestion:[]},(()=>{this.handleSubmit()}))},this.getSearchSuggestions=e=>{var t;const{config:i}=this.props,{dataSource:a,activeTabId:o}=this.state;if((null==e?void 0:e.length)<3)return!1;(function(e,t,i){return b(this,void 0,void 0,(function*(){const a={searchText:e,searchFields:(null==t?void 0:t.searchFields)||[],dataSource:i,exact:null==t?void 0:t.searchExact};return l.dataSourceUtils.querySuggestions(a)}))})(e,null===(t=i.layersConfig)||void 0===t?void 0:t.find((e=>e.id===o)),a).then((e=>{this.setState({searchSuggestion:e})}))},this.handleSubmit=()=>{var t;const{dataSource:i,jimuMapView:a}=this.state,{id:o,config:s}=this.props,{tableMode:l,layersConfig:n,mapViewsConfig:r}=s,d=l===e.Map,c=d?null===(t=null==r?void 0:r[null==a?void 0:a.id])||void 0===t?void 0:t.layersConfig:n,u=null==c?void 0:c.find((e=>e.id===this.state.activeTabId));if(!u||!i)return;const h=this.getQueryOptions(u,d);i.updateQueryParams(h,o)},this.onKeyUp=e=>{e&&e.target&&"Enter"===e.key&&this.setState({isShowSuggestion:!1},(()=>{this.handleSubmit()}))},this.getTextInputPrefixElement=()=>{const{theme:e}=this.props;return(0,l.jsx)(d.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.setState({isShowSuggestion:!1},(()=>{this.handleSubmit()}))},className:"search-icon"},(0,l.jsx)(j,{color:e.ref.palette.neutral[700]}))},this.renderSearchTools=e=>{const{searchText:t,searchToolFlag:i,isOpenSearchPopper:a,tableLoaded:o}=this.state,{theme:s}=this.props;return(0,l.jsx)("div",{className:"table-search-div"},i?(0,l.jsx)("div",{className:"float-right",ref:e=>{this.refs.searchPopup=e}},(0,l.jsx)(d.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:this.formatMessage("search"),onClick:e=>{this.setState({isOpenSearchPopper:!a})}},(0,l.jsx)(j,null)),(0,l.jsx)(d.Popper,{placement:"right-start",reference:this.refs.searchPopup,offset:[-10,-30],open:a,showArrow:!1,toggle:e=>{this.setState({isOpenSearchPopper:!a})}},(0,l.jsx)("div",{className:"d-flex align-items-center table-popup-search m-2"},(0,l.jsx)(d.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.setState({isOpenSearchPopper:!1})},className:"search-back mr-1"},(0,l.jsx)(O,{color:s.ref.palette.neutral[1100]})),(0,l.jsx)(d.TextInput,{className:"popup-search-input",placeholder:e||this.formatMessage("search"),onChange:e=>{this.handleChange(e.target.value)},value:t||"",onKeyDown:e=>{this.onKeyUp(e)},prefix:this.getTextInputPrefixElement(),allowClear:!0,title:e||this.formatMessage("search"),disabled:!o})))):(0,l.jsx)("div",{className:"d-flex align-items-center table-search"},(0,l.jsx)(d.TextInput,{className:"search-input",placeholder:e||this.formatMessage("search"),onChange:e=>{this.handleChange(e.target.value)},value:t||"",onKeyDown:e=>{this.onKeyUp(e)},prefix:this.getTextInputPrefixElement(),allowClear:!0,title:e||this.formatMessage("search"),disabled:!o})))},this.getInitFields=()=>{var e;const{activeTabId:t,dataSource:i,fullLayersConfig:o}=this.state,s=[],l=o.find((e=>e.id===t));if(!l)return s;const{tableFields:n,allFields:r,layerHonorMode:d}=l;if(d===a.Webmap&&i){const t=null===(e=null==i?void 0:i.getPopupInfo)||void 0===e?void 0:e.call(i);if(t){const e=t.fieldInfos||[];for(const t of e)s.push({value:t.fieldName,label:t.label})}else for(const e of r)s.push({value:e.name,label:e.alias})}else for(const e of n)e.visible&&s.push({value:e.name,label:e.alias});return s},this.onValueChangeFromRuntime=e=>{e||(e=[]);const{tableShowColumns:t}=this.state,i=this.getInitFields(),a=t||i,o=e.length>a.length;f(a,e,"value").forEach((e=>{o?this.table.showColumn(e.value):this.table.hideColumn(e.value)})),this.setState({tableShowColumns:e})},this.toggleMapFilter=()=>{const{mapFilterEnabled:e}=this.state;this.setState({mapFilterEnabled:!e})},this.getDataActionTable=()=>{const{viewInTableObj:e}=this.props,t=[];for(const i in e){const a=e[i];this.dataActionTableRecords[i]=a.records,t.push(Object.assign({},a.daLayerItem))}return t},this.onCloseTab=(e,t)=>{const{id:i,viewInTableObj:a}=this.props;t&&t.stopPropagation(),this.removeConfig=!0,this.setState({tableShowColumns:void 0,tableTotal:0,tableSelected:0});const o=a;delete o[e],delete this.dataActionTableRecords[e],l.MutableStoreManager.getInstance().updateStateValue(i,"viewInTableObj",o)},this.getLoadingStatus=(e,t)=>{const{stateShowLoading:i}=this.props;let a=!1;return(i||window.jimuConfig.isInBuilder||e&&t===l.DataSourceStatus.Loading)&&(a=!0),a},this.setRefreshLoadingString=(e=!1)=>{if(!e)return!1;let t=0;const i=this;clearInterval(this.autoRefreshLoadingTime),this.autoRefreshLoadingTime=setInterval((()=>{t++,i.setState({autoRefreshLoadingString:i.getLoadingString(t)})}),6e4)},this.getLoadingString=e=>{let t=this.formatMessage("lastUpdateAFewTime");return e>1&&e<=2?t=this.formatMessage("lastUpdateAMinute"):e>2&&(t=this.formatMessage("lastUpdateTime",{updateTime:e})),t},this.toggleAutoRefreshLoading=(e,t,i)=>{this.resetAutoRefreshTimes(i,t),i>0&&this.setRefreshLoadingString(t)},this.resetAutoRefreshTimes=(e,t=!1)=>{const i=this;clearTimeout(this.resetAutoRefreshTime),e<=0&&clearInterval(this.autoRefreshLoadingTime),this.resetAutoRefreshTime=setTimeout((()=>{t&&e>0&&i.setState({autoRefreshLoadingString:i.formatMessage("lastUpdateAFewTime")}),i.setState({showLoading:t})}),0)},this.renderLoading=(e,t)=>{var i;const{autoRefreshLoadingString:a,bottomResponsiveFlag:o,widgetWidth:s}=this.state,n=(null===(i=this.refs.countContainer)||void 0===i?void 0:i.clientWidth)||0,r=o?20:s-n-16;return(0,l.jsx)("div",{className:"position-absolute refresh-loading-con d-flex align-items-center",style:{maxWidth:r}},e&&(0,l.jsx)("div",{className:"loading-con"}),t>0&&(0,l.jsx)("div",{className:"flex-grow-1 auto-refresh-loading text-truncate",title:!o&&a},o?(0,l.jsx)(d.Tooltip,{title:a,showArrow:!0,placement:"top-end"},(0,l.jsx)(d.Button,{icon:!0,size:"sm",type:"tertiary",className:"d-inline jimu-outline-inside border-0 p-0"},(0,l.jsx)(me,{size:14}))):a))},this.renderTableCount=(e,t)=>{const{bottomResponsiveFlag:i,widgetWidth:a}=this.state,o=i?a-36:a/2,s=l.i18n.getIntl().formatNumber(e,{useGrouping:!0}),n=l.i18n.getIntl().formatNumber(t,{useGrouping:!0});return(0,l.jsx)("div",{ref:"countContainer",className:"position-absolute table-count d-flex align-items-center",style:{maxWidth:o}},(0,l.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate"},this.formatMessage("tableCount",{total:s,selected:n})))},this.onSuggestionConfirm=e=>{this.setState({searchText:e,isShowSuggestion:!1},(()=>{this.handleSubmit()}))},this.clearMessageAction=()=>{const{dataSource:e}=this.state;l.MessageManager.getInstance().publishMessage(new l.DataRecordsSelectionChangeMessage(this.props.id,[],[e.id])),this.setState({emptyData:!1})},this.customShowHideButton=()=>(0,l.jsx)(q,null),this.customShowHideDropdownButton=()=>(0,l.jsx)(ue.Fragment,null,(0,l.jsx)(q,{className:"mr-1"}),this.formatMessage("showHideCols")),this.renderButtonToolList=(t,i)=>{var o;if(!t)return;const{activeTabId:s,selectQueryFlag:n,tableShowColumns:r,mobileFlag:c,emptyTable:u,tableLoaded:h,tableSelected:p,allowDel:v,mapFilterEnabled:g,fullLayersConfig:m}=this.state,{config:b,id:f,enableDataAction:y}=this.props,{tableMode:w,enableMapExtentFilter:x}=b,T=w===e.Map,I=p>0,j=this.getInitFields(),C=m,A=t.layerHonorMode===a.Webmap,M=null===(o=t.tableFields)||void 0===o?void 0:o.map((e=>({value:e.name,label:e.alias}))),{popupAllFields:O,actionUsedFields:D}=S(t,i),L=null==i?void 0:i.getLabel(),F=this.formatMessage("tableDataActionLabel",{layer:L||""}),E=T&&x;return(0,l.jsx)("div",{className:"top-button-list"},t.enableSelect&&(0,l.jsx)("div",{className:"top-button ml-2"},(0,l.jsx)(d.Button,{size:"sm",onClick:this.onShowSelection,icon:!0,title:n?this.formatMessage("showAll"):this.formatMessage("showSelection"),disabled:!h||u||!I},n?(0,l.jsx)(R,null):(0,l.jsx)(te,{autoFlip:!0}))),t.enableSelect&&(0,l.jsx)("div",{className:"top-button ml-2"},(0,l.jsx)(d.Button,{size:"sm",onClick:this.onSelectionClear,icon:!0,title:this.formatMessage("clearSelection"),disabled:!h||u||!I},(0,l.jsx)(H,null))),t.enableRefresh&&(0,l.jsx)("div",{className:"top-button ml-2"},(0,l.jsx)(d.Button,{size:"sm",onClick:this.onTableRefresh,icon:!0,title:this.formatMessage("refresh"),disabled:!h||u},(0,l.jsx)($,null))),v&&(0,l.jsx)("div",{className:"top-button ml-2"},(0,l.jsx)(d.Button,{size:"sm",onClick:this.onDeleteSelection,icon:!0,title:this.formatMessage("deleteRecords"),disabled:!h||u||!I},(0,l.jsx)(de,null))),(0,l.jsx)("div",{className:"top-button ml-2"},(0,l.jsx)(d.AdvancedSelect,{size:"sm",title:this.formatMessage("showHideCols"),buttonProps:{icon:!0,disabled:!h||u,arrow:!1},fluid:!0,staticValues:A?O:M,sortValuesByLabel:!1,isMultiple:!0,selectedValues:r||j,isEmptyOptionHidden:!1,onChange:this.onValueChangeFromRuntime,customDropdownButtonContent:this.customShowHideButton})),E&&(0,l.jsx)(ue.Fragment,null,(0,l.jsx)("span",{className:"tool-dividing-line"}),(0,l.jsx)("div",{className:"top-button mr-2"},(0,l.jsx)(d.Button,{icon:!0,size:"sm",onClick:this.toggleMapFilter,variant:g?"contained":"outlined",color:g?"primary":"default",title:this.formatMessage("enableMapExtentFilter"),"aria-label":this.formatMessage("enableMapExtentFilter"),disabled:!h||u,"aria-pressed":g},(0,l.jsx)(Te,null)))),i&&!c&&y&&(0,l.jsx)(ue.Fragment,null,C.map((e=>e.id===s&&!u?(0,l.jsx)(ue.Fragment,{key:e.id},!E&&(0,l.jsx)("span",{className:"tool-dividing-line"}),(0,l.jsx)("div",{className:"top-button data-action-btn"},(0,l.jsx)(d.DataActionList,{widgetId:f,listStyle:d.DataActionListStyle.Dropdown,dataSets:[{dataSource:i,type:"selected",records:i.getSelectedRecords(),fields:D,name:F}]}))):""))))},this.renderDropdownToolList=(t,i)=>{var o;if(!t)return;const{activeTabId:s,selectQueryFlag:n,tableShowColumns:r,mobileFlag:c,emptyTable:u,tableLoaded:h,tableSelected:p,allowDel:v,mapFilterEnabled:g,fullLayersConfig:m}=this.state,{config:b,id:f,enableDataAction:y}=this.props,{tableMode:w,enableMapExtentFilter:x}=b,T=w===e.Map,I=p>0,j=t.layerHonorMode===a.Webmap,C=null===(o=t.tableFields)||void 0===o?void 0:o.map((e=>({value:e.name,label:e.alias}))),A=this.getInitFields(),M=m,{popupAllFields:O,actionUsedFields:D}=S(t,i),L=null==i?void 0:i.getLabel(),F=this.formatMessage("tableDataActionLabel",{layer:L||""}),E=T&&x;return(0,l.jsx)("div",{className:"d-flex ml-2 dropdown-list-container"},(0,l.jsx)(d.Dropdown,{size:"sm",className:"d-inline-flex dropdown-list"},(0,l.jsx)(d.DropdownButton,{arrow:!1,icon:!0,size:"sm",title:this.formatMessage("options")},(0,l.jsx)(se,null)),(0,l.jsx)(d.DropdownMenu,null,t.enableSelect&&(0,l.jsx)(ue.Fragment,null,(0,l.jsx)(d.DropdownItem,{key:"showSelection",onClick:this.onShowSelection,disabled:!h||u||!I},n?(0,l.jsx)(R,{className:"mr-1"}):(0,l.jsx)(te,{className:"mr-1",autoFlip:!0}),n?this.formatMessage("showAll"):this.formatMessage("showSelection")),(0,l.jsx)(d.DropdownItem,{key:"clearSelection",onClick:this.onSelectionClear,disabled:!h||u||!I},(0,l.jsx)(H,{className:"mr-1"}),this.formatMessage("clearSelection"))),t.enableRefresh&&(0,l.jsx)(d.DropdownItem,{key:"refresh",onClick:this.onTableRefresh,disabled:!h||u},(0,l.jsx)($,{className:"mr-1"}),this.formatMessage("refresh")),v&&(0,l.jsx)(d.DropdownItem,{key:"delete",onClick:this.onDeleteSelection,disabled:!h||u||!I},(0,l.jsx)(de,{className:"mr-1"}),this.formatMessage("deleteRecords")),(0,l.jsx)(d.DropdownItem,{key:"showHideCols",tag:"div",toggle:!1,disabled:!h||u},(0,l.jsx)(d.AdvancedSelect,{size:"sm",title:this.formatMessage("showHideCols"),buttonProps:{arrow:!1,type:"tertiary",className:"p-0 table-hide-hover-color"},fluid:!0,staticValues:j?O:C,sortValuesByLabel:!1,isMultiple:!0,selectedValues:r||A,isEmptyOptionHidden:!1,onChange:this.onValueChangeFromRuntime,customDropdownButtonContent:this.customShowHideDropdownButton})))),i&&c&&(0,l.jsx)(ue.Fragment,null,E&&(0,l.jsx)(ue.Fragment,null,(0,l.jsx)("span",{className:"tool-dividing-line"}),(0,l.jsx)("div",{className:"mobile-map-button mr-2"},(0,l.jsx)(d.Button,{icon:!0,size:"sm",onClick:this.toggleMapFilter,variant:g?"contained":"outlined",color:g?"primary":"default",title:this.formatMessage("enableMapExtentFilter"),"aria-label":this.formatMessage("enableMapExtentFilter"),disabled:!h||u,"aria-pressed":g},(0,l.jsx)(Te,null)))),y&&(0,l.jsx)(ue.Fragment,null,M.map((e=>e.id===s&&!u?(0,l.jsx)(ue.Fragment,{key:e.id},!E&&(0,l.jsx)("span",{className:"tool-dividing-line"}),(0,l.jsx)("div",{className:"horizontal-action-dropdown"},(0,l.jsx)(d.DataActionList,{widgetId:f,listStyle:d.DataActionListStyle.Dropdown,dataSets:[{dataSource:i,type:"selected",records:i.getSelectedRecords(),fields:D,name:F}]}))):"")))))},this.updateViewExtent=e=>{var t,i;const{dataSource:a}=this.state,{id:o}=this.props;if(!this.dsManager.getDataSource(null==a?void 0:a.id))return;const s=null===(i=null===(t=a.getInfo())||void 0===t?void 0:t.widgetQueries)||void 0===i?void 0:i[o];let l;e?l=Object.assign(Object.assign({},s),{geometry:e.toJSON()}):(l=Object.assign({},s),delete l.geometry),a.updateQueryParams(l,o)},this.addViewWatch=e=>{const t=(e||this.state.jimuMapView).view,i=t.extent.clone();this.debounceUpdateViewExtent(i),this.viewWatcher=t.watch("extent",(e=>{this.debounceUpdateViewExtent(e)}))},this.removeViewWatch=()=>{this.viewWatcher&&(this.updateViewExtent(),this.viewWatcher.remove(),this.viewWatcher=null,this.table&&(this.table.filterGeometry=null))},this.visibleChangedListener=t=>Ie(this,void 0,void 0,(function*(){const{config:t}=this.props,{layersConfig:i,mapViewsConfig:a,tableMode:o}=t,s=o===e.Map,l=yield this.getAllLayersConfig(i,a,s);this.setState({fullLayersConfig:l})})),this.viewCreatedListener=t=>Ie(this,void 0,void 0,(function*(){if(t.fromRuntime){const{config:t}=this.props,{layersConfig:i,mapViewsConfig:a,tableMode:o}=t,s=o===e.Map,l=yield this.getAllLayersConfig(i,a,s);this.setState({fullLayersConfig:l})}})),this.viewRemovedListener=t=>Ie(this,void 0,void 0,(function*(){if(t.fromRuntime){const{config:t}=this.props,{layersConfig:i,mapViewsConfig:a,tableMode:o}=t,s=o===e.Map,l=yield this.getAllLayersConfig(i,a,s);this.setState({fullLayersConfig:l})}})),this.onActiveViewChange=t=>Ie(this,void 0,void 0,(function*(){var i;const{activeTabId:a,mapFilterEnabled:o}=this.state,{config:s}=this.props,{layersConfig:l,mapViewsConfig:n,tableMode:r}=s,d=r===e.Map;if(t){if(t&&t.view){yield t.whenJimuMapViewLoaded(),yield t.whenAllJimuLayerViewLoaded(),null==t||t.removeJimuLayerViewsVisibleChangeListener(this.visibleChangedListener),null==t||t.removeJimuLayerViewCreatedListener(this.viewCreatedListener),null==t||t.removeJimuLayerViewRemovedListener(this.viewRemovedListener),this.removeViewWatch(),o&&this.addViewWatch(t),d&&(t.addJimuLayerViewsVisibleChangeListener(this.visibleChangedListener),t.addJimuLayerViewCreatedListener(this.viewCreatedListener),t.addJimuLayerViewRemovedListener(this.viewRemovedListener));const e=yield this.getAllLayersConfig(l,n,d,t);this.setState({fullLayersConfig:e});(!a||e.findIndex((e=>e.id===a))<0)&&e.length>0?this.setState({jimuMapViewId:t.id,activeTabId:null===(i=e[0])||void 0===i?void 0:i.id}):this.setState({jimuMapViewId:t.id})}}else{const e=yield this.getAllLayersConfig(l,n,d,t);this.setState({fullLayersConfig:e,jimuMapViewId:"",activeTabId:""})}this.setState({jimuMapView:t})})),this.state={apiLoaded:!1,dataSource:void 0,activeTabId:void 0,downloadOpen:!1,searchText:"",selectQueryFlag:!1,mobileFlag:!1,searchToolFlag:!1,bottomResponsiveFlag:!1,tableShowColumns:void 0,mapFilterEnabled:(null===(n=t.config)||void 0===n?void 0:n.enableMapExtentFilter)&&(null===(c=t.config)||void 0===c?void 0:c.defaultExtentFilterEnabled),isOpenSearchPopper:!1,emptyTable:!1,emptyData:!1,selectRecords:[],notReady:!1,selfDsChange:!1,showLoading:!1,interval:0,autoRefreshLoadingString:"",isShowSuggestion:!1,searchSuggestion:[],allowDel:!0,tableLoaded:!1,tableTotal:0,tableSelected:0,widgetWidth:(null===(h=null===(u=null==t?void 0:t.manifest)||void 0===u?void 0:u.defaultSize)||void 0===h?void 0:h.width)||600,isTableEditing:!1,exbPrivilege:!1,jimuMapView:void 0,jimuMapViewId:"",fullLayersConfig:[]},this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.dataActionTableRecords={},this.updatingTable=!1,this.removeConfig=!1,this.isCloseTabAction=!1,this.currentRequestId=0,this.viewTableId=0,this.timerFn=null,this.viewWatcher=null,this.debounceOnResize=l.lodash.debounce(((e,t)=>{this.onToolStyleChange(e,t)}),200),this.debounceUpdateViewExtent=l.lodash.debounce((e=>{this.updateViewExtent(e)}),300),this.dsManager=l.DataSourceManager.getInstance(),this.clickTimer=void 0,this.dsAccessibleInfo={}}static getDerivedStateFromProps(t,i){return Ie(this,void 0,void 0,(function*(){var a;const{config:o}=t,{layersConfig:s,mapViewsConfig:l,tableMode:n,enableMapExtentFilter:r,defaultExtentFilterEnabled:d}=o,{activeTabId:c}=i,u=n===e.Map,h=new Ee(t),p=yield h.getAllLayersConfig(s,l,u),v=(!c||p.findIndex((e=>e.id===c))<0)&&p.length>0,g=r&&d;return!u&&v?{mapFilterEnabled:g,fullLayersConfig:p,activeTabId:null===(a=p[0])||void 0===a?void 0:a.id}:{mapFilterEnabled:g,fullLayersConfig:p}}))}componentDidMount(){this.state.apiLoaded||(0,r.loadArcGISJSAPIModules)(["esri/widgets/FeatureTable","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/OrientedImageryLayer","esri/widgets/FeatureTable/support/TableTemplate","esri/geometry/geometryEngine","esri/geometry/Polygon","esri/layers/SubtypeGroupLayer","esri/layers/support/SubtypeSublayer"]).then((t=>{[this.FeatureTable,this.FeatureLayer,this.ImageryLayer,this.OrientedImageryLayer,this.TableTemplate,this.geometryEngine,this.Polygon,this.SubtypeGroupLayer,this.SubtypeSublayer]=t,this.setState({apiLoaded:!0});const{activeTabId:i}=this.state,{config:a}=this.props,{layersConfig:o,mapViewsConfig:s,tableMode:l}=a,n=l===e.Map;this.getAllLayersConfig(o,s,n).then((e=>{var t;(!i||e.findIndex((e=>e.id===i))<0)&&e.length>0?this.setState({fullLayersConfig:e,activeTabId:null===(t=e[0])||void 0===t?void 0:t.id}):this.setState({fullLayersConfig:e}),this.destroyTable().then((()=>{this.createTable()}))}))}))}componentWillUnmount(){const{id:e}=this.props;this.promises.forEach((e=>{e.cancel()})),this.destroyTable(),this.removeViewWatch(),clearTimeout(this.suggestionsQueryTimeout),clearInterval(this.autoRefreshLoadingTime),l.MutableStoreManager.getInstance().updateStateValue(e,"viewInTableObj",{})}componentDidUpdate(t,i){return Ie(this,void 0,void 0,(function*(){var a,o,s,n,r,d,c,u,h,p;const{activeTabId:v,dataSource:g,exbPrivilege:m,fullLayersConfig:b,mapFilterEnabled:f}=this.state,{id:y,config:S,currentPageId:w,state:x,appMode:T,viewInTableObj:I,controllerWidgetId:j}=this.props,{layersConfig:C,mapViewsConfig:A,tableMode:M,enableMapExtentFilter:O,defaultExtentFilterEnabled:D}=S,{fullLayersConfig:L}=i,{config:F,state:E}=t,{layersConfig:N,mapViewsConfig:z,tableMode:P,enableMapExtentFilter:R,defaultExtentFilterEnabled:V}=F,_=M===e.Map;let B;const H=null===(o=null===(a=this.props)||void 0===a?void 0:a.stateProps)||void 0===o?void 0:o.dataActionActiveObj;let W=(null==H?void 0:H.dataActionTable)?null==H?void 0:H.activeTabId:v;const k=!l.lodash.isDeepEqual(C,N)||!l.lodash.isDeepEqual(A,z);(null==H?void 0:H.dataActionTable)||this.removeConfig||k||M!==P?(B=yield this.getAllLayersConfig(C,A,_),this.setState({fullLayersConfig:B})):B=b;(!v||B.findIndex((e=>e.id===v))<0)&&B.length>0?(this.setState({activeTabId:null===(s=B[0])||void 0===s?void 0:s.id}),W=null===(n=B[0])||void 0===n?void 0:n.id,this.props.dispatch(l.appActions.widgetStatePropChange(y,"activeTabId",null===(r=B[0])||void 0===r?void 0:r.id))):_&&this.setState({emptyTable:!1}),O===R&&D===V||this.setState({mapFilterEnabled:O&&D}),this.onSettingChangeRuntime(),this.onFilterChange(W);const U=(null===(c=null===(d=this.props)||void 0===d?void 0:d.stateProps)||void 0===c?void 0:c.settingChangeTab)||!1,$=null===(h=null===(u=this.props)||void 0===u?void 0:u.stateProps)||void 0===h?void 0:h.activeTabId;U&&$&&v!==$&&(this.props.dispatch(l.appActions.widgetStatePropChange(y,"settingChangeTab",!1)),T===l.AppMode.Run&&this.onTagClick($));const Q=x===l.WidgetState.Closed&&E!==l.WidgetState.Closed,G=t.currentPageId!==w,J=t.appMode===l.AppMode.Run&&T===l.AppMode.Design;(Q||G||J)&&this.table&&this.setState({searchText:"",isShowSuggestion:!1},(()=>{this.handleSubmit()})),f&&!i.mapFilterEnabled?this.addViewWatch():!f&&i.mapFilterEnabled&&this.removeViewWatch();const q=L.find((e=>e.id===i.activeTabId)),X=B.find((e=>e.id===W)),K=null===(p=null==X?void 0:X.id)||void 0===p?void 0:p.startsWith("add-data"),Y=this.dsManager.getDataSource(null==g?void 0:g.id);if(this.removeConfig){if(this.removeConfig=!1,this.isCloseTabAction=!0,!X)return}else{this.isCloseTabAction=!1;const e=I&&Object.keys(I);if(!X||!K&&0===(null==e?void 0:e.length)&&!q&&!j)return}const Z=(null==q?void 0:q.enableSearch)&&(null==q?void 0:q.searchFields),ee=(null==X?void 0:X.enableSearch)&&(null==X?void 0:X.searchFields);Z&&!ee&&Y&&g.updateQueryParams(Me,y),(null==X?void 0:X.enableDelete)!==(null==q?void 0:q.enableDelete)&&this.setState({allowDel:m&&(null==X?void 0:X.enableDelete)});const te=[],ie=[];L.forEach((e=>{const t=Object.assign({},e);delete t.headerFontSetting,te.push(t)})),B.forEach((e=>{const t=Object.assign({},e);delete t.headerFontSetting,ie.push(t)}));const ae=!l.lodash.isDeepEqual(i,this.state)&&(!!K||(null==L?void 0:L.length)>0)&&!l.lodash.isDeepEqual(te,ie),oe=this.settingOptionsChange(q,X),se=this.isCloseTabAction||!(null==H?void 0:H.dataActionTable)&&(null==q?void 0:q.id)&&(null==q?void 0:q.id)!==(null==X?void 0:X.id),le=(null==q?void 0:q.id)===(null==X?void 0:X.id)&&oe;if(ae||se||le)return this.isCloseTabAction&&(this.isCloseTabAction=!1),this.updatingTable=!0,void this.setState({searchText:"",isShowSuggestion:!1,tableShowColumns:void 0,tableTotal:0,tableSelected:0,selectQueryFlag:!1},(()=>{var e,t;Y&&(null===(t=null===(e=null==g?void 0:g.getInfo())||void 0===e?void 0:e.widgetQueries)||void 0===t?void 0:t[y])&&(null==g||g.updateQueryParams(Me,y)),this.destroyTable().then((()=>{this.createTable()}))}));(null==H?void 0:H.dataActionTable)&&this.dataActionCanLoad&&!this.updatingTable&&(this.dataActionCanLoad=!1,this.props.dispatch(l.appActions.widgetStatePropChange(y,"dataActionActiveObj",{activeTabId:W,dataActionTable:!1})),this.updatingTable=!0,this.setState({activeTabId:W,searchText:"",tableShowColumns:void 0},(()=>{Y&&(null==g||g.updateQueryParams(Me,y)),this.destroyTable().then((()=>{this.createTable()}))})))}))}destroyTable(){return Ie(this,void 0,void 0,(function*(){this.table&&!this.table.destroyed&&this.table.destroy(),this.refs.tableContainer&&(this.refs.tableContainer.innerHTML=""),yield Promise.resolve()}))}render(){var i,a,o,u;const{activeTabId:h,mobileFlag:p,emptyTable:v,notReady:g,showLoading:b,interval:f,isShowSuggestion:y,searchSuggestion:S,tableTotal:x,tableSelected:T,widgetWidth:I,fullLayersConfig:j}=this.state;let{dataSource:C}=this.state;const{config:A,id:M,theme:O,enableDataAction:D,isHeightAuto:L,isWidthAuto:F,useMapWidgetIds:N}=this.props,{tableMode:z,arrangeType:P}=A,R=z===e.Map,V=j;let _;const B=V.find((e=>e.id===h));(null==B?void 0:B.dataActionDataSource)&&(C=B.dataActionDataSource),V.length>0&&(_=B?B.useDataSource:V[0].useDataSource);const H=(0,l.classNames)("jimu-widget","widget-table","table-widget-"+M);if(0===V.length)return(0,l.jsx)(ue.Fragment,null,(0,l.jsx)(d.WidgetPlaceholder,{widgetId:M,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:Oe,"data-testid":"tablePlaceholder"}),R&&(0,l.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==N?void 0:N[0],onActiveViewChange:this.onActiveViewChange}));const W=P===t.Tabs,k=null==C?void 0:C.getLabel(),U=l.appConfigUtils.getWidgetIdByOutputDataSource(_),$=null===(i=(0,l.getAppStore)().getState())||void 0===i?void 0:i.appConfig,Q=null===(o=null===(a=null==$?void 0:$.widgets)||void 0===a?void 0:a[U])||void 0===o?void 0:o.label,G={id:M,enableDataAction:D,isHeightAuto:L,isWidthAuto:F,headerFontSetting:null==B?void 0:B.headerFontSetting,emptyTable:v,horizontalTag:W,widgetWidth:I},J=(null==B?void 0:B.enableSearch)&&0!==(null===(u=null==B?void 0:B.searchFields)||void 0===u?void 0:u.length),q=p?this.renderDropdownToolList(B,C):this.renderButtonToolList(B,C),X=(null==B?void 0:B.dataActionObject)&&B.dataActionType===s.View;return(0,l.jsx)("div",{className:H,css:m(O,p,J,G),ref:e=>{this.refs.currentEl=e}},(0,l.jsx)("div",{className:"surface-1 border-0 h-100"},(0,l.jsx)("div",{className:"table-indent"},V&&h&&(0,l.jsx)("div",{className:"d-flex "+(W?"horizontal-tag-list":"dropdown-tag-list")},W?(0,l.jsx)(ue.Fragment,null,(0,l.jsx)(d.Tabs,{type:"underline",onChange:this.onTagClick,className:"tab-flex",value:h,onClose:this.onCloseTab,scrollable:!0},V.map((e=>{const t=!!e.dataActionObject;return(0,l.jsx)(d.Tab,{key:e.id,id:e.id,title:e.name,className:"text-truncate tag-size",closeable:t},(0,l.jsx)("div",{className:"mt-2"}))})))):(0,l.jsx)(d.Select,{size:"sm",value:h,onChange:this.handleTagChange,className:"top-drop"},V.map((e=>(0,l.jsx)("option",{key:e.id,value:e.id,title:e.name},(0,l.jsx)("div",{className:"table-action-option"},(0,l.jsx)("div",{className:"table-action-option-tab",title:e.name},e.name),e.dataActionObject&&(0,l.jsx)("div",{className:"table-action-option-close"},(0,l.jsx)(d.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>{this.onCloseTab(e.id,t)}},(0,l.jsx)(E,{size:"s"})))))))),!J&&q),(0,l.jsx)("div",{className:""+(P===t.Tabs?"horizontal-render-con":"dropdown-render-con")},(0,l.jsx)("div",{className:"table-header",ref:"suggestPopup"},J&&this.renderSearchTools(null==B?void 0:B.searchHint),J&&(0,l.jsx)(d.Popper,{css:l.css`
    & {
      max-height: ${l.polished.rem(300)};
      min-width: ${l.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:this.refs.suggestPopup,offset:[0,-2],open:y,trapFocus:!1,autoFocus:!1,toggle:e=>{this.setState({isShowSuggestion:!y})}},S.map(((e,t)=>{const i=Le.sanitize(e.suggestionHtml);return(0,l.jsx)(d.Button,{key:t,type:"secondary",size:"sm",onClick:()=>{this.onSuggestionConfirm(e.suggestion)}},(0,l.jsx)("div",{className:"w-100",dangerouslySetInnerHTML:{__html:i}}))}))),J&&q),v&&(0,l.jsx)("div",{className:"placeholder-table-con"},(0,l.jsx)(d.WidgetPlaceholder,{icon:c(59374),message:this.formatMessage("noData")}),g&&(0,l.jsx)("div",{className:"placeholder-alert-con"},(0,l.jsx)(d.Alert,{form:"tooltip",size:"small",type:"warning",text:this.formatMessage("outputDataIsNotGenerated",{outputDsLabel:k,sourceWidgetName:Q})}))),(0,l.jsx)("div",{ref:"tableContainer",className:"table-con"}),(null==B?void 0:B.updateText)&&(b||f>0)&&this.renderLoading(b,f),(null==B?void 0:B.showCount)&&this.renderTableCount(x,T),R&&(0,l.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==N?void 0:N[0],onActiveViewChange:this.onActiveViewChange}),(0,l.jsx)("div",{className:"ds-container"},(C||_)&&(0,l.jsx)(l.DataSourceComponent,{widgetId:M,useDataSource:(0,l.Immutable)(_),dataSource:X?C:null,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onQueryRequired:this.onQueryRequired,onCreateDataSourceFailed:e=>{this.onCreateDataSourceFailed(_)}})),(0,l.jsx)(n.Global,{styles:w(O)})))),(0,l.jsx)(l.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize}))}}Ee.versionManager=v,Ee.mapExtraStateProps=(e,t)=>{var i,a,o,s,l,n,r,d,c,u,h,p,v,m,b,f,y,S,w,x,T,I,j,C,A;const{layoutId:M,layoutItemId:O,id:D}=t,L=null===(a=null===(i=null==e?void 0:e.appConfig)||void 0===i?void 0:i.widgets)||void 0===a?void 0:a[D],F=null==L?void 0:L.enableDataAction,E=null===(o=(e&&e.appConfig).layouts)||void 0===o?void 0:o[M],N=null===(l=null===(s=null==E?void 0:E.content)||void 0===s?void 0:s[O])||void 0===l?void 0:l.setting,z=(null===(n=null==N?void 0:N.autoProps)||void 0===n?void 0:n.height)===g.LayoutItemSizeModes.Auto||!0===(null===(r=null==N?void 0:N.autoProps)||void 0===r?void 0:r.height),P=(null===(d=null==N?void 0:N.autoProps)||void 0===d?void 0:d.width)===g.LayoutItemSizeModes.Auto||!0===(null===(c=null==N?void 0:N.autoProps)||void 0===c?void 0:c.width),R={},V=null===(u=null==t?void 0:t.mutableStateProps)||void 0===u?void 0:u.viewInTableObj;for(const e in V){const t=null===(m=null===(v=null===(p=null===(h=V[e])||void 0===h?void 0:h.daLayerItem)||void 0===p?void 0:p.dataActionDataSource)||void 0===v?void 0:v.dataSourceJson)||void 0===m?void 0:m.label;t&&(V[e].daLayerItem.name=t);const i=null===(y=null===(f=null===(b=V[e])||void 0===b?void 0:b.daLayerItem)||void 0===f?void 0:f.dataActionDataSource)||void 0===y?void 0:y.id,a=null===(x=null===(w=null===(S=V[e])||void 0===S?void 0:S.daLayerItem)||void 0===w?void 0:w.dataActionDataSource)||void 0===x?void 0:x.getInfo();R[`runtime-usedDs-info_${i}`]=a}return Object.assign(Object.assign({appMode:null===(T=null==e?void 0:e.appRuntimeInfo)||void 0===T?void 0:T.appMode,isRTL:null===(I=null==e?void 0:e.appContext)||void 0===I?void 0:I.isRTL,stateShowLoading:null===(C=null===(j=null==e?void 0:e.widgetsState)||void 0===j?void 0:j[t.id])||void 0===C?void 0:C.showLoading,currentPageId:null===(A=null==e?void 0:e.appRuntimeInfo)||void 0===A?void 0:A.currentPageId,viewInTableObj:V,enableDataAction:void 0===F||F},R),{isHeightAuto:z,isWidthAuto:P})};const Ne=Ee;function ze(e){c.p=e}})(),u})())}}}));