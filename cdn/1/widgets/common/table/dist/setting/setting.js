System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-core/react","jimu-ui/basic/list-tree","jimu-for-builder","jimu-ui/basic/color-picker","jimu-layouts/layout-runtime","jimu-ui/advanced/style-setting-components","jimu-arcgis"],(function(e,t){var i={},a={},s={},o={},n={},l={},r={},c={},d={},u={},p={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.CONSTANTS=e.CONSTANTS,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.React=e.React,i.classNames=e.classNames,i.css=e.css,i.hooks=e.hooks,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.ConfirmDialog=e.ConfirmDialog,a.DistanceUnits=e.DistanceUnits,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.Radio=e.Radio,a.Select=e.Select,a.Switch=e.Switch,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.JimuLayerViewSelector=e.JimuLayerViewSelector,s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){o.DataSourceSelector=e.DataSourceSelector,o.FieldSelector=e.FieldSelector,o.FieldSelectorWithFullTextIndex=e.FieldSelectorWithFullTextIndex,o.dataComponentsUtils=e.dataComponentsUtils},function(e){n.Fragment=e.Fragment,n.createRef=e.createRef,n.useCallback=e.useCallback,n.useEffect=e.useEffect,n.useMemo=e.useMemo,n.useRef=e.useRef,n.useState=e.useState},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){r.builderAppSync=e.builderAppSync},function(e){c.ThemeColorPicker=e.ThemeColorPicker},function(e){d.defaultMessages=e.defaultMessages},function(e){u.FontStyle=e.FontStyle,u.InputUnit=e.InputUnit},function(e){p.JimuMapViewComponent=e.JimuMapViewComponent,p.LayerTypes=e.LayerTypes,p.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},778:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.829 2.535a.909.909 0 0 0-1.657 0L2.291 13.356a.456.456 0 0 0 .831.377L4.818 10h6.365l1.696 3.733a.456.456 0 0 0 .831-.377zM5.272 9 8 3l2.729 6z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},8377:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMzgiIGhlaWdodD0iOCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTQiIHk9IjE0IiB3aWR0aD0iMjgiIGhlaWdodD0iNCIgZmlsbD0iIzE4MTgxOCIvPg0KPHBhdGggZD0iTTQ0IDE1SDQ4TDQ2IDE3TDQ0IDE1WiIgZmlsbD0iIzE4MTgxOCIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},79226:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iODUiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iMTYiIGhlaWdodD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTIiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMzAiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNDgiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},62686:e=>{"use strict";e.exports=p},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=n},4108:e=>{"use strict";e.exports=r},41496:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=a},13089:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=s},15562:e=>{"use strict";e.exports=u},54337:e=>{"use strict";e.exports=c},98640:e=>{"use strict";e.exports=l}},t={};function g(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,g),s.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var i in t)g.o(t,i)&&!g.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var h={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(h),g.d(h,{__set_webpack_public_path__:()=>je,default:()=>De});var e,t,i,a,s,o,n=g(79244),l=g(14321),r=g(79298),c=g(13089);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(i||(i={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(a||(a={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(s||(s={})),function(e){e.View="VIEW",e.Add="ADD"}(o||(o={}));const d={newSheet:"New sheet",sheetStyle:"Arrangement style",layerConfig:"Sheet configuration",enableAttachments:"Show attachments",enableSearch:"Search",searchFields:"Select searching fields",fullMatch:"Exact match",allowCsv:"Allow exporting to CSV",enableSelect:"Select records",enableEdit:"Allow editing",showCount:"Show record count",enableRefresh:"Refresh",configFields:"Configure fields",dropdown:"Dropdown",configTips:"Select fields for initial display",tableBlankStatus:'Click the "{SheetString}" button to add and configure data sheets.',selectFields:"Select fields",checkAll:"Check all",uncheckAll:"Uncheck all",editable:"Editable",editableCount:"{count} Editable",tableOptions:"Table options",columnSize:"Column sizing",fitToData:"Fit to data",columnWidth:"Column width",updateText:"Last update text",layerHonorSetting:"Use layer settings",layerCustomize:"Customize",deleteRecords:"Delete records",noMapSelectedTips:"Select a map for further configurations.",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",enableMapExtentFilter:"Filter by map extent",selectLayers:"Select layers",enableSyncVisibilities:"Synchronize with layer visibilities"};var u=g(68972),p=g(98640),m=g(4108),I=g(73529),f=g.n(I),y=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const S=e=>{const t=window.SVG,{className:i}=e,a=y(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:f()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var b=g(26490),v=g.n(b),M=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const D=e=>{const t=window.SVG,{className:i}=e,a=M(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:v()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var j=g(778),C=g.n(j),w=g(54337),x=g(41496),T=g(15562);const{OUTPUT_DATA_VIEW_ID:N}=n.CONSTANTS,O=["bold"];class L extends n.React.PureComponent{constructor(e){super(e),this.partSupportedDsTypes=(0,n.Immutable)([n.AllDataSourceTypes.FeatureLayer,n.AllDataSourceTypes.SceneLayer,n.AllDataSourceTypes.BuildingComponentSubLayer,n.AllDataSourceTypes.OrientedImageryLayer,n.AllDataSourceTypes.ImageryLayer,n.AllDataSourceTypes.SubtypeSublayer]),this.supportedDsTypes=(0,n.Immutable)([n.AllDataSourceTypes.FeatureLayer,n.AllDataSourceTypes.SceneLayer,n.AllDataSourceTypes.WebMap,n.AllDataSourceTypes.WebScene,n.AllDataSourceTypes.MapService,n.AllDataSourceTypes.FeatureService,n.AllDataSourceTypes.SceneService,n.AllDataSourceTypes.GroupLayer,n.AllDataSourceTypes.BuildingComponentSubLayer,n.AllDataSourceTypes.BuildingGroupSubLayer,n.AllDataSourceTypes.BuildingSceneLayer,n.AllDataSourceTypes.OrientedImageryLayer,n.AllDataSourceTypes.ImageryLayer]),this.batchDsTypes=(0,n.Immutable)([n.AllDataSourceTypes.WebMap,n.AllDataSourceTypes.WebScene,n.AllDataSourceTypes.MapService,n.AllDataSourceTypes.FeatureService,n.AllDataSourceTypes.SceneService,n.AllDataSourceTypes.GroupLayer,n.AllDataSourceTypes.BuildingGroupSubLayer,n.AllDataSourceTypes.BuildingSceneLayer,n.AllDataSourceTypes.SubtypeGroupLayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[],t)=>{let i,a=!1;if(this.state)i=this.state.dataSource;else{if(!t)return a;const{isMapMode:e}=this.props,s=t.lastIndexOf("-"),o=e?t:t.substring(0,s);i=n.DataSourceManager.getInstance().getDataSource(o)}const s=null==i?void 0:i.getLayerDefinition();return e.forEach((e=>{const t=this.getFieldEditable(s,e.jimuName);!e.editAuthority&&t&&(a=!0)})),a},this.handleCheckboxChange=e=>{const t=e.currentTarget;if(t)if("enableEdit"===t.dataset.field){const{tableFields:e}=this.props,i=e.map((e=>Object.assign(Object.assign({},e),{editAuthority:e.editable})));this.props.multiOptionsChange({enableEdit:t.checked,tableFields:i})}else this.props.optionChange(t.dataset.field,t.checked)},this.changeMatchType=(e,t)=>{this.props.optionChange("searchExact",t)},this.formatMessage=(e,t)=>{const i=Object.assign({},d,l.defaultMessages,x.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.displaySelectedFields=e=>this.formatMessage("numSelected",{number:e.length}),this.filterSearchFields=e=>{const{searchFields:t}=this.props,i=e.map((e=>e.jimuName));return t.filter((e=>i.includes(e)))},this.getFieldEditable=(e,t)=>{const i=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!i||(null==i?void 0:i.editable)},this.mergeArray=(e,t)=>{const i=e.concat(t),a=new Set(i);return Array.from(a)},this.onFieldChange=e=>{if(!e)return;const{dataSource:t}=this.state,{id:i,isMapMode:a,useDataSource:s,tableFields:o,orgUseDataSources:l,multiOptionsChange:r,onDataSourceFieldsChange:c,multiOptionsAndUseDsChange:d}=this.props,u=null==t?void 0:t.getLayerDefinition(),p=e.filter((e=>e)).map((e=>{const t=this.getFieldEditable(u,e.jimuName),i=o.find((t=>t.jimuName===e.jimuName)),a=!i||(null==i?void 0:i.visible),s=i?null==i?void 0:i.editAuthority:t;return Object.assign(Object.assign({},e),{editAuthority:s,editable:t,visible:a})})),g=this.filterSearchFields(p),h=e.map((e=>e.jimuName)),m={searchFields:g,tableFields:p};if(a){const e=null==l?void 0:l.findIndex((e=>(null==e?void 0:e.dataSourceId)===(null==s?void 0:s.dataSourceId)));if(void 0===e||e<0)return;const t=l.asMutable({deep:!0}),i=l[e],a=(0,n.Immutable)(i).set("fields",h).set("useFieldsInPopupInfo",!1);t[e]=a.asMutable({deep:!0}),d(m,t)}else c(s,{id:i,usedFields:h}),r(m)},this.onDataSourceCreated=e=>{this.setState({dataSource:e},(()=>{this.checkIsDsAutoRefreshSettingOpen(e)&&this.props.optionChange("updateText",!0)}))},this.onDataSourceInfoChange=e=>{e&&this.state.dataSource&&this.checkIsDsAutoRefreshSettingOpen(this.state.dataSource)&&this.props.optionChange("updateText",!0)},this.getSearchingFields=()=>{const e=[],{tableFields:t}=this.props;return t.length>0&&t.forEach((t=>{t.type===n.JimuFieldType.String&&e.push({value:t.jimuName||t.name,label:t.alias||t.name})})),e},this.handleChooseSearchingFieldsChange=e=>{const{widgetId:t}=this.props;0===e.length&&m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"optionChangeSuggestion",value:!0}),this.props.optionChange("searchFields",e.map((e=>e.name)))},this.onSearchPlaceholderChange=e=>{var t;const i=e.target.value;(null===(t=this.props)||void 0===t?void 0:t.searchHint)!==i&&this.props.optionChange("searchHint",i)},this.getSelectModeOptions=()=>[(0,n.jsx)("option",{key:i.Single,value:i.Single},this.formatMessage("single")),(0,n.jsx)("option",{key:i.Multiple,value:i.Multiple},this.formatMessage("multiple"))],this.getFieldsFromDataSource=()=>{const{useDataSource:e}=this.props,t=n.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),i=null==t?void 0:t.getSchema(),a=(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[],s=["CreationDate","Creator","EditDate","Editor","GlobalID"],o=null==t?void 0:t.getLayerDefinition(),l=(null==o?void 0:o.fields)||[];let r=a.filter((e=>!s.includes(e.jimuName))).map((e=>{const t=l.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i,visible:!0})}));return(null==r?void 0:r.length)>50&&(r=r.slice(0,50)),{allFields:a,tableFields:r}},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.handleHonorTypeChange=e=>{const{isMapMode:t,multiOptionsAndUseDsChange:i,tableFields:s,orgUseDataSources:o,useDataSource:l}=this.props,r={layerHonorMode:e,enableDelete:!1};if(t){const t=null==o?void 0:o.findIndex((e=>(null==e?void 0:e.dataSourceId)===(null==l?void 0:l.dataSourceId)));if(void 0===t||t<0)return;const c=o.asMutable({deep:!0});if(e===a.Custom){const e=s.map((e=>e.jimuName)),i=o[t],a=(0,n.Immutable)(i).set("fields",e).set("useFieldsInPopupInfo",!1);c[t]=a.asMutable({deep:!0})}else{const e=o[t],i=(0,n.Immutable)(e).set("fields",[]).set("useFieldsInPopupInfo",!0);c[t]=i.asMutable({deep:!0})}i(r,c)}else this.props.multiOptionsChange(r)},this.handleListBoxAll=(e,t)=>{const{tableFields:i}=this.props,a=i.map((i=>{const a=this.getFieldEditable(t,i.jimuName);return Object.assign(Object.assign({},i),{editAuthority:!!a&&e})}));this.setState({hasUncheck:!e}),this.props.optionChange("tableFields",a)},this.getCurrentEditField=e=>{const{tableFields:t}=this.props;return t.find((t=>t.jimuName===e))},this.toggleFieldVisible=e=>{const{tableFields:t}=this.props,i=t.findIndex((t=>t.jimuName===e)),a=t[i].visible;t[i].visible=!a,this.props.optionChange("tableFields",t)},this.onKeyUp=(e,t)=>{e&&"Enter"===e.key&&this.toggleFieldVisible(t)},this.handleColumnStyleChange=(e,t)=>{const{columnSetting:i}=this.props;if(i)i[e]=t,this.props.optionChange("columnSetting",i);else{const i={responsiveType:s.Fixed,columnWidth:200};i[e]=t,this.props.optionChange("columnSetting",i)}},this.handleHeaderStyleChange=(e,t)=>{const{headerFontSetting:i}=this.props;if(i)i[e]=t,this.props.optionChange("headerFontSetting",i);else{const i={backgroundColor:"",fontSize:14,bold:!1,color:""};i[e]=t,this.props.optionChange("headerFontSetting",i)}},this.checkIsDsAutoRefreshSettingOpen=e=>{if(!e)return!1;return((null==e?void 0:e.getAutoRefreshInterval())||0)>0},this.getDsCapabilities=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.onFilterDs=e=>{let t=!1;if(this.batchDsTypes.includes(e.type)){const i=this.dsManager.getDataSource(e.id),a=(i.isDataSourceSet()?i.getAllChildDataSources():[]).filter((e=>this.partSupportedDsTypes.includes(e.type)));0===(null==a?void 0:a.length)&&(t=!0)}return t},this.state={dataSource:void 0,itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.tableFields,e.id)},this.colRef=n.React.createRef(),this.dsManager=n.DataSourceManager.getInstance()}componentDidUpdate(e,t){const{name:i,useDataSource:a,tableFields:s,optionChange:o}=this.props;if(i!==e.name&&this.setState({itemLabel:this.props.name||""}),!s)return;const n=this.dsManager.getDataSource(null==a?void 0:a.dataSourceId);if(!n)return;const l=null==n?void 0:n.getSchema();let r=!1;const c=((null==l?void 0:l.fields)?Object.values(null==l?void 0:l.fields):[]).map((e=>e.jimuName));for(const e of s)if(!c.includes(e.jimuName)){r=!0;break}if(r){const{tableFields:e}=this.getFieldsFromDataSource();o("tableFields",e)}}getStyle(e){return n.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: 100%;
          overflow: auto;
          .fields-list-header {
            background: ${e.ref.palette.neutral[300]};
            border-bottom: 1px solid ${e.ref.palette.neutral[600]};
            height: 34px;
            width: 100%;
            flex-wrap: nowrap;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 265px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.ref.palette.neutral[300]};
              border-bottom: 1px solid ${e.ref.palette.neutral[400]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.ref.palette.neutral[300]};
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
          .last-setting-section {
            border-bottom: unset;
          }
        }
      }
    `}render(){var e,t;const{useDataSource:o,optionChange:d,theme:g,appTheme:h,tableFields:I,searchFields:f,searchExact:y,searchHint:b,enableEdit:v,enableSearch:M,widgetId:j,dataSourceChange:x,headerFontSetting:L,columnSetting:z,updateText:P,id:k,layerHonorMode:A,newAddFlag:F,isMapMode:H}=this.props,{dataSource:R,itemLabel:W,hasUncheck:B}=this.state,E=R&&R.getLayerDefinition(),V=null==R?void 0:R.getSchema(),Y=null==I?void 0:I.map((e=>{var t;const i=(null===(t=null==V?void 0:V.fields)||void 0===t?void 0:t[e.jimuName])||{};return Object.assign(Object.assign({},e),i)})),J=[];I&&I.length>0&&I.forEach((e=>{J.push(e.jimuName)}));const{allFields:Q}=this.getFieldsFromDataSource(),U=(null==R?void 0:R.url)&&(null==R?void 0:R.dataViewId)!==N,K=null==E?void 0:E.capabilities,G=this.getDsCapabilities(K,"update")&&U,Z=this.getDsCapabilities(K,"delete")&&U,_=A===a.Custom,$=_?v&&Z:Z,q={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemContent,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:p.TreeItemActionType.RenderOverrideItemIcon},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:p.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})};let X=0;null==Y||Y.forEach((e=>{(null==e?void 0:e.editAuthority)&&X++}));const ee=this.formatMessage("visible"),te=this.formatMessage("invisible");return(0,n.jsx)("div",{className:"w-100 h-100",css:this.getStyle(g)},(0,n.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,n.jsx)("div",{className:"setting-container"},(0,n.jsx)(r.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(c.DataSourceSelector,{types:this.partSupportedDsTypes,disableRemove:()=>!0,disableDataSourceList:H,hideDataView:H,useDataSources:o?(0,n.Immutable)([o]):(0,n.Immutable)([]),mustUseDataSource:!0,onChange:x,closeDataSourceListOnChange:!0,hideDs:this.onFilterDs,isMultiple:F,isBatched:!0})),o&&this.checkIsDsAutoRefreshSettingOpen(R)&&(0,n.jsx)(r.SettingRow,{label:this.formatMessage("updateText")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:P,onChange:e=>{d("updateText",e.target.checked)},"aria-label":this.formatMessage("updateText")}))),o&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(r.SettingSection,{title:this.formatMessage("label")},(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(l.TextInput,{type:"text",size:"sm",className:"w-100",value:W,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,n.jsx)(r.SettingSection,{title:this.formatMessage("configFields")},(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(l.Select,{size:"sm",className:"w-100",value:A,onChange:e=>{this.handleHonorTypeChange(e.target.value)}},(0,n.jsx)("option",{value:a.Webmap},this.formatMessage("layerHonorSetting")),(0,n.jsx)("option",{value:a.Custom},this.formatMessage("layerCustomize")))),_&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(r.SettingRow,null,this.formatMessage("configTips")),(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(c.FieldSelector,{useDataSources:o?(0,n.Immutable)([o]):(0,n.Immutable)([]),"aria-label":this.formatMessage("configTips"),onChange:this.onFieldChange,selectedFields:(0,n.Immutable)(J),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),(0,n.jsx)(r.SettingRow,{flow:"wrap",label:v&&this.formatMessage("editableCount",{count:X})},(0,n.jsx)("div",{className:"fields-list-header form-inline"},(0,n.jsx)("div",{className:"d-flex w-100 ml-1 fields-list-check"},v&&(0,n.jsx)(l.Checkbox,{id:"editAllField","data-field":"editAllField",onClick:()=>{this.handleListBoxAll(B,E)},checked:!B,title:B?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,n.jsx)(l.Label,{for:"editAllField",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))))),(0,n.jsx)(r.SettingRow,{className:"selected-fields-con"},(0,n.jsx)(p.List,Object.assign({className:"selected-fields-list",itemsJson:Array.from(Y).map(((e,t)=>Object.assign(Object.assign({itemStateDetailContent:e},v?{itemStateChecked:null==e?void 0:e.editAuthority}:{}),{itemStateDisabled:!this.checkFieldsExist(Q,e),itemKey:`${t}`,itemStateIcon:c.dataComponentsUtils.getIconFromFieldType(e.type,g),itemStateTitle:e.alias||e.jimuName||e.name,isCheckboxDisabled:!this.getFieldEditable(E,e.jimuName),itemStateCommands:[]}))),dndEnabled:!0,isMultiSelection:v,onUpdateItem:(e,t)=>{const{itemJsons:i,updateType:a}=e;if(v||a===p.TreeItemActionType.HandleDidDrop){const e=i[i.length-1].map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})));d("tableFields",e);const t=this.getUncheckState(e);this.setState({hasUncheck:t})}},renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:i,itemJsons:[{itemStateDetailContent:a}]}=t.props,[s]=i,{jimuName:o}=null==s?void 0:s.itemStateDetailContent,r=this.getCurrentEditField(o);return a?(0,n.jsx)(u.Fragment,null,(0,n.jsx)(l.Button,{icon:!0,type:"tertiary",title:r.visible?ee:te,"aria-label":r.visible?ee:te,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),this.toggleFieldVisible(o)},onKeyUp:e=>{this.onKeyUp(e,o)},css:()=>n.css`
                                &.jimu-tree-item__detail-toggle {
                                  display: flex;
                                  align-items: center;
                                  cursor: pointer;

                                  .icon-btn-sizer {
                                    margin: 0;
                                    min-width: 0.5rem;
                                    min-height: 0.5rem;
                                  }
                                }
                              `},r.visible?(0,n.jsx)(S,null):(0,n.jsx)(D,null))):null}},q))),G&&(0,n.jsx)(r.SettingRow,null,(0,n.jsx)("div",{className:"d-flex w-100"},(0,n.jsx)(l.Checkbox,{id:"editable-cb","data-field":"enableEdit",onClick:this.handleCheckboxChange,checked:v}),(0,n.jsx)(l.Label,{for:"editable-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("enableEdit")},this.formatMessage("enableEdit")))))),(0,n.jsx)(r.SettingSection,{role:"group",title:this.formatMessage("tableOptions"),"aria-label":this.formatMessage("tableOptions")},(0,n.jsx)(r.SettingRow,{label:(0,n.jsx)("strong",null,this.formatMessage("columnSize")),flow:"wrap",role:"group","aria-label":this.formatMessage("columnSize")},(0,n.jsx)("div",{className:"jimu-builder--background-setting"},(0,n.jsx)("div",{role:"radiogroup"},(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"responsiveType",className:"mr-2",checked:(null==z?void 0:z.responsiveType)===s.Fit,onChange:()=>{this.handleColumnStyleChange("responsiveType",s.Fit)}}),this.formatMessage("fitToData")),(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"displayOrderType",className:"mr-2",checked:(null==z?void 0:z.responsiveType)===s.Fixed,onChange:()=>{this.handleColumnStyleChange("responsiveType",s.Fixed)}}),this.formatMessage("fixed"))),(null==z?void 0:z.responsiveType)===s.Fixed&&(0,n.jsx)(r.SettingRow,{label:this.formatMessage("columnWidth")},(0,n.jsx)(T.InputUnit,{style:{width:"35%"},"aria-label":this.formatMessage("columnWidth"),min:80,max:8192,value:{distance:null!==(e=null==z?void 0:z.columnWidth)&&void 0!==e?e:80,unit:l.DistanceUnits.PIXEL},onChange:({distance:e})=>{this.handleColumnStyleChange("columnWidth",e)}})))),(0,n.jsx)(r.SettingRow,{label:(0,n.jsx)("strong",null,this.formatMessage("variableHeader")),flow:"wrap",role:"group","aria-label":this.formatMessage("variableHeader")},(0,n.jsx)("div",{className:"jimu-builder--background-setting"},(0,n.jsx)(r.SettingRow,{truncateLabel:!0,flow:"no-wrap",role:"group",label:this.formatMessage("font"),"aria-label":this.formatMessage("font"),className:"mt-2"},(0,n.jsx)(T.FontStyle,{"aria-label":this.formatMessage("fontStyle"),bold:null==L?void 0:L.bold,types:O,onChange:this.handleHeaderStyleChange}),(0,n.jsx)(w.ThemeColorPicker,{icon:C(),type:"with-icon",title:this.formatMessage("fontColor"),"aria-label":this.formatMessage("fontColor"),specificTheme:h,value:null==L?void 0:L.color,onChange:e=>{this.handleHeaderStyleChange("color",e)},className:"jimu-outline-inside"}),(0,n.jsx)(T.InputUnit,{style:{width:"35%"},"aria-label":this.formatMessage("fontSize"),min:12,max:99,value:{distance:null!==(t=null==L?void 0:L.fontSize)&&void 0!==t?t:14,unit:l.DistanceUnits.PIXEL},onChange:({distance:e})=>{this.handleHeaderStyleChange("fontSize",e)}})),(0,n.jsx)(r.SettingRow,{label:this.formatMessage("backgroundColor")},(0,n.jsx)(w.ThemeColorPicker,{text:!0,specificTheme:h,"aria-label":this.formatMessage("backgroundColor"),value:null==L?void 0:L.backgroundColor,onChange:e=>{this.handleHeaderStyleChange("backgroundColor",e)}}))))),(0,n.jsx)(r.SettingSection,{role:"group",className:"last-setting-section",title:this.formatMessage("tools"),"aria-label":this.formatMessage("tools")},(0,n.jsx)(r.SettingRow,{label:this.formatMessage("enableSearch")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:M||!1,onChange:e=>{const t=e.target.checked;m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:j,propKey:"optionChangeSuggestion",value:!0}),d("enableSearch",t)},"aria-label":this.formatMessage("enableSearch")})),M&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("searchFields")},(0,n.jsx)("div",{className:"w-100 search-container",style:{zIndex:3}},(0,n.jsx)(c.FieldSelectorWithFullTextIndex,{useDataSources:o?(0,n.Immutable)([o]):(0,n.Immutable)([]),onChange:this.handleChooseSearchingFieldsChange,selectedFields:f?(0,n.Immutable)(f):(0,n.Immutable)([]),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,widgetId:k,types:(0,n.Immutable)([n.JimuFieldType.Number,n.JimuFieldType.String]),"aria-label":this.formatMessage("searchFields")}))),(0,n.jsx)(r.SettingRow,{className:"w-100 d-flex justify-content-between"},(0,n.jsx)(l.Label,null,(0,n.jsx)(l.Checkbox,{style:{cursor:"pointer"},checked:y,"aria-label":this.formatMessage("fullMatch"),onChange:this.changeMatchType}),(0,n.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},this.formatMessage("fullMatch")))),(0,n.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("searchHint")},(0,n.jsx)(l.TextInput,{size:"sm",className:"search-placeholder w-100",placeholder:this.formatMessage("search"),value:b||"",onChange:this.onSearchPlaceholderChange,"aria-label":this.formatMessage("searchHint")}))),["enableSelect","showCount","enableRefresh"].map(((e,t)=>(0,n.jsx)(u.Fragment,{key:t},(0,n.jsx)(r.SettingRow,{label:this.formatMessage(e)},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:this.props[e]||!1,onChange:t=>{d(e,t.target.checked)},"aria-label":this.formatMessage(e)})),"enableSelect"===e&&this.props[e]&&(0,n.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("selectMode"),className:"select-option"},(0,n.jsx)(l.Select,{size:"sm",value:this.props.selectMode||i.Multiple,onChange:e=>{d("selectMode",e.target.value)},"aria-label":this.formatMessage("selectMode")},this.getSelectModeOptions()))))),$&&(0,n.jsx)(r.SettingRow,{label:this.formatMessage("deleteRecords")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:this.props.enableDelete||!1,onChange:e=>{d("enableDelete",e.target.checked)},"aria-label":this.formatMessage("deleteRecords")}))),(0,n.jsx)("div",{className:"ds-container"},(0,n.jsx)(n.DataSourceComponent,{useDataSource:(0,n.Immutable)(o),onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange}))))))}}class z extends n.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,n.jsx)(n.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var P=g(62838),k=g.n(P),A=g(31027),F=g.n(A),H=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const R=e=>{const t=window.SVG,{className:i}=e,a=H(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:F()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var W=g(62686);function B(e){return n.css`
    .widget-setting-table {
      .filter-item {
        display: flex;
        padding: 0.5rem 0.75rem;
        margin-bottom: 0.25rem;
        line-height: 23px;
        cursor: pointer;
        background-color: ${e.sys.color.secondary.main};

        .filter-item-icon {
          width: 14px;
          margin-right: 0.5rem;
        }
        .filter-item-name {
          word-wrap: break-word;
        }
      }

      .filter-item-active {
        border-left: 2px solid ${e.sys.color.primary.main};
      }

      .arrange-style-container {
        .arrange_container {
          margin-top: 10px;
          display: flex;
          .jimu-btn {
            padding: 0;
            background: ${e.ref.palette.neutral[300]};
            &.active {
              border: 2px solid ${e.sys.color.primary.light};
            }
          }
        }
      }
      .empty-placeholder {
        display: flex;
        flex-flow: column;
        justify-content: center;
        height: calc(100% - 255px);
        overflow: hidden;
        .empty-placeholder-inner {
          padding: 0px 20px;
          flex-direction: column;
          align-items: center;
          display: flex;

          .empty-placeholder-text {
            color: ${e.ref.palette.neutral[1e3]};
            font-size: ${n.polished.rem(14)};
            margin-top: 16px;
            text-align: center;
          }
          .empty-placeholder-icon {
            color: ${e.ref.palette.neutral[800]};
          }
        }
      }

      .setting-ui-unit-tree, .setting-ui-unit-list {
        width: 100%;
        .tree-item {
          justify-content: space-between;
          align-items: center;
          font-size: ${n.polished.rem(13)};
          &.tree-item_level-1 {
          }
          .jimu-checkbox {
            margin-right: .5rem;
          }
        }
      }
      .setting-ui-unit-list-new {
        padding-top: ${n.polished.rem(8)};
      }
    }
  `}var E=g(53195),V=g.n(E),Y=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const J=e=>{const t=window.SVG,{className:i}=e,a=Y(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:V()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var Q=g(72529),U=g.n(Q),K=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const G=e=>{const t=window.SVG,{className:i}=e,a=K(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:U()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var Z=g(93303),_=g.n(Z),$=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const q=e=>{const t=window.SVG,{className:i}=e,a=$(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:_()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var X=g(30655),ee=g.n(X),te=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const ie=e=>{const t=window.SVG,{className:i}=e,a=te(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:ee()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var ae=g(94064),se=g.n(ae),oe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const ne=e=>{const t=window.SVG,{className:i}=e,a=oe(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:se()},a)):n.React.createElement("svg",Object.assign({className:s},a))};var le=g(28996),re=g.n(le),ce=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const de=e=>{const t=window.SVG,{className:i}=e,a=ce(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?n.React.createElement(t,Object.assign({className:s,src:re()},a)):n.React.createElement("svg",Object.assign({className:s},a))},ue=(e,t,o,l,r)=>{var c,d,u;const p=e.getSchema(),g=null==e?void 0:e.getLayerDefinition(),h=["CreationDate","Creator","EditDate","Editor","GlobalID"],m=(null==p?void 0:p.fields)?Object.values(null==p?void 0:p.fields):[],I=(null==g?void 0:g.fields)||[];let f=m.filter((e=>!h.includes(e.jimuName))).map((e=>{const t=I.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i,visible:!0})}));const y=null===(c=null==e?void 0:e.getPopupInfo())||void 0===c?void 0:c.fieldInfos;if("output"!==e.dataViewId&&y&&(null==y?void 0:y.length)>0){const e=[];y.forEach((t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)})),f=f.filter((t=>e.includes(t.name)))}(null==f?void 0:f.length)>50&&(f=f.slice(0,50));const S={dataSourceId:e.id,mainDataSourceId:null===(d=e.getMainDataSource())||void 0===d?void 0:d.id,dataViewId:e.dataViewId,rootDataSourceId:null===(u=e.getRootDataSource())||void 0===u?void 0:u.id},b=(0,n.Immutable)(S),v=f.map((e=>e.jimuName)),M=b.set("fields",v);return{id:t?e.id:o?o(e.id):e.id,name:e.getLabel(),useDataSource:M.asMutable({deep:!0}),allFields:m,tableFields:f,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableSelect:!0,enableDelete:!1,selectMode:i.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:s.Fixed,columnWidth:200},layerHonorMode:a.Webmap,parentViewId:l}},pe=[W.LayerTypes.FeatureLayer,W.LayerTypes.SceneLayer,W.LayerTypes.BuildingComponentSublayer,W.LayerTypes.OrientedImageryLayer,W.LayerTypes.ImageryLayer,W.LayerTypes.SubtypeSublayer];function ge(e){if(!e||!e.type)return!1;const t=e.type,i=t!==W.LayerTypes.BuildingComponentSublayer||t===W.LayerTypes.BuildingComponentSublayer&&e.view;return!!(pe.includes(t)&&i)}var he=function(e,t,i,a){return new(i||(i=Promise))((function(s,o){function n(e){try{r(a.next(e))}catch(e){o(e)}}function l(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}r((a=a.apply(e,t||[])).next())}))};const me=(0,n.Immutable)([n.AllDataSourceTypes.FeatureLayer,n.AllDataSourceTypes.SceneLayer,n.AllDataSourceTypes.BuildingComponentSubLayer,n.AllDataSourceTypes.OrientedImageryLayer,n.AllDataSourceTypes.ImageryLayer,n.AllDataSourceTypes.SubtypeSublayer]),Ie=n.css`
  .map-layers-header-setting-row.jimu-widget-setting--row-label {
    margin-top: 0 !important;
  }

  .map-layers-header-setting-row {
    width: calc(100% - 22px);
    max-width: calc(100% - 22px);

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;
  
        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }

  .jimu-tree-item.jimu-tree-item_template-card.jimu-tree-item_disabled-false .jimu-tree-item__content .jimu-tree-item__body:hover {
    cursor: pointer !important;
  }
`;function fe(e){var t,i,a;const{jimuMapView:s,mapViewConfig:o,theme:c,theme2:g,widgetId:h,intl:I,isMapMode:f,sidePopperTrigger:y,useDataSources:S=(0,n.Immutable)([]),onLayerItemClick:b,onMapSettingClick:v,onLayerSettingChange:M,onMultipleLayerSettingChange:D,onMapLayersConfigChange:j,onMapLayersMultipleConfigChange:C,onDataSourceFieldsChange:w,onMapLayersConfigActiveIdSet:x}=e,T=n.hooks.useTranslation(l.defaultMessages,d),[N,O]=(0,u.useState)(""),[z,P]=(0,u.useState)(!1),[k,A]=(0,u.useState)(null),[F,H]=(0,u.useState)(!1),[R,W]=(0,u.useState)(!1),[B,E]=(0,u.useState)([]),[V,Y]=(0,u.useState)(!1),[Q,U]=(0,u.useState)(null),K=(0,u.useRef)(null),Z=n.DataSourceManager.getInstance(),_=Z.getDataSource(s.dataSourceId),$=(null==_?void 0:_.getLabel())||"",X=s.id,ee=(0,u.useRef)(X);ee.current=X;const te="3d"===(null===(t=s.view)||void 0===t?void 0:t.type),ae=(0,u.useRef)(null),se=(0,u.useMemo)((()=>{const e={};return B.forEach((t=>{e[t.id]=!0;t.getAllAncestorJimuLayerViews().forEach((t=>{e[t.id]=!0}))})),e}),[B]);(0,u.useEffect)((()=>{be()}),[o,s]),(0,u.useEffect)((()=>{!function(){he(this,void 0,void 0,(function*(){const e=s.id,t=yield s.whenAllJimuLayerViewLoaded(),i=Object.values(t).filter((e=>!e.fromRuntime&&ge(e))),a=i.map((e=>e.createLayerDataSource()));try{yield Promise.all(a)}catch(e){console.log(e)}var o;s.isActive||(yield(o=500,new Promise((e=>{setTimeout((()=>{e()}),o)}))));const n=i.filter((e=>!!e.getLayerDataSource()));ee.current===e&&(E(n),H(!0))}))}()}),[s]);const oe=(0,u.useCallback)((()=>{W(!0),v(s.id)}),[]),le=(0,u.useCallback)((()=>{Y((e=>!e))}),[]),re=(0,u.useCallback)((()=>{W(!1)}),[]),ce=(e,t)=>{var i;return e?Object.assign({dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id},t?{useFieldsInPopupInfo:!0}:{}):null},pe=(0,u.useCallback)(((e,t)=>he(this,void 0,void 0,(function*(){let i=S.asMutable({deep:!0});if(t){const a=s.jimuLayerViews,o=s.jimuTables,l=[];for(const e in a){const t=a[e];if(t.isLayerVisible()&&ge(t)){l.push(e);const a=null==t?void 0:t.getLayerDataSource(),s=ce(a,!0);i=ye(i,"add",s)}}for(const e in o){const t=o[e];if(t.visible){l.push(e);const a=s.getDataSourceIdByAPILayer(t),o=n.DataSourceManager.getInstance().getDataSource(a),r=s.getMapDataSource();let c=o;!o&&r&&(c=yield r.createDataSourceByLayer(t));const d=ce(c,!0);i=ye(i,"add",d)}}D(e,{customJimuLayerViewIds:l,customizeLayers:t},i)}else{const a=s.jimuLayerViews,o=s.jimuTables;for(const e in a){const t=a[e];if(t.isLayerVisible()&&ge(t)){const e=null==t?void 0:t.getLayerDataSource(),a=ce(e);i=ye(i,"remove",a)}}for(const e in o){const t=o[e];if(t.visible){const e=s.getDataSourceIdByAPILayer(t),a=n.DataSourceManager.getInstance().getDataSource(e),o=s.getMapDataSource();let l=a;!a&&o&&(l=yield o.createDataSourceByLayer(t));const r=ce(l);i=ye(i,"remove",r)}}M(e,"customizeLayers",t,i)}}))),[s,M,D,S]),fe=(0,u.useCallback)((e=>{const t=e.id;return!se[t]}),[se]),Se=(0,u.useCallback)((e=>!B.includes(e)),[B]),be=()=>he(this,void 0,void 0,(function*(){var e,t;const i=s.jimuLayerViews,a=s.jimuTables,l=[];for(const t in i){const a=null===(e=i[t])||void 0===e?void 0:e.getLayerDataSource();if(!a||!me.includes(a.type))continue;const n=Z.getDataSource(a.id),r=null==o?void 0:o.layersConfig.find((e=>e.id===a.id));let c;if(r)c=r;else{c=ue(n,!0,void 0,i[t].jimuMapViewId||s.id)}l.push(c)}for(const e in a){const t=a[e],i=s.getDataSourceIdByAPILayer(t),n=Z.getDataSource(i),r=s.getMapDataSource();let c=n;if(!n&&r&&(c=yield r.createDataSourceByLayer(t)),!c||!me.includes(c.type))continue;const d=null==o?void 0:o.layersConfig.find((e=>e.id===c.id));let u;if(d)u=d;else{u=ue(c,!0,void 0,s.id)}l.push(u)}const r={parentViewId:(null==o?void 0:o.parentViewId)||s.id,customizeLayers:!(!o||!("customizeLayers"in o))&&o.customizeLayers,customJimuLayerViewIds:(null===(t=null==o?void 0:o.customJimuLayerViewIds)||void 0===t?void 0:t.asMutable({deep:!0}))||[],layersConfig:(0,n.Immutable)(l)};U(r)})),ve=[];ae.current&&ve.push(ae.current);const Me=(e,t)=>{(e=>{const t=y.getElementsByClassName("jimu-tree-item__body")[e];A(t)})(e),e===K.current?(z||(O(t),x(t)),P(!z)):(O(t),x(t),P(!0),K.current=e)},De=()=>{P(!1),K.current=0},je=null===(i=null==Q?void 0:Q.customJimuLayerViewIds)||void 0===i?void 0:i.map((e=>{const t=e.indexOf("-");return e.substring(t+1)})),Ce=(null==Q?void 0:Q.customizeLayers)?null===(a=null==Q?void 0:Q.layersConfig)||void 0===a?void 0:a.filter((e=>je.includes(e.id))):null==Q?void 0:Q.layersConfig;return(0,n.jsx)("div",{className:"map-layers-setting",css:Ie},(0,n.jsx)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-4"},te?(0,n.jsx)(G,{className:"mr-2"}):(0,n.jsx)(J,{className:"mr-2"}),(0,n.jsx)(r.SettingRow,{flow:"no-wrap",className:"map-layers-header-setting-row w-100",label:$,"aria-label":$},(0,n.jsx)("div",{className:"map-title-icon-container d-flex align-items-center"},!F&&(0,n.jsx)("div",{className:"setting-loading-container"},(0,n.jsx)(l.Loading,{type:"DONUT"})),F&&0===B.length&&(0,n.jsx)(l.Tooltip,{title:T("noAvailableLayers"),showArrow:!1,placement:"top"},(0,n.jsx)("span",null,(0,n.jsx)(l.Button,{className:"border-0",disabled:!F,type:"tertiary",icon:!0,size:"sm"},(0,n.jsx)(de,{size:16,color:"var(--warning-600)"})))),F&&B.length>0&&Q&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(l.Tooltip,{title:T("selectLayers"),showArrow:!1,placement:"top"},(0,n.jsx)("span",null,(0,n.jsx)(l.Button,{ref:ae,className:"map-layers-setting-btn mr-1 p-0 border-0",disabled:!F,type:"tertiary",icon:!0,size:"sm",onClick:oe},(0,n.jsx)(q,{size:16})))),(null==Q?void 0:Q.customizeLayers)&&(0,n.jsx)(l.Button,{className:"layer-list-toggle-btn p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:le},V?(0,n.jsx)(ne,{size:16}):(0,n.jsx)(ie,{size:16})))))),(null==Q?void 0:Q.customizeLayers)&&(0,n.jsx)(p.List,{className:(0,n.classNames)(["w-100 mt-1",{"d-none":!V}]),itemsJson:(()=>{var e;const t=[],i=null===(e=null==Q?void 0:Q.customJimuLayerViewIds)||void 0===e?void 0:e.map((e=>{const t=e.indexOf("-");return e.substring(t+1)}));return((null==Q?void 0:Q.customizeLayers)?(null==Q?void 0:Q.layersConfig.filter((e=>i.includes(e.id))))||[]:(null==Q?void 0:Q.layersConfig)||[]).forEach(((e,i)=>{t.push({itemStateDetailContent:e,itemKey:`${i}`,itemStateChecked:z&&i===K.current,itemStateTitle:e.name,itemStateCommands:[]})})),t})(),dndEnabled:!1,renderOverrideItemDetailToggle:()=>"",onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props,a=i.itemStateDetailContent,s=a.id,o=+i.itemKey;b(a.parentViewId,o),Me(o,s),N!==s&&(m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:h,propKey:"activeTabId",value:s}),m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:h,propKey:"settingChangeTab",value:!0}))}}),R&&(0,n.jsx)(r.SidePopper,{isOpen:!0,toggle:re,position:"right",trigger:ve,title:T("selectLayers")},(0,n.jsx)(r.SettingRow,{className:"w-100 pl-4 pr-4",label:T("customizeLayers")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:null==Q?void 0:Q.customizeLayers,"data-key":"customizeLayers",onChange:e=>{pe(null==Q?void 0:Q.parentViewId,e.target.checked)},"aria-label":T("customizeLayers")})),(null==Q?void 0:Q.customizeLayers)&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(r.SettingRow,{className:"w-100 pl-4 pr-4",label:$,"aria-label":$}),(0,n.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,n.jsx)(r.JimuLayerViewSelector,{key:X,jimuMapViewId:X,isMultiSelection:!0,selectedValues:null==Q?void 0:Q.customJimuLayerViewIds,isShowTables:!0,hideLayers:fe,disableLayers:Se,onChange:e=>he(this,void 0,void 0,(function*(){const t=s.jimuLayerViews,i=s.jimuTables,a=null==o?void 0:o.customJimuLayerViewIds,l=((e,t)=>{const i=e.length>t.length,a=i?t:e;return(i?e:t).filter((e=>!a.some((t=>t===e))))})(e,a),r=t[l],c=i[l];let d;if(r)d=r.getLayerDataSource();else if(c){const e=s.getDataSourceIdByAPILayer(c),t=n.DataSourceManager.getInstance().getDataSource(e),i=s.getMapDataSource();d=t,!t&&i&&(d=yield i.createDataSourceByLayer(c))}const u=ce(d,!0);let p=S.asMutable({deep:!0});p=e.length>a.length?ye(p,"add",u):ye(p,"remove",u),M(s.id,"customJimuLayerViewIds",e,p)}))})))),(0,n.jsx)(r.SidePopper,{position:"right",title:T("layerConfig"),isOpen:z&&!n.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:De,trigger:y,backToFocusNode:k},(0,n.jsx)(L,Object.assign({},null==Ce?void 0:Ce.asMutable({deep:!0})[K.current],{isMapMode:f,intl:I,theme:c,appTheme:g,widgetId:h,newAddFlag:!1,optionChange:(e,t)=>{j(e,t,S.asMutable({deep:!0}))},multiOptionsChange:e=>{C(e,S.asMutable({deep:!0}))},multiOptionsAndUseDsChange:(e,t)=>{C(e,t)},orgUseDataSources:S,onDataSourceFieldsChange:w,onClose:De}))))}const ye=(e,t,i)=>{let a=e||[];return"remove"===t?a=a.filter((e=>e.dataSourceId!==i.dataSourceId)):"add"===t&&i&&!a.find((e=>e.dataSourceId===i.dataSourceId))&&(a=a.concat([i])),a.length>0?a:void 0};var Se=function(e,t,i,a){return new(i||(i=Promise))((function(s,o){function n(e){try{r(a.next(e))}catch(e){o(e)}}function l(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}r((a=a.apply(e,t||[])).next())}))};const be=Object.assign({},d,l.defaultMessages),ve={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};class Me extends n.React.PureComponent{constructor(t){super(t),this.partSupportedDsTypes=(0,n.Immutable)([n.AllDataSourceTypes.FeatureLayer,n.AllDataSourceTypes.SceneLayer,n.AllDataSourceTypes.BuildingComponentSubLayer,n.AllDataSourceTypes.OrientedImageryLayer,n.AllDataSourceTypes.ImageryLayer,n.AllDataSourceTypes.SubtypeSublayer]),this.sidePopperTrigger=(0,u.createRef)(),this.customizeLayersTrigger=(0,u.createRef)(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{const{useDataSource:i,tableFields:a}=e,s=a.map((e=>e.jimuName)),o=(0,n.Immutable)(i).set("fields",s);this.dsHash[t]=o,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.flattenDataSources=e=>{const t=[],i=e=>{if(e.isDataSourceSet()){e.getChildDataSources().forEach((e=>{i(e)}))}else t.push(e)};return i(e),t},this.dataSourceChangeSave=e=>{if(!e)return;const t=e.map((e=>n.DataSourceManager.getInstance().getDataSource(e.dataSourceId))),{config:i}=this.props,{layersConfig:a}=i,s=a[this.index];let o=0;const l=[];t.forEach((e=>{var t;if(!(null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.isHidden)){const t=ue(e,!1,this.getNewConfigId);l.push(t)}o++}));const r=t.length;if(o===r){let e;if(s&&1===r){const t=a.asMutable({deep:!0});t.splice(this.index,1,l[0]),e=(0,n.Immutable)(t)}else{e=a.concat(l)}this.updateDsHash(e.asMutable({deep:!0}));const t={id:this.props.id,config:this.props.config.set("layersConfig",e),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(t),this.setState({newAddFlag:!1})}},this.runtimeConfigUpdate=e=>{const t=[],{jimuMapViews:i}=this.state;Object.keys(i).forEach((a=>{var s,o,n;const l=i[a].jimuLayerViews;for(const i in l){const r=null===(s=l[i])||void 0===s?void 0:s.getLayerDataSource();(null===(o=null==r?void 0:r.getDataSourceJson())||void 0===o?void 0:o.url)&&e.updateIds.includes(i)&&t.push({dataSourceId:r.id,mainDataSourceId:r.id,dataViewId:r.dataViewId,rootDataSourceId:null===(n=r.getRootDataSource())||void 0===n?void 0:n.id,viewId:a})}})),this.bindMapLayersConfigSave(t,!1,e.deleteIds)},this.bindMapLayersConfigSave=(e,t,i)=>Se(this,void 0,void 0,(function*(){if((!i||0===(null==i?void 0:i.length))&&0===(null==e?void 0:e.length))return;const{jimuMapViews:a}=this.state,{config:s}=this.props,{mapViewsConfig:o}=s;let l=0;const r=[],c=t?{}:o.asMutable({deep:!0});e.forEach(((e,t)=>{var i;const s=e.viewId;if(!c[s]){const e=Object.keys(a[s].jimuLayerViews);c[s]={parentViewId:s,customizeLayers:!1,customJimuLayerViewIds:e,layersConfig:[]}}const o=(0,n.Immutable)(e),d=this.dsManager.getDataSource(o.dataSourceId);if(this.partSupportedDsTypes.includes(null==d?void 0:d.type)&&!(null===(i=null==d?void 0:d.getDataSourceJson())||void 0===i?void 0:i.isHidden)){const t=ue(d,!0);r.push(t);const i=e.dataSourceId,a=`${s}${i.substring(i.indexOf("-"))}`;c[s].layersConfig.push(t),c[s].customJimuLayerViewIds.push(a)}l++}));let d=!1;if(i&&i.length>0){let e=0;for(const t in c){const a=c[t].layersConfig.filter((e=>!i.includes(e.id)));c[t].layersConfig=a,e++}e===Object.keys(c).length&&(d=!0)}else d=!0;const u=e.length;if(l===u&&d){this.updateDsHash(r);const e={id:this.props.id,config:this.props.config.set("mapViewsConfig",c),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(e)}})),this.onViewsCreate=e=>{const{id:t,needUpdateConfig:i}=this.props,a=Object.keys(e),s=a.length,o={};let n=0;a.forEach((a=>Se(this,void 0,void 0,(function*(){o[a]=!1;const l=e[a];if(yield l.whenJimuMapViewLoaded(),yield l.whenAllJimuLayerViewLoaded(),o[a]=!0,n++,n===s){Object.values(o).every((e=>e))&&this.setState({jimuMapViews:e},(()=>{(i.updateIds.length>0||i.deleteIds.length>0)&&(this.runtimeConfigUpdate(i),m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"needUpdateConfig",value:{updateIds:[],deleteIds:[]}}))}))}}))))},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>{const i=e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t}));return i},this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((t=>{const i=this.dsHash[t].dataSourceId;let a;a=e[i]?(0,n.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[i].fields,this.dsHash[t].fields)}):this.dsHash[t],e[i]=a}));const t=[];return Object.keys(e).forEach((i=>{t.push(e[i])})),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);const i=this.props.config.set("layersConfig",t);delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.dataSourceFieldsChange=(t,i)=>{const{activeJmViewId:a}=this.state,{config:s}=this.props,{tableMode:o,layersConfig:l,mapViewsConfig:r}=s;let c;c=o===e.Map?r[a].layersConfig.filter((e=>{var i;return(null==t?void 0:t.dataSourceId)===(null===(i=null==e?void 0:e.useDataSource)||void 0===i?void 0:i.dataSourceId)})):l.filter((e=>{var i;return(null==t?void 0:t.dataSourceId)===(null===(i=null==e?void 0:e.useDataSource)||void 0===i?void 0:i.dataSourceId)}));let d=[];c.forEach((e=>{const{id:t,tableFields:a}=e;if(t===(null==i?void 0:i.id))d=d.concat(null==i?void 0:i.usedFields);else{const e=a.map((e=>e.jimuName));d=d.concat(e)}}));const u=new Set(d),p=Array.from(u),{useDataSources:g}=this.props,h=null==g?void 0:g.findIndex((e=>e.dataSourceId===(null==t?void 0:t.dataSourceId)));if(void 0===h||h<0)return;const m=g.asMutable({deep:!0}),I=(0,n.Immutable)(t).set("fields",p).set("useFieldsInPopupInfo",!1);m[h]=I.asMutable({deep:!0}),this.props.onSettingChange({id:this.props.id,useDataSources:m})},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:be[e]},t),this.onMapLayersConfigActiveIdSet=e=>{this.setState({activeId:e})},this.onShowLayerPanel=(e,t=!1,i)=>{const{showLayerPanel:a}=this.state;this.setSidePopperAnchor(e,t),this.setState({newAddFlag:t}),e===this.index?(a||this.setState({activeId:i}),this.setState({showLayerPanel:!a})):(this.setState({activeId:i,showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.switchTableType=e=>{if(e!==this.props.config.arrangeType){const t={id:this.props.id,config:this.props.config.set("arrangeType",e)};this.props.onSettingChange(t)}},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map((e=>e.itemStateDetailContent)),o={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.setSidePopperAnchor=(e,t=!1)=>{let i;i=t?this.sidePopperTrigger.current.getElementsByClassName("add-table-btn")[0]:this.sidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.onPropertyChange=(e,t)=>{const{config:i}=this.props;if(t===i[e])return;const a=i.set(e,t),s={id:this.props.id,config:a};this.props.onSettingChange(s)},this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.onTableModeChange=t=>{this.toBeChangedMode=t;const{config:i}=this.props,{tableMode:a,layersConfig:s}=i;if(a===e.Layer&&0===s.length){const a={id:this.props.id,config:i.set("tableMode",t).set("enableMapExtentFilter",!0).set("defaultExtentFilterEnabled",!1)};return this.toBeChangedMode===e.Map||(a.useMapWidgetIds=null),a.useDataSources=null,this.props.onSettingChange(a),void this.setState({showLayerPanel:!1})}t!==a&&this.setState({changeModeConfirmOpen:!0})},this.handleChangeModeOk=()=>{const{config:t}=this.props,i=[{name:"tableMode",value:this.toBeChangedMode},{name:"layersConfig",value:[]},{name:"mapViewsConfig",value:{}},{name:"enableMapExtentFilter",value:this.toBeChangedMode===e.Map},{name:"defaultExtentFilterEnabled",value:!1}];let a=t;i.forEach((e=>{e.value!==t[e.name]&&(a=a.set(e.name,e.value))}));const s={id:this.props.id,config:a};this.toBeChangedMode===e.Map||(s.useMapWidgetIds=null),s.useDataSources=null,this.props.onSettingChange(s),this.setState({changeModeConfirmOpen:!1,showLayerPanel:!1})},this.handleChangeModeClose=()=>{this.setState({changeModeConfirmOpen:!1})},this.onLayerItemClick=(e,t)=>{this.index=t,this.setState({activeJmViewId:e})},this.onMapSettingClick=e=>{this.setState({activeJmViewId:e})},this.isDataSourceEmpty=()=>{var e,t,i;const a=(null===(e=W.MapViewManager.getInstance().getJimuMapViewGroup(this.props.useMapWidgetIds[0]))||void 0===e?void 0:e.jimuMapViews)||{};return 1===Object.keys(a).length&&!(null===(i=null===(t=Object.values(a))||void 0===t?void 0:t[0])||void 0===i?void 0:i.dataSourceId)},this.getDefaultConfig=()=>Se(this,void 0,void 0,(function*(){const{activeId:e,jimuMapViews:t,activeJmViewId:i}=this.state,a=t[i],s=t[i].jimuLayerViews,o=t[i].jimuTables,n=`${i}${e.substring(e.indexOf("-"))}`;let l,r="layer",c=s[n];if(c||(c=o[n],c&&(r="table")),!c)return null;if("table"===r){const e=a.getDataSourceIdByAPILayer(c),t=this.dsManager.getDataSource(e),i=a.getMapDataSource();l=t,!t&&i&&(l=yield i.createDataSourceByLayer(c))}else l=this.dsManager.getDataSource(null==c?void 0:c.layerDataSourceId),l||(l=yield c.createLayerDataSource());if(!l)return null;return ue(l,!0,void 0,(null==c?void 0:c.jimuMapViewId)||i)})),this.getUpdateObject=(e,t,i)=>{let a;if("single"===t){const{key:t,value:s}=i;a=Object.assign(Object.assign({},e),{[t]:s})}else"multiple"===t&&(a=Object.assign(Object.assign({},e),i));return a},this.onMapModeSettingChange=(e,t,i)=>Se(this,void 0,void 0,(function*(){const{id:a,config:s}=this.props,{activeId:o,jimuMapViews:n,activeJmViewId:l}=this.state,r=s,c=r.mapViewsConfig,d="layer"===e,u="layer-multiple"===e;if(null==c?void 0:c[l]){let s;if(d){const{viewId:e,key:o,value:n}=t;s=r.setIn(["mapViewsConfig",e,o],n);const l={id:a,config:s,useDataSources:i};return void this.props.onSettingChange(l)}if(u){const{viewId:e,updateOptions:o}=t,n=Object.assign(Object.assign({},c[e]),o);s=r.setIn(["mapViewsConfig",e],n);const l={id:a,config:s,useDataSources:i};return void this.props.onSettingChange(l)}const n=c[l],p=n.layersConfig.findIndex((e=>e.id===o));if(p>-1){const o=n.layersConfig[p],c=this.getUpdateObject(o.asMutable({deep:!0}),e,t);s=r.setIn(["mapViewsConfig",l,"layersConfig",p.toString()],c);const d={id:a,config:s,useDataSources:i};this.props.onSettingChange(d)}else{const o=yield this.getDefaultConfig();if(!o)return;const c=n.layersConfig.asMutable({deep:!0}),d=this.getUpdateObject(o,e,t);c.push(d),s=r.setIn(["mapViewsConfig",l,"layersConfig"],c);const u={id:a,config:s,useDataSources:i};this.props.onSettingChange(u)}}else{let s;const o=[],c=n[l].jimuLayerViews,p=n[l].jimuTables;for(const e in c){const t=c[e];t.isLayerVisible()&&ge(t)&&o.push(e)}for(const e in p){p[e].visible&&o.push(e)}if(d){const{viewId:e,key:i,value:a}=t;s={parentViewId:l||e,customizeLayers:!1,customJimuLayerViewIds:o,layersConfig:[],[i]:a}}else if(u){const{viewId:e,updateOptions:i}=t;s=Object.assign({parentViewId:l||e,customizeLayers:!1,customJimuLayerViewIds:o,layersConfig:[]},i)}else{const i=yield this.getDefaultConfig();if(!i)return;s={parentViewId:l,customizeLayers:!1,customJimuLayerViewIds:o,layersConfig:[this.getUpdateObject(i,e,t)]}}const g={id:a,config:r.setIn(["mapViewsConfig",l],s),useDataSources:i};this.props.onSettingChange(g)}})),this.onLayerSettingChange=(e,t,i,a)=>{this.onMapModeSettingChange("layer",{viewId:e,key:t,value:i},a)},this.onMultipleLayerSettingChange=(e,t,i)=>{this.onMapModeSettingChange("layer-multiple",{viewId:e,updateOptions:t},i)},this.onMapLayersConfigChange=(e,t,i)=>{this.onMapModeSettingChange("single",{key:e,value:t},i)},this.onMapLayersMultipleConfigChange=(e,t)=>{this.onMapModeSettingChange("multiple",e,t)},this.getTableLayerList=()=>{const{jimuMapViews:t}=this.state,{config:i,theme:a,theme2:s,id:o,intl:l,useDataSources:r}=this.props,{tableMode:c}=i,d={theme:a,theme2:s,widgetId:o,intl:l,isMapMode:c===e.Map,useDataSources:r};return(0,n.jsx)("div",{ref:this.customizeLayersTrigger,className:"w-100"},Object.keys(t).map((e=>{var a,s;const o=t[e];return(0,n.jsx)(fe,Object.assign({},d,{key:e,jimuMapView:o,sidePopperTrigger:null===(a=this.sidePopperTrigger)||void 0===a?void 0:a.current,mapViewConfig:null===(s=null==i?void 0:i.mapViewsConfig)||void 0===s?void 0:s[e],onLayerItemClick:this.onLayerItemClick,onMapSettingClick:this.onMapSettingClick,onLayerSettingChange:this.onLayerSettingChange,onMultipleLayerSettingChange:this.onMultipleLayerSettingChange,onMapLayersConfigChange:this.onMapLayersConfigChange,onMapLayersMultipleConfigChange:this.onMapLayersMultipleConfigChange,onDataSourceFieldsChange:this.dataSourceFieldsChange,onMapLayersConfigActiveIdSet:this.onMapLayersConfigActiveIdSet}))})))},this.getLayersSettingContent=()=>{var e;return(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e.length)>0&&(0,n.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,n.jsx)(r.SettingRow,null,this.isDataSourceEmpty()?(0,n.jsx)(l.Alert,{tabIndex:0,className:"warningMsg",open:!0,text:this.formatMessage("noWebMapWebSceneTip"),type:"warning"}):this.getTableLayerList()))},this.index=0,this.dsManager=n.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={activeId:t.activeTabId,showLayerPanel:!1,refreshPanel:!1,dataSources:{},popperFocusNode:null,newAddFlag:!1,changeModeConfirmOpen:!1,jimuMapViews:{},activeJmViewId:""}}componentDidUpdate(e){const{activeId:t}=this.state,{activeTabId:i}=this.props;i!==e.activeTabId&&i!==t&&this.setState({activeId:i})}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var i,a;const{activeId:s,showLayerPanel:o,popperFocusNode:c,newAddFlag:d,changeModeConfirmOpen:h}=this.state,{theme:I,theme2:f,config:y,id:S,useMapWidgetIds:b}=this.props,{tableMode:v,enableMapExtentFilter:M,defaultExtentFilterEnabled:D}=y,j=v===e.Layer,C=v===e.Map,w=this.formatMessage("newSheet"),x=y.layersConfig.length,T=C?this.formatMessage("noMapSelectedTips"):this.formatMessage("tableBlankStatus",{SheetString:w}),N=C?(null==b?void 0:b.length)>0:x>0,O=window.isExpressBuilder;return(0,n.jsx)("div",{css:B(I),className:"h-100"},(0,n.jsx)("div",{className:"widget-setting-table h-100"},null===(i=this.props.useDataSources)||void 0===i?void 0:i.map(((e,t)=>(0,n.jsx)(z,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,n.jsx)(r.SettingSection,{title:this.formatMessage("source")},(0,n.jsx)("div",{ref:this.sidePopperTrigger},(0,n.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,n.jsx)("div",{role:"radiogroup",className:"mb-4"},(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"tableModeType",className:"mr-2",checked:j,onChange:()=>{this.onTableModeChange(e.Layer)}}),this.formatMessage("selectLayers")),(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"tableModeType",className:"mr-2",checked:C,onChange:()=>{this.onTableModeChange(e.Map)}}),this.formatMessage("interactWithMap"))),C&&(0,n.jsx)(u.Fragment,null,(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(r.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:b}),(0,n.jsx)(W.JimuMapViewComponent,{useMapWidgetId:null==b?void 0:b[0],onViewsCreate:this.onViewsCreate}))),j&&(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(l.Button,{className:"w-100 text-default add-table-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(x,!0)},"aria-label":w,"aria-describedby":"table-blank-msg"},(0,n.jsx)("div",{className:"w-100 px-2 text-truncate"},w)))),j&&(0,n.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,n.jsx)("div",{className:"setting-ui-unit-list"},!!x&&(0,n.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-existing",itemsJson:Array.from(y.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:o&&t===this.index,itemStateTitle:e.name,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:k(),size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var i,a;const{itemJsons:s}=t.props,[o]=s,r=null===(a=null===(i=null==o?void 0:o.itemStateDetailContent)||void 0===i?void 0:i.useDataSource)||void 0===a?void 0:a.dataSourceId;return this.isDataSourceAccessible(r)?"":(0,n.jsx)(l.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props,a=i.itemStateDetailContent.id;this.onShowLayerPanel(+i.itemKey,!1,a),s!==a&&(m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:S,propKey:"activeTabId",value:a}),m.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:S,propKey:"settingChangeTab",value:!0}))}},ve)),x===this.index&&o&&(0,n.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},ve)))),C&&this.getLayersSettingContent())),C&&(null==b?void 0:b.length)>0&&(0,n.jsx)(r.SettingSection,{title:this.formatMessage("tools"),role:"group","aria-label":this.formatMessage("tools")},(0,n.jsx)(r.SettingRow,{label:this.formatMessage("enableMapExtentFilter")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:M,"data-key":"enableMapExtentFilter",onChange:e=>{this.onPropertyChange("enableMapExtentFilter",e.target.checked)},"aria-label":this.formatMessage("enableMapExtentFilter")})),M&&(0,n.jsx)(r.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:D,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultExtentFilterEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled")))),!N&&!O&&(0,n.jsx)("div",{className:"empty-placeholder w-100"},(0,n.jsx)("div",{className:"empty-placeholder-inner"},(0,n.jsx)("div",{className:"empty-placeholder-icon"},(0,n.jsx)(R,{size:48})),(0,n.jsx)("div",{className:"empty-placeholder-text",id:"table-blank-msg",dangerouslySetInnerHTML:{__html:T}}))),N&&(0,n.jsx)(r.SettingSection,{className:"arrange-style-container",title:this.formatMessage("sheetStyle"),role:"group","aria-label":this.formatMessage("sheetStyle")},(0,n.jsx)(r.SettingRow,{className:"arrange_container"},(0,n.jsx)(l.Tooltip,{title:this.formatMessage("tabs"),placement:"bottom"},(0,n.jsx)(l.Button,{onClick:()=>{this.onPropertyChange("arrangeType",t.Tabs)},icon:!0,size:"sm",type:"tertiary",active:y.arrangeType===t.Tabs,"aria-pressed":y.arrangeType===t.Tabs},(0,n.jsx)(l.Icon,{autoFlip:!0,width:109,height:70,icon:g(79226)}))),(0,n.jsx)(l.Tooltip,{title:this.formatMessage("dropdown"),placement:"bottom"},(0,n.jsx)(l.Button,{onClick:()=>{this.onPropertyChange("arrangeType",t.Dropdown)},className:"ml-2",icon:!0,size:"sm",type:"tertiary",active:y.arrangeType===t.Dropdown,"aria-pressed":y.arrangeType===t.Dropdown},(0,n.jsx)(l.Icon,{autoFlip:!0,width:109,height:70,icon:g(8377)}))))),(0,n.jsx)(r.SidePopper,{position:"right",title:this.formatMessage("layerConfig"),isOpen:o&&!n.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:this.onCloseLayerPanel,trigger:null===(a=this.sidePopperTrigger)||void 0===a?void 0:a.current,backToFocusNode:c},(0,n.jsx)(L,Object.assign({},y.layersConfig.asMutable({deep:!0})[this.index],{isMapMode:C,intl:this.props.intl,theme:I,appTheme:f,widgetId:S,newAddFlag:d,dataSourceChange:this.dataSourceChangeSave,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onDataSourceFieldsChange:this.dataSourceFieldsChange,onClose:this.onCloseLayerPanel}))),h&&(0,n.jsx)(l.ConfirmDialog,{level:"warning",title:this.formatMessage("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:this.formatMessage("changeModeConfirmTips"),onConfirm:this.handleChangeModeOk,onClose:this.handleChangeModeClose})))}}Me.mapExtraStateProps=(e,t)=>{var i,a,s,o;return{dsJsons:e.appStateInBuilder.appConfig.dataSources,activeTabId:null===(a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId,needUpdateConfig:(null===(o=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.widgetsState[t.id])||void 0===o?void 0:o.needUpdateConfig)||{updateIds:[],deleteIds:[]}}};const De=Me;function je(e){g.p=e}})(),h})())}}}));