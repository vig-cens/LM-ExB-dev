System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},i={},r={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.Loading=e.Loading,l.Popper=e.Popper,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.LayerTypes=e.LayerTypes,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.useTheme=e.useTheme}],execute:function(){e((()=>{var e={21210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=l}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,s),l.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>Et,default:()=>Ft});var e=s(79244),t=s(41496);const o=[0,3],n={wkid:4326};var l,i,r,u,c,d;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(l||(l={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(i||(i={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(r||(r={})),function(e){e.Classic="Classic",e.Compact="Compact"}(u||(u={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(c||(c={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(d||(d={}));var v=s(14321);const g={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistory:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var m=s(30655),p=s.n(m),h=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const f=t=>{const o=window.SVG,{className:n}=t,l=h(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:p()},l)):e.React.createElement("svg",Object.assign({className:i},l))};var y=s(94064),S=s.n(y),b=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const I=t=>{const o=window.SVG,{className:n}=t,l=b(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:S()},l)):e.React.createElement("svg",Object.assign({className:i},l))};var x=s(62686);const w="address";var j=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};const C=e=>j(void 0,void 0,void 0,(function*(){const t=R(e),o={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(o);const n=yield N(e),l=yield function(e){return j(this,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then((t=>{const[o,n]=t;if(o.load(),o.isSupported()){if(o.isLoaded()){const t=o.fromUtm(e,new n({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)}))}))}(e);return n?function(e){return j(this,void 0,void 0,(function*(){let t=e;return(0,x.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then((o=>{const[n,l,i,r]=o,s=new n({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=i.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=i.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const o=T();if(o){const n=new l;return n.geometries=[e],n.outSpatialReference=s,n.f="json",r.project(o,n).then((o=>(t=o&&o.length>0&&o[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t))),(e=>Promise.reject(e)))}return Promise.resolve(t)}}return Promise.resolve(null)}))}))}(n).then((t=>{const o=M(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})}),(e=>Promise.resolve(o))):l?function(e){return j(this,void 0,void 0,(function*(){const t=T();return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then((o=>{const[n,l,i]=o;let r=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(r);i(`${t}/fromGeoCoordinateString`,s).then((e=>{const t=Number(e[0][0]),o=Number(e[0][1]);return isNaN(t)||isNaN(o)||(r=new n(t,o,new l({wkid:4326}))),Promise.resolve(r)}))}))}))}(e).then((t=>{const o=M(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})})):Promise.resolve(o)}));function R(e){return e&&D(e)}const N=t=>j(void 0,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((o=>{const[n,l]=o;return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{const{isValidWkid:o}=e;let i=null;if(!t)return i;const r=t.split(":"),s=r[0],a=Number(r[1]);if(a&&o(a)&&s){const e=s.split(","),t=Number(e[0]),o=Number(e[1]);isNaN(t)||isNaN(o)||(i=new n(t,o,new l({wkid:a})))}return Promise.resolve(i)}))}))}));function M(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function T(){var t,o;const n=(0,e.getAppStore)().getState();return(null===(o=((null===(t=null==n?void 0:n.portalSelf)||void 0===t?void 0:t.helperServices)||{}).geometry)||void 0===o?void 0:o.url)||null}const D=e=>null==e?void 0:e.includes(",");var P=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};const k={alias:"ADDRESS",type:"string",name:w},L=(Object.assign(Object.assign({},k),{jimuName:w}),(e,t)=>ae(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?O(t,e):Promise.resolve({})),O=(e,t)=>{var o;return U(null==e?void 0:e.geocodeURL,t,null==e?void 0:e.maxSuggestions,null===(o=null==e?void 0:e.useUtility)||void 0===o?void 0:o.utilityId,null==e?void 0:e.countryCode).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,l)=>{const i=o.text;if(i&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,i)){const l={suggestionHtml:ie(i,t),suggestion:i,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=ee(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(e)))},F=(t,o,n,l)=>{if(!ae(null==n?void 0:n.outputDataSourceId))return;return se(Z(n.outputDataSourceId),e.DataSourceStatus.NotReady),E({address:t,maxResultNumber:o,searchResultView:l,geocodeItem:n})},E=t=>{const{address:o,maxResultNumber:n,geocodeItem:l}=t,{outputDataSourceId:i,singleLineFieldName:r,defaultAddressFieldName:s}=l,a=Z(i),u={geocodeItem:l,address:o,maxResultNumber:n,singleLineFieldName:r,addressFields:(null==l?void 0:l.addressFields)||[],countryCode:null==l?void 0:l.countryCode};return A(u).then((t=>P(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))return Promise.resolve(!1);const n=null==t?void 0:t.filter((e=>null==e?void 0:e.address));let r;const u=(null==n?void 0:n.map(((e,t)=>{const o=e.attributes;o.address=e.address,s&&(o[s]=e.address),o.objectid=t,r=r?null==r?void 0:r.union(e.extent):e.extent;return{attributes:o,geometry:e.location}})))||[],c=a,d=(null==l?void 0:l.label)||c.getLabel(),v=function(e,t){var o;if(!e||0===(null==e?void 0:e.length))return;const n={content:[{type:"fields",fieldInfos:e.map((e=>({fieldName:e.name,isEditable:!1,label:e.name,visible:!0})))},{type:"attachments",displayType:"auto"}],title:`${t}: {${null===(o=e[0])||void 0===o?void 0:o.name}}`};return n}(null==l?void 0:l.displayFields,d),g={id:`${i}_layer`,geometryType:"point",fullExtent:r};v&&(g.popupTemplate=v),yield c.setSourceFeatures(u,g);const m=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;return se(a,m),Promise.resolve(e.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))};const A=t=>P(void 0,void 0,void 0,(function*(){const{geocodeItem:o,address:l,maxResultNumber:i,singleLineFieldName:r,addressFields:s,countryCode:a}=t,{geocodeURL:u,magicKey:c,useUtility:d}=o,v=(null==o?void 0:o.spatialReference)||n,g=R(l);let m;return g&&(m=yield C(l)),(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((t=>{var o;const[n,p]=t,h=new p(v),f=r||"SingleLine";let y=(0,e.Immutable)({maxSuggestions:i});const S=null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(",");S&&(y=y.set("outFields",S));const b=g&&m.searchText?m.searchText:l;y=y.setIn([f],b),c&&(y=y.set("magicKey",c));const I={address:null==y?void 0:y.asMutable({deep:!0}),outSpatialReference:h};return g&&m.locationPoint&&(I.location=m.locationPoint),a&&(I.countryCode=a),n.addressToLocations(u,I,{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>!!(null==e?void 0:e.location))),$(null==d?void 0:d.utilityId),e)),(e=>{console.error(e.message);const t=V(null==d?void 0:d.utilityId,e);return G(null==d?void 0:d.utilityId,e),t?e:[]}))}))})),U=(e,t,o,n,l)=>(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((i=>{const[r]=i,s={text:t,maxSuggestions:o};return l&&(s.countryCode=l),r.suggestLocations(e,s).then((e=>($(n),e||[])),(e=>{console.error(e.message);const t=V(n,e);return G(n,e),t?e:[]}))}));function $(t){t&&e.UtilityManager.getInstance().reportUtilityState(t,!0)}function G(t,o){if(!t)return;const n=V(t,o),l=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,l):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function V(t,o){var n,l,i,r;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(l=null==o?void 0:o.details)||void 0===l?void 0:l.httpStatus)&&(null===(r=null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.message)||void 0===r?void 0:r.includes("Item does not exist"))&&(a=!0),s||a}const J=(e,t,o,n=!1)=>{const l=null==e?void 0:e.outputDataSourceId,i=Z(null==e?void 0:e.outputDataSourceId),r=null==i?void 0:i.getRecordsByPage(1,t);return Promise.resolve({records:r,configId:e.configId,dsId:l,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})},B=(e,t=n)=>{const o=e&&e.coords;return o?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{const[n,l]=e,i=new l(t);return new n({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:i})})):Promise.resolve(null)};var _=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};function W(t,o,n){return _(this,arguments,void 0,(function*(t,o,n,l=[]){var i,r;if(!ae(null===(i=null==n?void 0:n.useDataSource)||void 0===i?void 0:i.dataSourceId))return Promise.resolve({});const s=(null==n?void 0:n.searchFields)||[],a=null===(r=null==l?void 0:l.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===r?void 0:r[0];return function(t,o,n,l,i){return _(this,void 0,void 0,(function*(){var r;const{label:s,icon:a,configId:u}=n,c=null===(r=null==o?void 0:o.useDataSource)||void 0===r?void 0:r.dataSourceId,d=Z(c),v={searchText:t,searchFields:l.map((e=>e.name)),dataSource:d,maxSuggestions:i};return e.dataSourceUtils.querySuggestions(v).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:u,isFromSuggestion:!0}))),layer:s,icon:a};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,a,s,null==o?void 0:o.maxSuggestions)}))}function z(t,o,n,l){if(o){const i=[];return o.forEach((o=>{let r=t;const s=null==n?void 0:n.getFieldCodedValueList(null==o?void 0:o.name);if(s&&(null==s||s.forEach((e=>{r===(null==e?void 0:e.label)&&(r=null==e?void 0:e.value)}))),o.type===e.JimuFieldType.Number){const t=e.dataSourceUtils.convertStringToNumber(r);t&&(r=t)}const a=(null==t?void 0:t.length)>0&&!isNaN(Number(r))&&isFinite(Number(r));if(o.type===e.JimuFieldType.Number&&!a)return!1;const u=function(t,o){let n;t===e.JimuFieldType.Number?n=e.ClauseOperator.NumberOperatorIs:t===e.JimuFieldType.String&&(n=o?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains);return n}(o.type,l),c=o.type===e.JimuFieldType.Number?Number(r):r,d=e.dataSourceUtils.createSQLClause(null==o?void 0:o.name,u,[{value:c,label:c+""}],l);i.push(d)})),e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,i,n)}}function q(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],l=(null==t?void 0:t.map((e=>e.jimuName)))||[],i=Z(o),r=(null==i?void 0:i.getAllUsedFields())||[];return"*"===r?"*":Array.from(new Set(n.concat(l).concat(r)))}const K=(t,o,n)=>{var l;const i=null===(l=null==t?void 0:t.useDataSource)||void 0===l?void 0:l.dataSourceId,r=ue(t.configId,n);if(!ae(i,r))return Promise.resolve({});const s=Z(i,r),a=e.DataSourceManager.getInstance().getLocalDataSourceId(i,r),u=(null==s?void 0:s.getRecordsByPage)&&(null==s?void 0:s.getRecordsByPage(1,o));return Promise.resolve({records:u,configId:t.configId,dsId:i,localDsId:a,isGeocodeRecords:!1})};var H=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};function Q(t){var o,n;const{serviceList:i,searchText:r,id:s}=t,a={};for(const e in i){const t=i[e],{searchServiceType:r,useDataSource:s}=t;if(r===l.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let l=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,i=(null===(n=a[e])||void 0===n?void 0:n.outFields)||[];const r=q(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&l.push(null==t?void 0:t.SQL),i=Array.from(new Set(i.concat(r)))):(l=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,i=r,a[e]={}),a[e].sqlExpression=l,a[e].outFields=i}}!function(t,o,n){var l,i;for(const r in null==t?void 0:t.asMutable({deep:!0})){const s=null===(l=null==t?void 0:t[r])||void 0===l?void 0:l.sqlExpression,a=null===(i=null==t?void 0:t[r])||void 0===i?void 0:i.outFields,u=Z(r);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,r)}const X=(e,t,o,n)=>{var l;const i=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,r=ue(o,t),s=Z(i),a=Z(i,r);a&&(null==a?void 0:a.updateQueryParams)&&(a&&a.updateQueryParams({},r),n&&s&&s.updateQueryParams({},t))},Y=(e,t,o,n=!1)=>{const i=[];for(const r in e){const s=e[r];let a;a=s.searchServiceType===l.FeatureService?K(s,t,o):J(s,t,0,n),i.push(a)}return Promise.all(i)},Z=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),l=n.getLocalDataSourceId(t,o);return n.getDataSource(l)}return e.DataSourceManager.getInstance().getDataSource(t)},ee=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let i=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){i=!0;break}i||o.push(l)}return o},te=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=oe(o,t);let l=e.utils.readLocalStorage(n);l&&(l=unescape(l));return l?null==l?void 0:l.split("/@/"):[]},oe=(e,t)=>`exb-${e}-${t}_recent_searches`,ne=(e,t)=>{var o;return null===(o=null==e?void 0:e.filter((e=>e.configId===t)))||void 0===o?void 0:o[0]},le=e=>{let t=0;for(const o in e)t++;return t};function ie(e,t){if(!t)return e;const o=new RegExp(`(${re(t)})`,"gi"),n=new RegExp(`(${re(t)})`,"gi");return e.match(o)?e.replace(n,"<strong >$1</strong>"):e}function re(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function se(e,t){null==e||e.setStatus(t),null==e||e.setCountStatus(t)}function ae(e,t){return!!e&&!!Z(e,t)}const ue=(e,t)=>`${t}_${e}_useDataSource`,ce=(t,o)=>{var n;let i=!0;for(const r in t){const s=t[r];let a;if(s.searchServiceType===l.FeatureService){const e=null===(n=null==s?void 0:s.useDataSource)||void 0===n?void 0:n.dataSourceId,t=ue(s.configId,o);a=Z(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=Z(e)}const u=null==a?void 0:a.getStatus();u!==e.DataSourceStatus.Loading&&u!==e.DataSourceStatus.Unloaded||(i=!1)}return i},de=t=>{var o,n;if(!t)return;const l=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==l?void 0:l.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},ve=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})};function ge(t,o){return H(this,void 0,void 0,(function*(){const o=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getOutputDsJson:n}=o;return function(t){return H(this,void 0,void 0,(function*(){if(!t||0===t.length)return Promise.resolve([]);const o=t.map((t=>({id:t.dataSourceJson.id,dataSourceJson:(0,e.Immutable)(t.dataSourceJson)})));return yield Promise.allSettled(o.filter((e=>e.layer)).map((e=>H(this,void 0,void 0,(function*(){var t;const o=null===(t=e.layer.sourceJSON)||void 0===t?void 0:t.capabilities;o&&(yield e.layer.load(),e.layer.sourceJSON.capabilities=o)}))))),Promise.allSettled(o.map((t=>e.DataSourceManager.getInstance().createDataSource(t).then((e=>e.isDataSourceSet()&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then((()=>e)):e))))).then((e=>e.filter((e=>"fulfilled"===e.status)).map((e=>e.value)))).then((e=>e.length<t.length?Promise.reject("Failed to create some data source."):e))}))}(null==(t=null==t?void 0:t.filter((e=>{const t=null==e?void 0:e.outputDataSourceId;return!Z(t)})))?void 0:t.map(((e,t)=>({dataSourceJson:n(e,!0),order:t}))))}))}const{useRef:me,useState:pe,useEffect:he}=e.React,fe=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  .dropdown-button-content {
    text-align: center;
  }
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,ye=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),[n,i]=pe(!0),[r,s]=pe(!1),[a,u]=e.React.useState(!1),{className:c,datasourceConfig:m,dsStatus:p,config:h,id:y,useDataSources:S,synchronizeSettings:b,showLoading:x,onDatasourceConfigChange:w}=t,j=me(null),C=me(null),R=me(null),N=me(null),M=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!o||!t)return;const l=de(t)||{};l[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(l)})})(y,"serviceEnabledList",o)},T=(e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),n=null==e?void 0:e.role,l=e&&e.tagName||"",i="button"===l.toLowerCase()||"button"===n,r="input"===l.toLowerCase()||"input"===n,s="a"===l.toLowerCase()||"linkClick"===t.exbEventType;return i||s||!!o&&o>-1||r};he((()=>{const e=null==m?void 0:m.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==m?void 0:m.length);s(o),i(t)}),[m]);return(0,e.jsx)("div",{className:`${c||""} ds-setting-${h.arrangementStyle}`,onKeyDown:e=>{"Escape"===e.key&&(u(!1),C.current.focus())},css:fe,role:"group","aria-label":o("searchIn",{value:""})},x&&(0,e.jsx)(v.Button,{icon:!0,className:"setting-dropdown-button"},(0,e.jsx)(v.Loading,{width:14,height:14,type:"DONUT"})),!x&&(0,e.jsx)(v.Dropdown,{className:"w-100 h-100",toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==j?void 0:j.current)||void 0===t?void 0:t.contains(o))return!1;T(o,e)&&a&&(clearTimeout(N.current),N.current=setTimeout((()=>{null==o||o.focus()}),200)),a||setTimeout((()=>{var e;null===(e=R.current)||void 0===e||e.focus()}),200),u(!a)},isOpen:a},(0,e.jsx)(v.DropdownButton,{ref:C,className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(I,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(v.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:j},(0,e.jsx)(v.DropdownItem,{onClick:()=>{const e=!n,t=null==m?void 0:m.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));M(t),w(t)},title:o("all"),ref:R},(0,e.jsx)(v.Checkbox,{checked:n||r,indeterminate:r,className:"mr-2"}),o("all")),(0,e.jsx)(v.DropdownItem,{divider:!0}),null==m?void 0:m.map(((t,n)=>{var i;const r=p[t.configId]===e.DataSourceStatus.LoadError||p[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===l.GeocodeService,a=((t,o=!1)=>{var n;let l;if(!1!==b&&(null==h?void 0:h.sourceType)===d.MapCentric)return!0;if(o){const o=(0,e.getAppStore)().getState().appConfig,i=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[y],r=(null==i?void 0:i.outputDataSources)||[];l=(null==r?void 0:r.filter((e=>t===e)).length)>0}else l=(null==S?void 0:S.filter((e=>t===e.dataSourceId)).length)>0;return l&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(i=null==m?void 0:m.filter((e=>null==e?void 0:e.enable)))||void 0===i?void 0:i.length)&&(null==t?void 0:t.enable)&&r;return(0,e.jsx)(v.DropdownItem,{key:`${null==t?void 0:t.label}${n}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==m?void 0:m.setIn([t,"enable"],e);M(o),w(o)})(!(null==t?void 0:t.enable),n)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(v.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(r||!a)&&(0,e.jsx)(v.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var Se=s(1888);const be=(t,o)=>{var n,l,i,r,s,a,u,c,d,v,g,m,p,h,f;return e.css`
    & {
      width: ${e.polished.rem(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(l=null==t?void 0:t.sys.color)||void 0===l?void 0:l.secondary)||void 0===i?void 0:i.dark};
      background-color: ${null===(s=null===(r=null==t?void 0:t.ref.palette)||void 0===r?void 0:r.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(a=null==t?void 0:t.ref.palette)||void 0===a?void 0:a.black};
      background-color: ${null===(c=null===(u=null==t?void 0:t.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==t?void 0:t.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(g=null===(v=null==t?void 0:t.ref.palette)||void 0===v?void 0:v.neutral)||void 0===g?void 0:g[200]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(m=null==t?void 0:t.sys.color)||void 0===m?void 0:m.primary.main};
      color: ${null===(p=null==t?void 0:t.ref.palette)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(h=null==t?void 0:t.ref.palette)||void 0===h?void 0:h.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(f=null==t?void 0:t.ref.palette)||void 0===f?void 0:f.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},{useEffect:Ie,useRef:xe}=e.React,we=t=>{const n=xe(null),l=xe(null),{children:i,isOpen:r,reference:s,searchInputRef:a,autoFocus:u,className:c,isFocusWithSearchInput:d,id:g,offset:m,version:p,toggle:h}=t,f=(0,Se.useTheme)(),y=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[g])||void 0===t?void 0:t.state}));Ie((()=>{var e;return(null==a?void 0:a.current)&&d&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",S,!0)),()=>{var e;d&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",S,!0))}}),[]);const S=e.hooks.useEventCallback((e=>{if(!r)return!1;const t=x()||[],o=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?l.current=setTimeout((()=>{t[o].focus()})):"ArrowDown"===e.key&&(l.current=setTimeout((()=>{t[0].focus()})))})),b=e.hooks.useEventCallback((e=>{if(!r)return;const t="button"===e.target.getAttribute("role")||"option"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown","Escape"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),r&&t))if(clearTimeout(l.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown","Tab"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=x();let o=t.indexOf(e.target),i=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey||"Tab"===e.key&&e.shiftKey?(o=0!==o?o-1:t.length-1,i=!0):("ArrowDown"===e.key||"Tab"===e.key||"n"===e.key&&e.ctrlKey)&&(i=!1,o=o===t.length-1?0:o+1);const r=0===o&&!i,s=o===t.length-1&&i;l.current=d&&(r||s)?setTimeout((()=>{var e;null===(e=a.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0].focus(),t[o].focus()}))}else if("End"===e.key){const e=x();l.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=x();l.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=x(),o=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===o){l.current=setTimeout((()=>{t[e].focus()}));break}}}})),I=t=>{t.preventDefault(),w(t),e.lodash.defer((()=>{var e;null===(e=null==a?void 0:a.current)||void 0===e||e.focus()}))},x=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"], [role="option"]')).filter((e=>!e.disabled)):[],w=t=>{h(t),"Escape"===(null==t?void 0:t.key)&&e.lodash.defer((()=>{var e;null===(e=null==a?void 0:a.current)||void 0===e||e.focus()}))};return(0,e.jsx)("div",null,(0,e.jsx)(v.Popper,{autoFocus:u,placement:"bottom-start",open:r,toggle:w,css:be(f,s),reference:s,version:p,className:(0,e.classNames)("result-list-popper",c,{"hide-popper":y===e.WidgetState.Closed}),offset:m||o,popperNodeRef:n},(0,e.jsx)("div",{onKeyDown:b},i)))},{useState:je,useRef:Ce,useEffect:Re}=e.React,Ne=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Me=t=>{const o=e.hooks.useTranslation(v.defaultMessages,e.defaultMessages),n=Ce(null),{serviceList:i,open:r,toggleUtilityErrorRemind:s}=t,[a,u]=je(null),c=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));Re((()=>{r&&(clearTimeout(n.current),n.current=setTimeout((()=>{s(!1)}),5e3))}),[r]),Re((()=>{d(c)}),[c]);const d=e=>{var t;if(!i)return;let o=null,n=[],r=[];if(null===(t=Object.keys(i))||void 0===t||t.forEach((t=>{var o;const s=i[t];if(s.searchServiceType===l.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?r.push(t):!1===(null==o?void 0:o.success)&&n.push(t)}}})),n=g(n),r=g(r),0===(null==n?void 0:n.length)&&(null==r?void 0:r.length)>0)o=m(r);else if(0===(null==r?void 0:r.length)&&(null==n?void 0:n.length)>0)o=p(n);else if((null==r?void 0:r.length)>0&&(null==n?void 0:n.length)>0){o=`${m(r)} ${p(n)}`}u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),m=e=>{let t=null;return 1===le(i)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},p=e=>{let t=null;return 1===le(i)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"position-relative w-100",css:Ne},(0,e.jsx)("div",{className:"w-100 utility-err-remind-con"},(0,e.jsx)(v.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:Te}=e.React,De=new(0,e.esri.Sanitizer),Pe=t=>{const{className:o,reference:n,searchSuggestion:l,isOpen:i,canUseOutputDsLength:r,id:s,searchInputRef:a,openUtilityErrRemindInSuggestion:u,serviceList:c,searchText:d,toggleSuggestionUtilityError:g,toggle:m,onRecordItemClick:p,setSuggestionFirstItem:h}=t,f=(0,Se.useTheme)(),y=Te(!1),S=()=>{if((null==l?void 0:l.length)<2)return!1;let e=0,t=0;return null==l||l.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0},b=(t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,l=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,i)=>{var s;const a=De.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${i}`,title:n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?p(e,t):p(e)})(n.suggestion,u)},ref:e=>{I(i,e)}},l&&1===r&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(s=null==f?void 0:f.sys.color)||void 0===s?void 0:s.primary.main,size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))},I=(e,t)=>{0!==e||y.current||(h(t),y.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(we,{isOpen:i&&!(()=>{let e=[];return l.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),d&&0===e.length})()||u,autoFocus:!1,reference:n,searchInputRef:a,isFocusWithSearchInput:!0,toggle:m,id:s,className:(0,e.classNames)("result-list-con suggestion-list-con",o)},!u&&(y.current=null,null==l?void 0:l.map(((t,o)=>{var n,i,r;const s=(null==l?void 0:l.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"listbox","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(v.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(i=null==f?void 0:f.sys.color)||void 0===i?void 0:i.primary.main,size:16,icon:null===(r=null==t?void 0:t.icon)||void 0===r?void 0:r.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.layer)),b(t,S()))}))),u&&(0,e.jsx)(Me,{open:u,serviceList:c,toggleUtilityErrorRemind:g})))};var ke=s(9044),Le=s.n(ke),Oe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Fe=t=>{const o=window.SVG,{className:n}=t,l=Oe(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:Le()},l)):e.React.createElement("svg",Object.assign({className:i},l))};var Ee=s(21210),Ae=s.n(Ee),Ue=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const $e=t=>{const o=window.SVG,{className:n}=t,l=Ue(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:Ae()},l)):e.React.createElement("svg",Object.assign({className:i},l))};var Ge=s(28996),Ve=s.n(Ge),Je=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Be=t=>{const o=window.SVG,{className:n}=t,l=Je(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:Ve()},l)):e.React.createElement("svg",Object.assign({className:i},l))},_e=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),{serviceList:i,locationLoading:r,isGetLocationError:s,onLocationChange:a,handleLocationLoadingChange:u}=t,[c,d]=e.React.useState(null);e.React.useEffect((()=>{m()}),[i]);const m=()=>{var e;for(const t in i){const o=null===(e=i[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===l.GeocodeService){d(o);break}}},p=e=>{u(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;if(c){((e,t,o=n)=>t?(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((n=>{const[l,i]=n;return B(t,o).then((t=>{const n=new i(o);return l.locationToAddress(e,{location:t,outSpatialReference:n},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),Promise.reject(e.message))))}))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e,null==c?void 0:c.spatialReference).then((e=>{a(e)}),(e=>{a(t)}))}else a(t)},h=e=>{u(!1),a(null,null,!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button",onClick:()=>{if(r)return!1;u(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(p,h)},title:o("useCurrentLocation")},(0,e.jsx)($e,{className:"mr-2"}),o("useCurrentLocation")),s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button",title:o("couldNotRetrieve")},(0,e.jsx)(Be,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:We}=e.React,ze=new(0,e.esri.Sanitizer),qe=t=>{var o,n,l,i;const r=e.hooks.useTranslation(g,v.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:c,isGetLocationError:d,serviceList:m,config:p,id:h,searchInputRef:f,locationLoading:y,toggle:S,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:x,handleLocationLoadingChange:w}=t,j=We(!1),C=t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const l=ze.sanitize(o.suggestionHtml),i={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?b(e,t):b(e)})(o.suggestion,i)},ref:e=>{R(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:l}}))}))},R=(e,t)=>{0!==e||j.current||(x(t),j.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(we,{isOpen:c,autoFocus:!1,reference:a,searchInputRef:f,isFocusWithSearchInput:!0,toggle:S,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},p.isUseCurrentLoation&&(0,e.jsx)(_e,{serviceList:m,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:y,isGetLocationError:d,handleLocationLoadingChange:w}),(j.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},C(t))))),p.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(v.DropdownItem,{divider:!0}),p.isShowRecentSearches&&(null===(i=null===(l=u[0])||void 0===l?void 0:l.suggestionItem)||void 0===i?void 0:i.length)>0&&(0,e.jsx)(v.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside",title:r("clearRecentSearches"),onClick:I},(0,e.jsx)(Fe,{className:"mr-2"}),r("clearRecentSearches"))))},{useEffect:Ke,useRef:He}=e.React,Qe=t=>{const n=e.hooks.useTranslation(g),{reference:l,searchText:r,id:s,config:a,serviceList:c,isOpenResultListDefault:d,searchInputRef:m,searchResult:p,selectionList:h,openUtilityErrRemindInResult:y,isOpenResultPopper:S,isToOtherWidget:b,datasourceConfig:x,toggleResultUtilityError:w,setResultFirstItem:j,handleDsIdOfSelectedResultItemChange:C}=t,{resultMaxNumber:R}=a,N=He([]),M=He(!1),T=He(null),D=He(!1),P=He((0,e.Immutable)({})),k=He({}),L=He(null),O=e.ReactRedux.useSelector((e=>e.appContext.isRTL)),F=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.widgetsRuntimeInfo[s])||void 0===t?void 0:t.state}));let E={};const A=(0,Se.useTheme)(),[U,$]=e.React.useState((0,e.Immutable)({})),[G,V]=e.React.useState(d),[J,B]=e.React.useState(!1),[_,W]=e.React.useState(u.Classic),[z,q]=e.React.useState(!1),[K,H]=e.React.useState(0),[Q,X]=e.React.useState(o);Ke((()=>{F&&H(K+1)}),[F]),Ke((()=>{M.current=!1;ce(null==c?void 0:c.asMutable({deep:!0}),s)&&(b||S)&&ee()}),[p,b,S]),Ke((()=>{(S||b)&&(V(!0),B(!1),$((0,e.Immutable)({})),k.current={})}),[S,b]),Ke((()=>{pe(U)}),[U]),Ke((()=>{(null==a?void 0:a.searchResultStyle)&&(null==a?void 0:a.searchResultStyle)!==_&&W(null==a?void 0:a.searchResultStyle)}),[a]),Ke((()=>{N.current=[]}),[r]),Ke((()=>{fe(_,G,z)}),[_,G,z]);const ee=()=>{const t=Y(null==c?void 0:c.asMutable({deep:!0}),R,s);Promise.all([t]).then((t=>{M.current=!0;let o=(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const l={};n.forEach((e=>{const{records:t,configId:n,dsId:i,isGeocodeRecords:r,localDsId:s}=e;l[n]=t;const a=ue(t,n,i,r,s);o=o.setIn([n],a)})),P.current=o,(null==a?void 0:a.searchResultView)!==i.OtherWidgets&&$(o),k.current=l,H(K+1),ge()}))},te=()=>{var e;if(le(c)<2)return!1;let t=0,o=0;for(const n in U){const l=ne(x,n),i=null==l?void 0:l.icon;i&&(t+=1),(null===(e=U[n])||void 0===e?void 0:e.length)>0&&i&&(o+=1)}return o>0&&t>0},oe=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,l)=>{var i,r,s,a;const{configId:u,value:d,recordId:g,outputDsId:m}=t,p=ve(u,g),h=null===(r=null===(i=null==o?void 0:o.asMutable({deep:!0}))||void 0===i?void 0:i[u])||void 0===r?void 0:r.includes(g),f=ne(x,u),y=null==f?void 0:f.icon,S=h?null===(s=null==A?void 0:A.ref.palette)||void 0===s?void 0:s.white:null===(a=null==A?void 0:A.sys.color)||void 0===a?void 0:a.primary.main,b=le(c);return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:p,role:"option","aria-selected":h,active:h,title:d.join(", "),ref:e=>{ie(l,e)},onClick:()=>{re({isActive:h,key:p,recordId:g,dsId:m,configId:u})}},y&&1===b&&(0,e.jsx)(v.Icon,{className:"mr-2",color:S,size:16,icon:null==y?void 0:y.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},d.join(", ")))})))),ie=(e,t)=>{0!==e||D.current||(j(t),D.current=!0)},re=e.hooks.useEventCallback((t=>{var o,n,l,i,r,a;const{isActive:u,recordId:c,dsId:d,configId:v}=t,g=null===(l=null===(n=null===(o=P.current)||void 0===o?void 0:o[v])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,m=(null===(a=null===(r=null===(i=P.current)||void 0===i?void 0:i[v])||void 0===r?void 0:r[0])||void 0===a?void 0:a.isGeocodeRecords)?d:g,p=Z(m),h=u?[]:ae(v,c);e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(s,h,[m])),C(c?d:null),c&&(!u&&se(v),clearTimeout(L.current),L.current=setTimeout((()=>{u?null==p||p.selectRecordsByIds([]):null==p||p.selectRecordsByIds([c])}),100))})),se=e=>{var t,o,n,l,i,r;const s=P.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(l=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,c=null===(r=null===(i=null==s?void 0:s[a])||void 0===i?void 0:i[0])||void 0===r?void 0:r.isGeocodeRecords,d=Z(c?e:u);d&&d.selectRecordsByIds([])}},ae=(e,t)=>{var o;const n=(null===(o=k.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},ue=(t,o,n,l,i)=>{var r;const s=(null===(r=null==c?void 0:c[o])||void 0===r?void 0:r.displayFields)||[],a=[],u=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,u);(n||0===n)&&t.push(n)}));const r={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:l,localDsId:i};a.push(r),de(r)})),a},de=e=>{!(null==E?void 0:E.recordId)&&e.recordId&&(E=e)},ve=(e,t)=>`${e}_${t}`,ge=()=>{const e=ce(null==c?void 0:c.asMutable({deep:!0}),s);if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==E?void 0:E.recordId)||J||!e)return;const{configId:t,recordId:o,outputDsId:n}=E,l=ve(t,o);re({isActive:!1,key:l,recordId:o,dsId:n,configId:t}),B(!0)},me=()=>{fe(_,!G,z),V(!G),H(K+1)},pe=e=>{var t;let o=0;for(const n in e){o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0}const n=le(c);q(0===n||0===o&&M.current)},he=e.hooks.useEventCallback((e=>{G&&V(!1)})),fe=(e,t,n)=>{var i;let r=o;if(e===u.Compact)if(t||n)r=o;else{const e=(null===(i=null==l?void 0:l.current)||void 0===i?void 0:i.clientWidth)/2-15||0;r=O?[-e,0]:[e,0]}else r=o;X(r)};return(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(we,{isOpen:S,isFocusWithSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:m,toggle:he,id:s,offset:Q,version:K,className:(0,e.classNames)("result-list-con",_!==u.Compact||z?"":G?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content",role:"listbox"},!y&&(0,e.jsx)("div",{ref:T},z&&(0,e.jsx)(v.Button,{role:"button",className:"text-center",disabled:!0,title:n("noResult",{searchText:r})},n("noResult",{searchText:r})),!z&&(0,e.jsx)("div",null,_===u.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(v.Button,{role:"button",className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:me,title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!G&&r?(0,e.jsx)(f,null):(0,e.jsx)(I,null)),G&&(0,e.jsx)(v.DropdownItem,{divider:!0})),G&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];D.current=null;for(const l in U){const i=null===(t=null==U?void 0:U.asMutable({deep:!0}))||void 0===t?void 0:t[l],r=ne(x,l),s=null==r?void 0:r.label,a=null==r?void 0:r.icon,u=le(c),d=(0,e.jsx)("div",{key:`${l}_${s}_con`,role:"group",title:"label","aria-label":s},i.length>0&&(0,e.jsx)("div",null,u>1&&(0,e.jsx)(v.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,key:`${l}_${s}`,title:s},a&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(o=null==A?void 0:A.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null==a?void 0:a.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},s)),oe(i,h,te())));n.push(d)}return n})()),_===u.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},G&&(0,e.jsx)(v.DropdownItem,{divider:!0}),(0,e.jsx)(v.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:me,title:n("searchResults")},!G&&r?(0,e.jsx)(f,{size:10}):(0,e.jsx)(I,{size:10}))))),y&&(0,e.jsx)(Me,{open:y,serviceList:c,toggleUtilityErrorRemind:w}))))};var Xe=s(50170),Ye=s.n(Xe),Ze=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const et=t=>{const o=window.SVG,{className:n}=t,l=Ze(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:Ye()},l)):e.React.createElement("svg",Object.assign({className:i},l))};var tt=s(62838),ot=s.n(tt),nt=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const lt=t=>{const o=window.SVG,{className:n}=t,l=nt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:ot()},l)):e.React.createElement("svg",Object.assign({className:i},l))},{useSelector:it}=e.ReactRedux,{useState:rt,useEffect:st,useRef:at,useMemo:ut}=e.React,ct=t=>{var o,n,s,a;const u=e.hooks.useTranslation(g,v.defaultMessages),c=(0,Se.useTheme)(),m=it((e=>null==e?void 0:e.queryObject)),p=it((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),h=at((e=>{})),f=at(null),y=at(null),S=at(null),b=at(null),I=at(null),x=at(!1),w=at(!1),j=at(!1),C=at(null),R=at(null),N=at(null),M=at(!1),T=at(!1),D=at(null),P=at(null),k=at(null),O=at(!1),E=at(null),A=at(!1),U=at(null),$=at(null),G=at(!1),V=at(!1),J=at(!1),{config:B,className:_,reference:q,id:K,isShowSearchInput:H,isInCurrentView:ee,isWidgetInCurrentPage:ne,serviceList:ie,searchResult:re,selectionList:ge,datasourceConfig:me,loadingServiceList:pe,showSearchSetting:he,jimuMapView:fe,handleServiceListChange:ye,clearSearchResult:be}=t,{isShowRecentSearches:Ie,recentSearchesMaxNumber:xe,linkParam:we,searchResultView:je,resultMaxNumber:Ce}=B,[Re,Ne]=rt(null),[Me,Te]=rt(!1),[De,ke]=rt(!1),[Le,Oe]=rt(!1),[Fe,Ee]=rt([]),[Ae,Ue]=rt({}),[$e,Ge]=rt(!1),[Ve,Je]=rt(!1),[Be,_e]=rt(!1),[We,ze]=rt(null),[Ke,He]=rt(!1),[Xe,Ye]=rt(!1),[Ze,tt]=rt([]),[ot,nt]=rt(!1),[ct,dt]=rt(null),[vt,gt]=rt(!1),[mt,pt]=rt(!1),ht=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      min-width: ${e.polished.rem(16)};
      border: 2px solid ${null===(n=null===(o=null==c?void 0:c.sys.color)||void 0===o?void 0:o.secondary)||void 0===n?void 0:n.light};
      border-radius: 50%;
      border-top: 2px solid ${null===(a=null===(s=null==c?void 0:c.sys.color)||void 0===s?void 0:s.primary)||void 0===a?void 0:a.main};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--ref-palette-neutral-600);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
  `;st((()=>{A.current&&ee&&ne?(_e(!1),e.lodash.defer((()=>{Dt(!0)}))):_e(!0),ee&&ne||Pt()}),[ee,ne]),st((()=>{!Ke&&O.current&&yt(!0,!1),O.current=Ke}),[$e,Ke]),st((()=>{$e&&p===e.AppMode.Design&&Pt()}),[p]),st((()=>{h.current=e.lodash.debounce(jt,400),Yt(ie,null==B?void 0:B.hint)}),[B]),st((()=>{x.current&&(bt(ie),St(ie,w.current)),w.current=null==B?void 0:B.enableFiltering,j.current=!0}),[ie,B.enableFiltering]),st((()=>{I.current=ie,ie&&(x.current=!0);const e=(null==B?void 0:B.sourceType)!==d.MapCentric||!pe;Yt(ie,null==B?void 0:B.hint),Ct(ie),!T.current&&ie&&e&&(ft(ie),T.current=!0)}),[ie,pe]);const ft=e.hooks.useEventCallback((e=>{var t;const o=de(K),{searchText:n,status:i}=o;i&&(i.isFromSuggestion=!0),n&&(e&&0!==(null===(t=Object.keys(e))||void 0===t?void 0:t.length)||(Kt(n,i),Et(n)),clearTimeout(E.current),E.current=setTimeout((()=>{((e,t)=>{var o;let n=!0;for(const i in e){const r=e[i];let s;if(r.searchServiceType===l.FeatureService)ae(null===(o=null==r?void 0:r.useDataSource)||void 0===o?void 0:o.dataSourceId,ue(r.configId,t))||(n=!1);else{const e=null==r?void 0:r.outputDataSourceId;s=Z(e),s||(n=!1)}}return n})(null==e?void 0:e.asMutable({deep:!0}),K)&&Zt()>0?(Kt(n,i),Et(n)):ft(e)}),300))})),yt=(e=!1,t=!0)=>{t&&nt(!1),e||(V.current=!1),Ye(e)},St=(e,t)=>{if(!j.current)return!1;t!==(null==B?void 0:B.enableFiltering)&&(clearTimeout(y.current),y.current=setTimeout((()=>{var o;Rt(),be();for(const n in e){(null===(o=e[n])||void 0===o?void 0:o.searchServiceType)===l.FeatureService&&X(e[n],K,n,t)}})))},bt=e=>{if(!j.current)return!1;const t=I.current||{},o=It(e),n=It(I.current),i=(null==n?void 0:n.filter((e=>!(null==o?void 0:o.includes(e)))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&(clearTimeout(y.current),y.current=setTimeout((()=>{Rt(!1),be(),null==i||i.forEach((e=>{var o,n;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===l.FeatureService?X(t[e],K,e,null==B?void 0:B.enableFiltering):Tt(null===(n=t[e])||void 0===n?void 0:n.outputDataSourceId)}))})))},It=e=>e?Object.keys(e).map((e=>e)):[],xt=(e=!1)=>{gt(e)},wt=(e=!1)=>{pt(e)},jt=e.hooks.useEventCallback((e=>{var t;if(0===(null==B?void 0:B.maxSuggestions))return void Te(!1);!Me&&Te(!0);const o=((e,t,o,n=[])=>{const i=[];for(const r in t){const s=t[r];let a;a=s.searchServiceType===l.FeatureService?W(e,o,s,n):L(e,s),i.push(a)}return Promise.all(i)})(e,null===(t=null==C?void 0:C.current)||void 0===t?void 0:t.asMutable({deep:!0}),B,me);Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&xt(!0),Te(!1),o&&Ee(o),M.current||D.current&&ke(!0),M.current=!1})).catch((e=>{Te(!1)}))})),Ct=e.hooks.useEventCallback((e=>{if(!j.current)return!1;let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===l.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Oe(t)})),Rt=(e=!0)=>{var t;Kt(""),Te(!1),Dt(!1),Et("",!0),clearTimeout(k.current),e&&(null===(t=P.current)||void 0===t||t.focus())},Nt=e.hooks.useEventCallback((()=>{var e,t;for(const o in ie)if((null===(e=ie[o])||void 0===e?void 0:e.searchServiceType)===l.GeocodeService){const e=null===(t=ie[o])||void 0===t?void 0:t.outputDataSourceId;Tt(e)}})),Mt=e.hooks.useEventCallback((()=>{var t,o;const n=[];for(const e in ie)if((null===(t=ie[e])||void 0===t?void 0:t.searchServiceType)===l.GeocodeService){const t=null===(o=ie[e])||void 0===o?void 0:o.outputDataSourceId;n.push(t)}const i=new e.DataRecordSetChangeMessage(K,e.RecordSetChangeType.Remove,n);e.MessageManager.getInstance().publishMessage(i)})),Tt=t=>{const o=Z(t);null==o||o.selectRecordsByIds([]),se(o,e.DataSourceStatus.NotReady)},Dt=e=>{A.current=e,e||_e(!0),Ge(e),Je(e)},Pt=()=>{Ge(!1)},kt=()=>{let e=!0;if(!b.current)return e;const t=b.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Lt=(e,t,o)=>{if(o)return Ft(),!1;Ot(e,t),Kt(e,t),Et(e),P.current.focus()},Ot=(e,t)=>{const o=de(K)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}ve(K,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};ve(K,e)}else ve(K,null)},Ft=()=>{var e;null===(e=P.current)||void 0===e||e.focus(),nt(!0),yt(!0,!1)},Et=e.hooks.useEventCallback(((e,t=!1)=>{if($e&&!t)return;e=null==e?void 0:e.trim(),_t(e),ke(!1),yt(!1),At(),ye(C.current),M.current=!0;const o={serviceList:b.current,searchText:e,searchResultView:je,id:K};Ot(e),Te(!0),(e=>{const{serviceList:t,searchText:o,searchResultView:n}=e,r=[];for(const e in t){const s=t[e],{searchServiceType:a,resultMaxNumber:u}=s;if(a===l.GeocodeService){const e=n===i.ResultPanel?u:null,t=F(o,e,s,n);r.push(t)}}return Promise.all(r)})(o).then((t=>{var n;Te(!1),(null===(n=null==t?void 0:t.filter((e=>"boolean"==typeof e)))||void 0===n?void 0:n.length)>0&&wt(!0),M.current=!1,(null==B?void 0:B.enableFiltering)&&(Q(o),$t()),e&&Gt(e)}),(e=>{Te(!1)}))})),At=()=>{var t;const o=[];for(const e in C.current){const n=C.current[e],i=n.searchServiceType===l.FeatureService?null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId:null==n?void 0:n.outputDataSourceId;o.push(i)}if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(K,[],o)),ct){const e=Z(ct);null==e||e.selectRecordsByIds([]),Ut(null)}Mt(),Nt()},Ut=e=>{dt(e)},$t=e.hooks.useEventCallback((()=>{var t;const o=[];for(const e in Ae){const n=Ae[e];let i;(null==n?void 0:n.searchServiceType)===l.FeatureService?(i=null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(i)):(null==n?void 0:n.outputDataSourceId)&&o.push(null==n?void 0:n.outputDataSourceId)}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(K,o))})),Gt=e=>{je===i.OtherWidgets?e&&(Bt()?Wt():Vt()):Jt()},Vt=()=>{if(!ce(b.current,K))return clearTimeout(R.current),R.current=setTimeout((()=>{Vt()}),200),!1;const e=Y(b.current,Ce,K);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?Wt():Jt()}))},Jt=()=>{zt(),Dt(!0)},Bt=()=>{let e=[];return Fe.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},_t=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:l,isShowRecentSearches:i}=t,r=e.urlUtils.getAppIdPageIdFromUrl().appId,s=oe(r,n);if(!i||!o)return!1;let a=te(n);a.includes(o)||(a.unshift(o),a=a.splice(0,l||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:K,recentSearchesMaxNumber:xe,isShowRecentSearches:Ie})},Wt=()=>{var e;if(!(null==f?void 0:f.current))return!1;zt(),Je(!0),null===(e=null==f?void 0:f.current)||void 0===e||e.click()},zt=()=>{if(!ce(b.current,K))return clearTimeout(N.current),N.current=setTimeout((()=>{zt()}),200),!1;const t=je===i.ResultPanel?Ce:100,o=Y(b.current,t,K,!0);Promise.all([o]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),((t,o,n=e.RecordSetChangeType.CreateUpdate)=>{const l=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=Z(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),i=null==o?void 0:o.getDataSourceJson(),r={records:e.records,fields:n,dataSource:o,name:o.id,label:null==i?void 0:i.label};l.push(r)}}));const i=new e.DataRecordSetChangeMessage(t,n,l);e.MessageManager.getInstance().publishMessage(i)})(K,o,e.RecordSetChangeType.CreateUpdate)}))},qt=ut((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(we)),[we]),Kt=(e,t)=>{Ee([]),Ne(e),D.current=e,Ht(e,t)},Ht=e.hooks.useEventCallback(((t,o)=>{var n,i,r,s;const a=I.current;let u=I.current;t=null==t?void 0:t.trim();const c=B.sourceType===d.MapCentric?null===(n=null==fe?void 0:fe.view)||void 0===n?void 0:n.extent:null;for(const e in a){const o=null===(r=null===(i=a[e])||void 0===i?void 0:i.useDataSource)||void 0===r?void 0:r.dataSourceId;if(a[e].searchServiceType===l.GeocodeService||!ae(o))continue;const n=Z(o),d=(null===(s=a[e].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],v=z(t,d,n,a[e].searchExact||!1),g=z(t,d,n,!1);if(u=u.setIn([e,"SQL"],v).setIn([e,"SuggestionSQL"],g).setIn([e,"searchText"],t),c){const t=(null==c?void 0:c.toJSON)?null==c?void 0:c.toJSON():{};u=u.setIn([e,"searchExtent"],t)}}C.current=u,((t,o)=>{const{configId:n,magicKey:l,isFromSuggestion:i}=o||{};let r=(0,e.Immutable)(t);const s={};for(const e in r)e===n&&(l||i)&&(l&&(r=r.setIn([n,"magicKey"],l||null)),i&&(r=r.setIn([n,"isFromSuggestion"],i||null)),s[n]=r[n]);(l||i)&&Object.keys(t).includes(n)&&(r=(0,e.Immutable)(s));b.current=null==r?void 0:r.asMutable({deep:!0}),Ue(null==r?void 0:r.asMutable({deep:!0}))})(null==u?void 0:u.asMutable({deep:!0}),o)})),Qt=e=>{if(!e&&Ie){const e=te(K).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearch:!0})));tt([{suggestionItem:e,layer:null,icon:null}]),yt(!0)}},Xt=e=>{!e&&(null==B?void 0:B.isUseCurrentLoation)&&(yt(!0),(null==B?void 0:B.isShowRecentSearches)||tt([{suggestionItem:[],layer:null,icon:null}]))},Yt=e.hooks.useEventCallback(((e,t)=>{var o,n;if(!e)return;let l;const i=Zt(e);for(const t in e)l=(null===(o=null==e?void 0:e[t])||void 0===o?void 0:o.hint)&&(null===(n=null==e?void 0:e[t])||void 0===n?void 0:n.hint);const r=t||(null==B?void 0:B.hint)||u("findAddressOrPlace");l=l||u("findAddressOrPlace");ze(1!==i?r:l)})),Zt=e.hooks.useEventCallback((e=>le(e=e||ie))),eo=e=>{var t,o,n;40===e.keyCode&&U&&(De?null===(t=null==U?void 0:U.current)||void 0===t||t.focus():$e?null===(o=null==S?void 0:S.current)||void 0===o||o.focus():Xe&&(null===(n=null==$?void 0:$.current)||void 0===n||n.focus(),V.current=!0))},to=()=>{if(Ke)return!0;if(Me||$e)return!1;let e=!1;return(null==B?void 0:B.maxSuggestions)>0&&(e=De&&Le),e||(G.current=!1),e},oo=()=>{ke(!1)};return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${_||""} arrangement-${B.arrangementStyle}`,css:ht},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=to();G.current=e,V.current=Xe}eo(e)}},H&&(0,e.jsx)(v.TextInput,{value:Re||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(Kt(o),$e&&Et("",!0),Dt(!1),!n||!Le)return ke(!1),0===(null==o?void 0:o.length)&&Et("",!0),!1;h.current(o)},onFocus:e=>{if(G.current||V.current)return V.current=!1,G.current=!1,!1;Qt(D.current),Xt(D.current)},onKeyUp:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&kt()&&(Kt(o),Et(o)),eo(e)},onBlur:e=>{k.current=setTimeout((()=>{G.current||ke(!1),J.current||V.current||yt(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":he}),suffix:(0,e.jsx)("div",{className:"d-flex align-items-center"},(Me||Ke)&&(0,e.jsx)("div",{className:"loading-con mr-1"}),Re&&(null==Re?void 0:Re.length)>0&&(0,e.jsx)(v.Button,{icon:!0,type:"tertiary",size:"sm",title:u("clear"),onClick:()=>{Rt()}},(0,e.jsx)(lt,null))),prefix:B.arrangementStyle===r.Style2?(0,e.jsx)(et,{className:"input-prefix-icon"}):null,placeholder:We,title:Re||We,ref:P})),Re&&(0,e.jsx)(Pe,{canUseOutputDsLength:Zt(),isOpen:to(),reference:q,searchText:Re,searchSuggestion:Fe,toggle:oo,onRecordItemClick:Lt,setSuggestionFirstItem:e=>{U.current=e},id:K,config:B,toggleSuggestionUtilityError:xt,openUtilityErrRemindInSuggestion:vt,searchInputRef:P,serviceList:ie}),!Re&&((null==B?void 0:B.isUseCurrentLoation)||(null==B?void 0:B.isShowRecentSearches)||!Ke)&&(0,e.jsx)(qe,{serviceList:le(Ae)>0?(0,e.Immutable)(Ae):ie,isOpen:Xe||Ke,reference:q,isGetLocationError:ot,recentSearchesData:Ze,toggle:oo,onRecordItemClick:Lt,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=oe(o,t);e.utils.setLocalStorage(n,"")})(K),tt([]),Ye(!1)},setSuggestionFirstItem:e=>{$.current=e},id:K,config:B,searchInputRef:P,locationLoading:Ke,handleLocationLoadingChange:e=>{e?(He(e),J.current=e):setTimeout((()=>{He(e),J.current=e}),300)}}),(0,e.jsx)(Qe,{isOpenResultPopper:$e,isToOtherWidget:Ve,serviceList:(0,e.Immutable)(Ae),config:B,reference:q,searchText:Re,id:K,setResultFirstItem:e=>{S.current=e},isOpenResultListDefault:Be,searchInputRef:P,searchResult:re,selectionList:ge,openUtilityErrRemindInResult:mt,handleDsIdOfSelectedResultItemChange:Ut,toggleResultUtilityError:wt,datasourceConfig:me})),B.arrangementStyle!==r.Style2&&(0,e.jsx)(v.Button,{className:"search-button h-100",type:B.arrangementStyle===r.Style3?"tertiary":"primary",icon:!0,onClick:()=>{(e=>{kt()&&Et(e)})(Re)},title:u("SearchLabel")},(0,e.jsx)(et,null)),je===i.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(v.Link,{ref:f,to:null==qt?void 0:qt.linkTo,target:null==qt?void 0:qt.target,queryObject:m})))},{useEffect:dt,useState:vt}=e.React,gt=t=>{const{config:o,id:n,serviceList:i,dsStatus:r,synchronizeSettings:s,handleSearchResultChange:a,handleSelectionListChange:u,handleDsStatusChange:c}=t,[v,g]=vt(!1);dt((()=>{Object.keys(i||{}).forEach((e=>{var t;(null===(t=i[e])||void 0===t?void 0:t.searchText)&&g(!0)}))}),[i]);const m=(t,i,a)=>{if(t.searchServiceType===l.GeocodeService){const l=null==t?void 0:t.outputDataSourceId,r={dataSourceId:l,mainDataSourceId:l},a={where:"2=2",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};if(!1!==s&&(null==o?void 0:o.sourceType)===d.MapCentric){const o=Z(l);return(0,e.jsx)("div",{key:`${i}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{dataSource:o,query:a,key:`${i}_outputDataSource`,onDataSourceInfoChange:e=>{h(t,i)},onDataSourceStatusChange:e=>{h(t,i,e)},onSelectionChange:e=>{p(e,i)},widgetId:n}))}return(0,e.jsx)("div",{key:`${i}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(r),query:a,key:`${i}_outputDataSource`,onDataSourceInfoChange:e=>{h(t,i)},onDataSourceStatusChange:e=>{h(t,i,e)},onSelectionChange:e=>{p(e,i)},widgetId:n}))}if(t.searchServiceType===l.FeatureService){const o=null==t?void 0:t.useDataSource,l=function(t){const{searchText:o,useDataSource:n}=t,l=null==t?void 0:t.SQL,i=o?(null==l?void 0:l.sql)||"1=0":"1=1",r=o&&(null==l?void 0:l.sql)?l:null,s=q(t.searchFields,t.displayFields,null==n?void 0:n.dataSourceId);return(0,e.Immutable)({outFields:s,where:i,sqlExpression:r,returnGeometry:!0})}(null==t?void 0:t.asMutable({deep:!0})),s=ue(i,n);return(0,e.jsx)("div",{key:`${i}_con`},o&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(o),query:a?l:null,key:`${i}_useDataSource`,onDataSourceInfoChange:e=>{h(t,i)},onSelectionChange:e=>{p(e,i)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{c((0,e.Immutable)(r.set(i,t)))},localId:s}))}},p=(e,t)=>{u(e,t)},h=(t,i,s)=>{const{searchServiceType:u}=t;switch(u){case l.GeocodeService:J(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));a(i,o)}));break;case l.FeatureService:K(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,n).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));a(i,o)}))}s&&c((0,e.Immutable)(r.set(i,s)))};return(0,e.jsx)("div",null,((e,t)=>{const o=[];for(const n in e)o.push(m(e[n],n,t));return o})(i,v))};var mt=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};const pt=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=pt(e,t+=1))})),o};function ht(t){return mt(this,void 0,void 0,(function*(){yield function(t){return mt(this,void 0,void 0,(function*(){if(!t)return;const o=[];return Object.keys(t).forEach((n=>{const l=t[n],i=ft(l),r=(null==i?void 0:i.layers)||[],s=(null==i?void 0:i.tables)||[],a=[],u=[];if(s.forEach((e=>{a.includes(null==e?void 0:e.id)||a.push(null==e?void 0:e.id)})),r.forEach((e=>{u.includes(null==e?void 0:e.id)||u.push(null==e?void 0:e.id)})),null==i?void 0:i.enabled){const l=t[n],i=l.jimuLayerViews,r=l.jimuTables,s=e.DataSourceManager.getInstance();Object.keys(r).forEach((e=>{const t=r[e],n=l.getDataSourceIdByAPILayer(t),i=s.getDataSource(n),u=l.getMapDataSource();if(!i&&u&&a.includes(null==t?void 0:t.id)){const e=u.createDataSourceByLayer(t);o.push(e)}})),Object.keys(i).forEach((e=>{var t;const n=i[e];if(!n.getLayerDataSource()&&u.includes(null===(t=n.layer)||void 0===t?void 0:t.id)){const e=n.createLayerDataSource();o.push(e)}}))}})),Promise.all(o)}))}(t);const o={},n=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getNewDataSourceConfig:l,getDsJsonOfOriginDs:i}=n,r=Object.keys(t||{}).map((n=>mt(this,void 0,void 0,(function*(){var r,s,a,u,c,d,v,g;const m=t[n],p=bt(m),h=It(m),f=null===(r=h[0])||void 0===r?void 0:r.jimuLayerViewsOrTable,y=null===(s=h[1])||void 0===s?void 0:s.jimuLayerViewsOrTable,S=0===(null===(a=Object.keys(f))||void 0===a?void 0:a.length)&&0===(null===(u=Object.keys(y))||void 0===u?void 0:u.length);let b=null===(c=null==o?void 0:o[n])||void 0===c?void 0:c.dataSourceConfig;if(S||0===(null==p?void 0:p.length))o[n]={dataSourceConfig:(null===(d=null==o?void 0:o[n])||void 0===d?void 0:d.dataSourceConfig)||[]};else{const t=e.DataSourceManager.getInstance();for(let r=0;r<h.length;r++){const{jimuLayerViewsOrTable:s,isTable:a}=h[r];for(const r in s||{}){const u=s[r],c=a?m.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(v=null==u?void 0:u.layer)||void 0===v?void 0:v.id,h=a?t.getDataSource(c):null==u?void 0:u.getLayerDataSource();if(!wt(n,null==h?void 0:h.id,o)&&p.includes(d)){const t={dataSourceId:h.id,mainDataSourceId:h.id,dataViewId:h.dataViewId,rootDataSourceId:null===(g=h.getRootDataSource())||void 0===g?void 0:g.id,viewId:n},r=yield i(t);xt(m,d).forEach((i=>{var s;const a=null==i?void 0:i.field,u=(null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.exactMatch)||!1;let c;if(null==a?void 0:a.name){c=`${null==r?void 0:r.getLabel()}: ${a.name}`}const d={datasourceConfig:(0,e.Immutable)(b),dsJsonOriginDs:r,useDataSource:t,viewId:n,fieldsInMapSearchProperties:a?[a]:null,exactMatch:u,label:c},v=l(d);o[n]||(o[n]={}),o[n].dataSourceConfig=v.datasourceConfig,b=v.datasourceConfig}))}}}}return Promise.resolve(o)}))));return yield Promise.all(r),Promise.resolve(o)}))}const ft=e=>{var t,o,n,l;if(!e)return null;const i=(null===(o=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===o?void 0:o.applicationProperties)||null;return i?null===(l=null===(n=i.toJSON())||void 0===n?void 0:n.viewing)||void 0===l?void 0:l.search:null},yt=[x.LayerTypes.FeatureLayer,x.LayerTypes.SceneLayer,x.LayerTypes.BuildingComponentSublayer,x.LayerTypes.OrientedImageryLayer,x.LayerTypes.ImageryLayer,x.LayerTypes.SubtypeGroupLayer,x.LayerTypes.SubtypeSublayer];function St(e){if(!e||!e.type)return!1;const t=e.type,o=t!==x.LayerTypes.BuildingComponentSublayer||t===x.LayerTypes.BuildingComponentSublayer&&e.view;return!!(yt.includes(t)&&o)}const bt=t=>{const o=ft(t);if(!(null==o?void 0:o.enabled))return[];const n=[],l=(null==o?void 0:o.layers)||[],i=(null==o?void 0:o.tables)||[],r=l.concat(i).map((e=>null==e?void 0:e.id)),s=e.DataSourceManager.getInstance();return It(t).forEach((e=>{var o,l;const{jimuLayerViewsOrTable:i,isTable:a}=e;for(const e in i||{}){const u=i[e];if(!St(u))continue;const c=a?t.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(o=null==u?void 0:u.layer)||void 0===o?void 0:o.id,v=a?s.getDataSource(c):null==u?void 0:u.getLayerDataSource();(null===(l=null==v?void 0:v.getDataSourceJson())||void 0===l?void 0:l.url)&&r.includes(d)&&n.push(d)}})),n},It=e=>[{jimuLayerViewsOrTable:null==e?void 0:e.jimuLayerViews,isTable:!1},{jimuLayerViewsOrTable:null==e?void 0:e.jimuTables,isTable:!0}],xt=(e,t)=>{const o=ft(e),n=(null==o?void 0:o.layers)||[],l=(null==o?void 0:o.tables)||[];return n.concat(l).filter((e=>(null==e?void 0:e.id)===t))||[]};function wt(e,t,o){var n;const l=null==o?void 0:o[e];if(!l)return!1;const i=null===(n=null==l?void 0:l.dataSourceConfig)||void 0===n?void 0:n.filter((e=>{var o;return t===(null===(o=null==e?void 0:e.useDataSource)||void 0===o?void 0:o.dataSourceId)}));return(null==i?void 0:i.length)>0}var jt=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};const Ct={jimuName:w,alias:"ADDRESS",type:e.JimuFieldType.String,name:w},Rt=t=>jt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class Nt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use array of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===l.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Ct],e.addressFields=[Ct],e.defaultAddressFieldName=Ct.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>jt(this,void 0,void 0,(function*(){var o,n;const i=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((o=>jt(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=l,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}),(e=>Promise.resolve(t)))})))))),r=i?yield Promise.all(i):[];return t.setIn(["datasourceConfig"],r)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>jt(this,void 0,void 0,(function*(){const o=yield(()=>jt(this,void 0,void 0,(function*(){var o,n;const i=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>jt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[l]=n;return l(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:l}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=pt(o,0),l={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(l),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),i=((null==t?void 0:t.addressFields)||[]).concat(l);return t.addressFields=i,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return i?yield Promise.all(i):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],u.Classic)}))},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:t=>jt(this,void 0,void 0,(function*(){let o=!1;const n=yield(()=>jt(this,void 0,void 0,(function*(){var n,i;const r=null===(i=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===i?void 0:i.map((t=>jt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((n=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[l]=e;return l(n,{query:{f:"json"},responseType:"json"}).then((e=>{const n=(null==e?void 0:e.data)||{};return(null==n?void 0:n.spatialReference)?(o=!0,t.spatialReference=n.spatialReference,Promise.resolve(t)):Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return r?yield Promise.all(r):[]})))(),i=t.setIn(["datasourceConfig"],n);return o?i:t}))},{version:"1.16.0",description:"Update isAutoSelectFirstResult with searchResultView",upgrader:e=>jt(this,void 0,void 0,(function*(){let t=e;return(null==e?void 0:e.searchResultView)===i.OtherWidgets&&(null==e?void 0:e.isAutoSelectFirstResult)&&(t=t.set("isAutoSelectFirstResult",!1)),t}))}]}}const Mt=new Nt;var Tt=function(e,t,o,n){return new(o||(o=Promise))((function(l,i){function r(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Dt,useState:Pt,useRef:kt}=e.React,Lt=e.css`
  & {
    height: ${e.polished.rem(32)};
    margin-top: 0;
    margin-left: 0;
  }
  &.search-con-in-controller {
    width: 300px !important;
  }
  &.search-con-Style3 {
    border-bottom: 1px solid var(--ref-palette-neutral-500);
  }
`,Ot=o=>{const n=kt(null),i=kt(null),s=kt(null),{config:a,id:u,useDataSources:c,useMapWidgetIds:v,controllerWidgetId:g}=o,m=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appConfig.widgets[u])||void 0===t?void 0:t.offPanel})),{resultMaxNumber:p}=a,h=kt(null),f=kt((0,e.Immutable)({})),y=e.hooks.useTranslation(e.defaultMessages),[S,b]=Pt((0,e.Immutable)([])),[I,w]=Pt(!1),[j,C]=Pt(null),[R,N]=Pt((0,e.Immutable)({})),[M,T]=Pt((0,e.Immutable)({})),[D,P]=Pt((0,e.Immutable)({})),[k,L]=Pt(null),[O,F]=Pt(null),[E,A]=Pt(!1);Dt((()=>{const t=v&&(null==v?void 0:v.length)>0;(null==a?void 0:a.sourceType)===d.MapCentric&&t&&A(!0),(null==a?void 0:a.sourceType)===d.MapCentric&&k?t?U(a,k):(b((0,e.Immutable)([])),C(null),A(!1)):(!t&&A(!1),G(null==a?void 0:a.datasourceConfig)),n.current=a,i.current=k}),[a,k,v]);const U=(t,o)=>Tt(void 0,void 0,void 0,(function*(){var l,r,a;A(!0);const c=null==o?void 0:o.id,v=(null===(l=i.current)||void 0===l?void 0:l.id)!==c,g=(null==t?void 0:t.dataSourceConfigWithMapCentric)!==(null===(r=n.current)||void 0===r?void 0:r.dataSourceConfigWithMapCentric);let m=[];const p=null===(a=null==t?void 0:t.dataSourceConfigWithMapCentric)||void 0===a?void 0:a[c];!1!==(null==p?void 0:p.synchronizeSettings)&&(m=yield Tt(void 0,void 0,void 0,(function*(){const t=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getDefaultGeocodeConfig:o}=t;return s.current?Promise.resolve(O):o({nls:y,id:u,createOutputDs:!0,viewId:"default_geocode_custom",isSingle:!1,notAddNewUtility:!0}).then((e=>(F(e),s.current=e,Promise.resolve(e))),(e=>Promise.resolve([])))})),yield ge(m));const h=yield function(t,o,n){return mt(this,void 0,void 0,(function*(){var l;const i=null==t?void 0:t.id;if((null==o?void 0:o.sourceType)===d.MapCentric){const r=(null==o?void 0:o.dataSourceConfigWithMapCentric)||{},s=Object.keys(r)||[];let a;if(s.includes(i)?a=null==r?void 0:r[i]:(null==s?void 0:s.length)>0&&(a=null==r?void 0:r[s[0]]),!1===(null==a?void 0:a.synchronizeSettings))return Promise.resolve((0,e.Immutable)(null==a?void 0:a.dataSourceConfig));{const o={};o[t.id]=t;const r=yield ht(o);let s=(null===(l=null==r?void 0:r[i])||void 0===l?void 0:l.dataSourceConfig)||[];const a=n||[];return s=s.concat(a),Promise.resolve((0,e.Immutable)(s))}}return Promise.resolve(null==o?void 0:o.datasourceConfig)}))}(o,t,m);(v||g)&&(yield G(h)),A(!1)})),$=e=>{e&&b(e),q(e)},G=t=>Tt(void 0,void 0,void 0,(function*(){const o=(t||(0,e.Immutable)([])).map((e=>Tt(void 0,void 0,void 0,(function*(){const t=J(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield V(e).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(o).then((t=>{b((0,e.Immutable)(t)),q((0,e.Immutable)(t))}))})),V=e=>Tt(void 0,void 0,void 0,(function*(){var t;return(null===(t=null==e?void 0:e.useUtility)||void 0===t?void 0:t.utilityId)?B(null==e?void 0:e.useUtility):(null==e?void 0:e.geocodeURL)?Promise.resolve(null==e?void 0:e.geocodeURL):void 0})),J=e=>{if(S&&0!==(null==S?void 0:S.length)){let t=!0;return null==S||S.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=de(u),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},B=t=>Tt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),_=e=>{C(e)},W=()=>(null==a?void 0:a.arrangementStyle)===r.Style1||(null==a?void 0:a.arrangementStyle)===r.Style2||(null==a?void 0:a.arrangementStyle)===r.Style3||I,z=e=>{w(e)},q=t=>{var o;let n=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===l.GeocodeService?H(e):K(e),n=n.setIn([t],o)})),C(n)},K=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.GeocodeService)return!1;const{configId:o,useDataSource:n,displayFields:i,searchFields:r,searchExact:s,hint:u,searchServiceType:c}=e,d=(null===(t=null==j?void 0:j[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},v={useDataSource:n,displayFields:i,searchFields:r,searchExact:s,maxSuggestions:null==a?void 0:a.maxSuggestions,resultMaxNumber:p,hint:u,searchServiceType:c,configId:o};return Object.assign(d,v)})),H=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.FeatureService)return!1;const{countryCode:o,configId:n,hint:i,geocodeURL:r,outputDataSourceId:s,label:u,searchServiceType:c,spatialReference:d,singleLineFieldName:v,displayFields:g,defaultAddressFieldName:m,addressFields:h,isSupportSuggest:f,useUtility:y}=e,S=(null===(t=null==j?void 0:j[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},b={hint:i,geocodeURL:r,outputDataSourceId:s,icon:null==e?void 0:e.icon,maxSuggestions:null==a?void 0:a.maxSuggestions,resultMaxNumber:p,label:u,searchServiceType:c,configId:n,singleLineFieldName:v||"",displayFields:g,defaultAddressFieldName:m,addressFields:h||[],isSupportSuggest:f,useUtility:y,spatialReference:d,countryCode:o};return Object.assign(S,b)},Q=(t,o)=>{const n=R.set(t,o);N((0,e.Immutable)(n))},X=()=>{N((0,e.Immutable)({}))},Y=e.hooks.useEventCallback(((e,t)=>{const o=f.current.setIn([t],e);T(o),f.current=o})),Z=e=>{P(e)},ee=e=>{L(e)},te=e.hooks.useEventCallback(((e,t)=>e||(null==t?void 0:t.length)>1&&W()));return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:n})=>{const l=!o||n;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o,n,i,r;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:(0,e.classNames)(`d-flex w-100 align-items-center search-con-${a.arrangementStyle}`,{"search-con-in-controller":g&&"boolean"==typeof m}),css:Lt,ref:h},(0,e.jsx)("div",null,te(E,S)&&(0,e.jsx)(ye,{showLoading:E,className:"h-100",config:a,dsStatus:D,datasourceConfig:S,id:u,useDataSources:c,onDatasourceConfigChange:$,synchronizeSettings:null===(n=null===(o=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===o?void 0:o[null==k?void 0:k.id])||void 0===n?void 0:n.synchronizeSettings})),(0,e.jsx)(ct,{showSearchSetting:te(E,S),id:u,className:"flex-grow-1 h-100",reference:h,config:a,isShowSearchInput:W(),onShowSearchInputChange:z,isInCurrentView:l,isWidgetInCurrentPage:t,handleServiceListChange:_,searchResult:R,serviceList:j,clearSearchResult:X,selectionList:M,jimuMapView:k,datasourceConfig:S,loadingServiceList:E}),(0,e.jsx)(gt,{id:u,config:a,serviceList:j,dsStatus:D,handleSearchResultChange:Q,handleSelectionListChange:Y,handleDsStatusChange:Z,synchronizeSettings:null===(r=null===(i=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===i?void 0:i[null==k?void 0:k.id])||void 0===r?void 0:r.synchronizeSettings}),(null==a?void 0:a.sourceType)===d.MapCentric&&(0,e.jsx)(x.JimuMapViewComponent,{useMapWidgetId:null==v?void 0:v[0],onActiveViewChange:ee})))}))}))};Ot.versionManager=Mt;const Ft=Ot;function Et(e){s.p=e}})(),a})())}}}));